
/*
Easy
Copyright (C) 2021 Università degli Studi di Catania (www.unict.it)
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/


-- CREAZIONE VISTA allowanceruledetailview
IF EXISTS(select * from sysobjects where id = object_id(N'[dbo].[allowanceruledetailview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [dbo].[allowanceruledetailview]
GO



CREATE VIEW DBO.allowanceruledetailview
(
	idallowancerule,
	iddetail,
	start,
	idposition,
	codeposition,
	position,
	minincomeclass,
	maxincomeclass,
	amount,
	advancepercentage,
	ct, cu, lt, lu
)
AS SELECT 
	DET.idallowancerule,
	DET.iddetail,
	F.start,
	DET.idposition,
	P.codeposition,
	P.description,
	DET.minincomeclass,
	DET.maxincomeclass,
	DET.amount,
	DET.advancepercentage,
	DET.ct, DET.cu, DET.lt, DET.lu
FROM allowanceruledetail DET
JOIN allowancerule F
	ON F.idallowancerule = DET.idallowancerule
LEFT OUTER JOIN position P
	ON P.idposition = DET.idposition



GO

-- VERIFICA DI allowanceruledetailview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'allowanceruledetailview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'advancepercentage')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '9',field = 'advancepercentage',col_precision = '19' where tablename = 'allowanceruledetailview' AND field = 'advancepercentage'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(19,6)','N','allowanceruledetailview','S','','9','advancepercentage','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'allowanceruledetailview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(19,2)','N','allowanceruledetailview','S','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'codeposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'N',format = '',col_len = '20',field = 'codeposition',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'codeposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','allowanceruledetailview','N','','20','codeposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','allowanceruledetailview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','allowanceruledetailview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'idallowancerule')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '4',field = 'idallowancerule',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'idallowancerule'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','allowanceruledetailview','S','','4','idallowancerule','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'iddetail')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '4',field = 'iddetail',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'iddetail'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','allowanceruledetailview','S','','4','iddetail','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'idposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '4',field = 'idposition',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'idposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','allowanceruledetailview','S','','4','idposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','allowanceruledetailview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','allowanceruledetailview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'maxincomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '4',field = 'maxincomeclass',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'maxincomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','allowanceruledetailview','S','','4','maxincomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'minincomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '4',field = 'minincomeclass',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'minincomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','allowanceruledetailview','S','','4','minincomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'position')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'N',format = '',col_len = '50',field = 'position',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'position'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','allowanceruledetailview','N','','50','position','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'allowanceruledetailview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'allowanceruledetailview',denynull = 'S',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'allowanceruledetailview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','allowanceruledetailview','S','','8','start','')
GO

-- VERIFICA DI allowanceruledetailview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'allowanceruledetailview')
UPDATE customobject set isreal = 'N' where objectname = 'allowanceruledetailview'
ELSE
INSERT INTO customobject (objectname, isreal) values('allowanceruledetailview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA configview
IF EXISTS(select * from sysobjects where id = object_id(N'[configview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [configview]
GO




CREATE VIEW configview
(
	ayear,
	appropriationphasecode,
	appropriationphase,
	assessmentphasecode,
	assessmentphase,
	asset_flagnumbering,
	asset_flagrestart,
	assetload_flag,
	previsionkind,
	secprevisionkind,
	cashvaliditykind,
	boxpartitiontitle,
	currpartitiontitle,
	prevpartitiontitle,
	deferredexpensephase,
	deferredincomephase,
	electronictrasmission,
	electronicimport,
	appname,
	importappname,
	admintaxkind,
	employtaxkind,
	clawbackkind,
	expense_expiringdays,
	income_expiringdays,
	expensephase,
	expensephasedescr,
	incomephase,
	incmephasedescr,
	idacc_accruedcost,
	codeacc_accruedcost,
	accruedcost_acc,
	idacc_accruedrevenue,
	codeacc_accruedrevenue,
	accruedrevenue_acc,
	idacc_customer,
	codeacc_customer,
	customer_acc,
	idacc_deferredcost,
	codeacc_deferredcost,
	deferredcost_acc,
	idacc_deferredrevenue,
	codeacc_deferredrevenue,
	deferredrevenue_acc,
	idacc_ivapayment,
	codeacc_ivapayment,
	ivapayment_acc,
	idacc_ivarefund,
	codeacc_ivarefund,
	ivarefund_acc,
	idacc_patrimony,
	codeacc_patrimony,
	patrimony_acc,
	idacc_pl,
	codeacc_pl,
	pl_acc,
	idacc_supplier,
	codeacc_supplier,
	supplier_acc,
	idaccmotive_admincar,
	codemotive_admincar,
	admincar,
	idaccmotive_foot,
	codemotive_foot,
	foot,
	idaccmotive_owncar,
	codemotive_owncar,
	owncar,
	foreignhours,
	idclawback,
	clawback,
	idfinexpense,
	codefinexpense,
	finexpense,
	idfinexpensesurplus,
	codefinexpensesurplus,
	finexpensesurplus,
	idfinincomesurplus,
	codefinincomesurplus,
	finincomesurplus,
	idfinivapayment,
	codefinivapayment,
	ivapayment,
	idfinivarefund,
	codefinivarefund,
	finivarefund,
	idivapayperiodicity,
	ivapayperiodicity,
	idregauto,
	registry,
	idsortingkind1,
	sorting1,
	idsortingkind2,
	sorting2,
	idsortingkind3,
	sorting3,
	linktoinvoice,
	minpayment,
	minrefund,
	motivelen,
	motiveprefix,
	motiveseparator,
	payment_finlevel,
	pay_finleveldescr,
	payment_flag,
	payment_flagautoprintdate,
	paymentagency,
	paymentagency_title,
	proceeds_finlevel,
	pro_finleveldescr,
	proceeds_flag,
	proceeds_flagautoprintdate,
	refundagency,
	refundagency_title,
	flagadmintax,
	flagarrearsadmintax,
	flagautopayment,
	flagautoproceeds,
	flagclawback,
	flagcredit,
	flagepexp,
	flagfruitful,
	flagpayment,
	flagproceeds,
	flagrefund,
	flagtax,
	flagtaxcompetency,
	payments_groupingkind,
	proceeds_groupingkind,
	estimate_numerationkind,
	mandate_numerationkind,
	invoice_numerationkind,
	casualcontract_flagnumbering,
	casualcontract_flagrestart,
	parasubcontract_numerationkind,
	profservice_flagnumbering,
	profservice_flagrestart,
	wageaddition_flagnumbering,
	wageaddition_flagrestart,
	ct, cu, lt, lu
)
AS SELECT
	C.ayear,
	C.appropriationphasecode,
	APP.description,
	C.assessmentphasecode,
	ASS.description,
	C.asset_flagnumbering,
	C.asset_flagrestart,
	C.assetload_flag,
	C.previsionkind,
	C.secprevisionkind,
	C.cashvaliditykind,
	C.boxpartitiontitle,
	C.currpartitiontitle,
	C.prevpartitiontitle,
	C.deferredexpensephase,
	C.deferredincomephase,
	C.electronictrasmission,
	C.electronicimport,
	C.appname,
	C.importappname,
	C.admintaxkind,
	C.employtaxkind,
	C.clawbackkind,
	C.expense_expiringdays,
	C.income_expiringdays,
	C.expensephase,
	EXP_CONT.description,
	C.incomephase,
	INC_CONT.description,
	C.idacc_accruedcost,
	ACCRUEDCOST.codeacc,
	ACCRUEDCOST.title,
	C.idacc_accruedrevenue,
	ACCRUEDREVENUE.codeacc,
	ACCRUEDREVENUE.title,
	C.idacc_customer,
	CUSTOMER.codeacc,
	CUSTOMER.title,
	C.idacc_deferredcost,
	DEFERREDCOST.codeacc,
	DEFERREDCOST.title,
	C.idacc_deferredrevenue,
	DEFERREDREVENUE.codeacc,
	DEFERREDREVENUE.title,
	C.idacc_ivapayment,
	IVAPAYMENT.codeacc,
	IVAPAYMENT.title,
	C.idacc_ivarefund,
	IVAREFUND.codeacc,
	IVAREFUND.title,
	C.idacc_patrimony,
	PAT.codeacc,
	PAT.title,
	C.idacc_pl,
	PL.codeacc,
	PL.title,
	C.idacc_supplier,
	SUPPLIER.codeacc,
	SUPPLIER.title,
	C.idaccmotive_admincar,
	ADMINCAR.codemotive,
	ADMINCAR.title,
	C.idaccmotive_foot,
	FOOT.codemotive,
	FOOT.title,
	C.idaccmotive_owncar,
	OWNCAR.codemotive,
	OWNCAR.title,
	C.foreignhours,
	C.idclawback,
	clawback.description,
	C.idfinexpense,
	FINEXPENSE.codefin,
	FINEXPENSE.title,
	C.idfinexpensesurplus,
	E_SURPLUS.codefin,
	E_SURPLUS.title,
	C.idfinincomesurplus,
	I_SURPLUS.codefin,
	I_SURPLUS.title,
	C.idfinivapayment,
	FIN_IVAPAYMENT.codefin,
	FIN_IVAPAYMENT.title,
	C.idfinivarefund,
	FIN_IVAREFUND.codefin,
	FIN_IVAREFUND.title,
	C.idivapayperiodicity,
	IPP.description,
	C.idregauto,
	R.title,
	C.idsortingkind1,
	S1.description,
	C.idsortingkind2,
	S2.description,
	C.idsortingkind3,
	S3.description,
	C.linktoinvoice,
	C.minpayment,
	C.minrefund,
	C.motivelen,
	C.motiveprefix,
	C.motiveseparator,
	C.payment_finlevel,
	FL_PA.description,
	C.payment_flag,
	C.payment_flagautoprintdate,
	C.paymentagency,
	PAYAGENCY.title,
	C.proceeds_finlevel,
	FL_PR.description,
	C.proceeds_flag,
	C.proceeds_flagautoprintdate,
	C.refundagency,
	REFAGENCY.title,
	C.flagadmintax,
	C.flagarrearsadmintax,
	C.flagautopayment,
	C.flagautoproceeds,
	C.flagclawback,
	C.flagcredit,
	C.flagepexp,
	C.flagfruitful,
	C.flagpayment,
	C.flagproceeds,
	C.flagrefund,
	C.flagtax,
	C.flagtaxcompetency,
	C.payments_groupingkind,
	C.proceeds_groupingkind,
	C.estimate_numerationkind,
	C.mandate_numerationkind,
	C.invoice_numerationkind,
	C.casualcontract_flagnumbering,
	C.casualcontract_flagrestart,
	C.parasubcontract_numerationkind,
	C.profservice_flagnumbering,
	C.profservice_flagrestart,
	C.wageaddition_flagnumbering,
	C.wageaddition_flagrestart,
	C.ct, C.cu, C.lt, C.lu
FROM config C
LEFT OUTER JOIN expensephase APP
	ON C.appropriationphasecode = APP.nphase
LEFT OUTER JOIN incomephase ASS
	ON C.assessmentphasecode = ASS.nphase
LEFT OUTER JOIN expensephase EXP_CONT
	ON C.expensephase = EXP_CONT.nphase
LEFT OUTER JOIN incomephase INC_CONT
	ON C.incomephase = INC_CONT.nphase
LEFT OUTER JOIN account ACCRUEDCOST
	ON C.idacc_accruedcost = ACCRUEDCOST.idacc
LEFT OUTER JOIN account ACCRUEDREVENUE
	ON C.idacc_accruedrevenue = ACCRUEDREVENUE.idacc
LEFT OUTER JOIN account CUSTOMER
	ON C.idacc_customer = CUSTOMER.idacc
LEFT OUTER JOIN account DEFERREDCOST
	ON C.idacc_deferredcost = DEFERREDCOST.idacc
LEFT OUTER JOIN account DEFERREDREVENUE
	ON C.idacc_deferredrevenue = DEFERREDREVENUE.idacc
LEFT OUTER JOIN account IVAPAYMENT
	ON C.idacc_ivapayment = IVAPAYMENT.idacc
LEFT OUTER JOIN account IVAREFUND
	ON C.idacc_ivarefund = IVAREFUND.idacc
LEFT OUTER JOIN account PAT
	ON C.idacc_patrimony = PAT.idacc
LEFT OUTER JOIN account PL
	ON C.idacc_pl = PL.idacc
LEFT OUTER JOIN account SUPPLIER
	ON C.idacc_supplier = SUPPLIER.idacc
LEFT OUTER JOIN accmotive ADMINCAR
	ON C.idaccmotive_admincar = ADMINCAR.idaccmotive
LEFT OUTER JOIN accmotive FOOT
	ON C.idaccmotive_foot = FOOT.idaccmotive
LEFT OUTER JOIN accmotive OWNCAR
	ON C.idaccmotive_owncar = OWNCAR.idaccmotive
LEFT OUTER JOIN clawback
	ON C.idclawback = clawback.idclawback
LEFT OUTER JOIN fin FINEXPENSE
	ON C.idfinexpense = FINEXPENSE.idfin
LEFT OUTER JOIN fin E_SURPLUS
	ON C.idfinexpensesurplus = E_SURPLUS.idfin
LEFT OUTER JOIN fin I_SURPLUS
	ON C.idfinincomesurplus = I_SURPLUS.idfin
LEFT OUTER JOIN fin FIN_IVAPAYMENT
	ON C.idfinivapayment = FIN_IVAPAYMENT.idfin
LEFT OUTER JOIN fin FIN_IVAREFUND
	ON C.idfinivarefund = FIN_IVAREFUND.idfin
LEFT OUTER JOIN ivapayperiodicity IPP
	ON C.idivapayperiodicity = IPP.idivapayperiodicity
LEFT OUTER JOIN registry R
	ON C.idregauto = R.idreg
LEFT OUTER JOIN sortingkind S1
	ON C.idsortingkind1 = S1.idsorkind
LEFT OUTER JOIN sortingkind S2
	ON C.idsortingkind2 = S2.idsorkind
LEFT OUTER JOIN sortingkind S3
	ON C.idsortingkind3 = S3.idsorkind
LEFT OUTER JOIN finlevel FL_PA
	ON C.ayear = FL_PA.ayear
	AND C.payment_finlevel = FL_PA.nlevel
LEFT OUTER JOIN finlevel FL_PR
	ON C.ayear = FL_PR.ayear
	AND C.payment_finlevel = FL_PR.nlevel
LEFT OUTER JOIN registry PAYAGENCY
	ON C.paymentagency = PAYAGENCY.idreg
LEFT OUTER JOIN registry REFAGENCY
	ON C.refundagency = REFAGENCY.idreg




GO

-- VERIFICA DI configview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'configview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'accruedcost_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'accruedcost_acc',col_precision = '' where tablename = 'configview' AND field = 'accruedcost_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','accruedcost_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'accruedrevenue_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'accruedrevenue_acc',col_precision = '' where tablename = 'configview' AND field = 'accruedrevenue_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','accruedrevenue_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'admincar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'admincar',col_precision = '' where tablename = 'configview' AND field = 'admincar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','admincar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'admintaxkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'admintaxkind',col_precision = '' where tablename = 'configview' AND field = 'admintaxkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','admintaxkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'appname')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(255)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '255',field = 'appname',col_precision = '' where tablename = 'configview' AND field = 'appname'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(255)','N','configview','N','','255','appname','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'appropriationphase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'appropriationphase',col_precision = '' where tablename = 'configview' AND field = 'appropriationphase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','appropriationphase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'appropriationphasecode')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'appropriationphasecode',col_precision = '' where tablename = 'configview' AND field = 'appropriationphasecode'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','appropriationphasecode','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'assessmentphase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'assessmentphase',col_precision = '' where tablename = 'configview' AND field = 'assessmentphase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','assessmentphase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'assessmentphasecode')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'assessmentphasecode',col_precision = '' where tablename = 'configview' AND field = 'assessmentphasecode'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','assessmentphasecode','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'asset_flagnumbering')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'asset_flagnumbering',col_precision = '' where tablename = 'configview' AND field = 'asset_flagnumbering'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','asset_flagnumbering','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'asset_flagrestart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'asset_flagrestart',col_precision = '' where tablename = 'configview' AND field = 'asset_flagrestart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','asset_flagrestart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'assetload_flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'assetload_flag',col_precision = '' where tablename = 'configview' AND field = 'assetload_flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','assetload_flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'ayear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'configview',denynull = 'S',format = '',col_len = '2',field = 'ayear',col_precision = '' where tablename = 'configview' AND field = 'ayear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','configview','S','','2','ayear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'boxpartitiontitle')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'boxpartitiontitle',col_precision = '' where tablename = 'configview' AND field = 'boxpartitiontitle'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','boxpartitiontitle','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'cashvaliditykind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'cashvaliditykind',col_precision = '' where tablename = 'configview' AND field = 'cashvaliditykind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','cashvaliditykind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'casualcontract_flagnumbering')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'casualcontract_flagnumbering',col_precision = '' where tablename = 'configview' AND field = 'casualcontract_flagnumbering'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','casualcontract_flagnumbering','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'casualcontract_flagrestart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'casualcontract_flagrestart',col_precision = '' where tablename = 'configview' AND field = 'casualcontract_flagrestart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','casualcontract_flagrestart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'clawback')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'clawback',col_precision = '' where tablename = 'configview' AND field = 'clawback'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','clawback','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'clawbackkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'clawbackkind',col_precision = '' where tablename = 'configview' AND field = 'clawbackkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','clawbackkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_accruedcost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_accruedcost',col_precision = '' where tablename = 'configview' AND field = 'codeacc_accruedcost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_accruedcost','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_accruedrevenue')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_accruedrevenue',col_precision = '' where tablename = 'configview' AND field = 'codeacc_accruedrevenue'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_accruedrevenue','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_customer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_customer',col_precision = '' where tablename = 'configview' AND field = 'codeacc_customer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_customer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_deferredcost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_deferredcost',col_precision = '' where tablename = 'configview' AND field = 'codeacc_deferredcost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_deferredcost','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_deferredrevenue')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_deferredrevenue',col_precision = '' where tablename = 'configview' AND field = 'codeacc_deferredrevenue'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_deferredrevenue','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_ivapayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_ivapayment',col_precision = '' where tablename = 'configview' AND field = 'codeacc_ivapayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_ivapayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_ivarefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_ivarefund',col_precision = '' where tablename = 'configview' AND field = 'codeacc_ivarefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_ivarefund','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_patrimony')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_patrimony',col_precision = '' where tablename = 'configview' AND field = 'codeacc_patrimony'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_patrimony','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_pl')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_pl',col_precision = '' where tablename = 'configview' AND field = 'codeacc_pl'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_pl','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codeacc_supplier')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codeacc_supplier',col_precision = '' where tablename = 'configview' AND field = 'codeacc_supplier'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codeacc_supplier','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codefinexpense')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codefinexpense',col_precision = '' where tablename = 'configview' AND field = 'codefinexpense'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codefinexpense','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codefinexpensesurplus')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codefinexpensesurplus',col_precision = '' where tablename = 'configview' AND field = 'codefinexpensesurplus'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codefinexpensesurplus','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codefinincomesurplus')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codefinincomesurplus',col_precision = '' where tablename = 'configview' AND field = 'codefinincomesurplus'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codefinincomesurplus','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codefinivapayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codefinivapayment',col_precision = '' where tablename = 'configview' AND field = 'codefinivapayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codefinivapayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codefinivarefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codefinivarefund',col_precision = '' where tablename = 'configview' AND field = 'codefinivarefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codefinivarefund','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codemotive_admincar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codemotive_admincar',col_precision = '' where tablename = 'configview' AND field = 'codemotive_admincar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codemotive_admincar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codemotive_foot')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codemotive_foot',col_precision = '' where tablename = 'configview' AND field = 'codemotive_foot'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codemotive_foot','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'codemotive_owncar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'codemotive_owncar',col_precision = '' where tablename = 'configview' AND field = 'codemotive_owncar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','codemotive_owncar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'configview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'configview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','configview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'configview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'configview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','configview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'currpartitiontitle')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '20',field = 'currpartitiontitle',col_precision = '' where tablename = 'configview' AND field = 'currpartitiontitle'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','configview','N','','20','currpartitiontitle','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'customer_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'customer_acc',col_precision = '' where tablename = 'configview' AND field = 'customer_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','customer_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'deferredcost_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'deferredcost_acc',col_precision = '' where tablename = 'configview' AND field = 'deferredcost_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','deferredcost_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'deferredexpensephase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'deferredexpensephase',col_precision = '' where tablename = 'configview' AND field = 'deferredexpensephase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','deferredexpensephase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'deferredincomephase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'deferredincomephase',col_precision = '' where tablename = 'configview' AND field = 'deferredincomephase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','deferredincomephase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'deferredrevenue_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'deferredrevenue_acc',col_precision = '' where tablename = 'configview' AND field = 'deferredrevenue_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','deferredrevenue_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'electronicimport')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'electronicimport',col_precision = '' where tablename = 'configview' AND field = 'electronicimport'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','electronicimport','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'electronictrasmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'electronictrasmission',col_precision = '' where tablename = 'configview' AND field = 'electronictrasmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','electronictrasmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'employtaxkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'employtaxkind',col_precision = '' where tablename = 'configview' AND field = 'employtaxkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','employtaxkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'estimate_numerationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'estimate_numerationkind',col_precision = '' where tablename = 'configview' AND field = 'estimate_numerationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','estimate_numerationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'expense_expiringdays')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '2',field = 'expense_expiringdays',col_precision = '' where tablename = 'configview' AND field = 'expense_expiringdays'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','configview','N','','2','expense_expiringdays','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'expensephase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'expensephase',col_precision = '' where tablename = 'configview' AND field = 'expensephase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','expensephase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'expensephasedescr')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'expensephasedescr',col_precision = '' where tablename = 'configview' AND field = 'expensephasedescr'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','expensephasedescr','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'finexpense')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'finexpense',col_precision = '' where tablename = 'configview' AND field = 'finexpense'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','finexpense','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'finexpensesurplus')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'finexpensesurplus',col_precision = '' where tablename = 'configview' AND field = 'finexpensesurplus'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','finexpensesurplus','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'finincomesurplus')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'finincomesurplus',col_precision = '' where tablename = 'configview' AND field = 'finincomesurplus'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','finincomesurplus','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'finivarefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'finivarefund',col_precision = '' where tablename = 'configview' AND field = 'finivarefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','finivarefund','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagadmintax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagadmintax',col_precision = '' where tablename = 'configview' AND field = 'flagadmintax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagadmintax','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagarrearsadmintax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagarrearsadmintax',col_precision = '' where tablename = 'configview' AND field = 'flagarrearsadmintax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagarrearsadmintax','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagautopayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagautopayment',col_precision = '' where tablename = 'configview' AND field = 'flagautopayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagautopayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagautoproceeds')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagautoproceeds',col_precision = '' where tablename = 'configview' AND field = 'flagautoproceeds'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagautoproceeds','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagclawback')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagclawback',col_precision = '' where tablename = 'configview' AND field = 'flagclawback'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagclawback','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagcredit')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagcredit',col_precision = '' where tablename = 'configview' AND field = 'flagcredit'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagcredit','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagepexp')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagepexp',col_precision = '' where tablename = 'configview' AND field = 'flagepexp'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagepexp','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagfruitful')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagfruitful',col_precision = '' where tablename = 'configview' AND field = 'flagfruitful'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagfruitful','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagpayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagpayment',col_precision = '' where tablename = 'configview' AND field = 'flagpayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagpayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagproceeds')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagproceeds',col_precision = '' where tablename = 'configview' AND field = 'flagproceeds'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagproceeds','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagrefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagrefund',col_precision = '' where tablename = 'configview' AND field = 'flagrefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagrefund','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagtax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagtax',col_precision = '' where tablename = 'configview' AND field = 'flagtax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagtax','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'flagtaxcompetency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'flagtaxcompetency',col_precision = '' where tablename = 'configview' AND field = 'flagtaxcompetency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','flagtaxcompetency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'foot')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'foot',col_precision = '' where tablename = 'configview' AND field = 'foot'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','foot','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'foreignhours')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'foreignhours',col_precision = '' where tablename = 'configview' AND field = 'foreignhours'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','foreignhours','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_accruedcost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_accruedcost',col_precision = '' where tablename = 'configview' AND field = 'idacc_accruedcost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_accruedcost','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_accruedrevenue')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_accruedrevenue',col_precision = '' where tablename = 'configview' AND field = 'idacc_accruedrevenue'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_accruedrevenue','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_customer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_customer',col_precision = '' where tablename = 'configview' AND field = 'idacc_customer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_customer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_deferredcost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_deferredcost',col_precision = '' where tablename = 'configview' AND field = 'idacc_deferredcost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_deferredcost','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_deferredrevenue')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_deferredrevenue',col_precision = '' where tablename = 'configview' AND field = 'idacc_deferredrevenue'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_deferredrevenue','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_ivapayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_ivapayment',col_precision = '' where tablename = 'configview' AND field = 'idacc_ivapayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_ivapayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_ivarefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_ivarefund',col_precision = '' where tablename = 'configview' AND field = 'idacc_ivarefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_ivarefund','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_patrimony')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_patrimony',col_precision = '' where tablename = 'configview' AND field = 'idacc_patrimony'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_patrimony','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_pl')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_pl',col_precision = '' where tablename = 'configview' AND field = 'idacc_pl'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_pl','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idacc_supplier')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '38',field = 'idacc_supplier',col_precision = '' where tablename = 'configview' AND field = 'idacc_supplier'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','configview','N','','38','idacc_supplier','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idaccmotive_admincar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive_admincar',col_precision = '' where tablename = 'configview' AND field = 'idaccmotive_admincar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','configview','N','','36','idaccmotive_admincar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idaccmotive_foot')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive_foot',col_precision = '' where tablename = 'configview' AND field = 'idaccmotive_foot'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','configview','N','','36','idaccmotive_foot','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idaccmotive_owncar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive_owncar',col_precision = '' where tablename = 'configview' AND field = 'idaccmotive_owncar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','configview','N','','36','idaccmotive_owncar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idclawback')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idclawback',col_precision = '' where tablename = 'configview' AND field = 'idclawback'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idclawback','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idfinexpense')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idfinexpense',col_precision = '' where tablename = 'configview' AND field = 'idfinexpense'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idfinexpense','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idfinexpensesurplus')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idfinexpensesurplus',col_precision = '' where tablename = 'configview' AND field = 'idfinexpensesurplus'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idfinexpensesurplus','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idfinincomesurplus')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idfinincomesurplus',col_precision = '' where tablename = 'configview' AND field = 'idfinincomesurplus'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idfinincomesurplus','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idfinivapayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idfinivapayment',col_precision = '' where tablename = 'configview' AND field = 'idfinivapayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idfinivapayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idfinivarefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idfinivarefund',col_precision = '' where tablename = 'configview' AND field = 'idfinivarefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idfinivarefund','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idivapayperiodicity')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idivapayperiodicity',col_precision = '' where tablename = 'configview' AND field = 'idivapayperiodicity'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idivapayperiodicity','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idregauto')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'idregauto',col_precision = '' where tablename = 'configview' AND field = 'idregauto'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','idregauto','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idsortingkind1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '20',field = 'idsortingkind1',col_precision = '' where tablename = 'configview' AND field = 'idsortingkind1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','configview','N','','20','idsortingkind1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idsortingkind2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '20',field = 'idsortingkind2',col_precision = '' where tablename = 'configview' AND field = 'idsortingkind2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','configview','N','','20','idsortingkind2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'idsortingkind3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '20',field = 'idsortingkind3',col_precision = '' where tablename = 'configview' AND field = 'idsortingkind3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','configview','N','','20','idsortingkind3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'importappname')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(255)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '255',field = 'importappname',col_precision = '' where tablename = 'configview' AND field = 'importappname'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(255)','N','configview','N','','255','importappname','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'incmephasedescr')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'incmephasedescr',col_precision = '' where tablename = 'configview' AND field = 'incmephasedescr'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','incmephasedescr','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'income_expiringdays')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '2',field = 'income_expiringdays',col_precision = '' where tablename = 'configview' AND field = 'income_expiringdays'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','configview','N','','2','income_expiringdays','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'incomephase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'incomephase',col_precision = '' where tablename = 'configview' AND field = 'incomephase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','incomephase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'invoice_numerationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'invoice_numerationkind',col_precision = '' where tablename = 'configview' AND field = 'invoice_numerationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','invoice_numerationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'ivapayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'ivapayment',col_precision = '' where tablename = 'configview' AND field = 'ivapayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','ivapayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'ivapayment_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'ivapayment_acc',col_precision = '' where tablename = 'configview' AND field = 'ivapayment_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','ivapayment_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'ivapayperiodicity')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'ivapayperiodicity',col_precision = '' where tablename = 'configview' AND field = 'ivapayperiodicity'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','ivapayperiodicity','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'ivarefund_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'ivarefund_acc',col_precision = '' where tablename = 'configview' AND field = 'ivarefund_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','ivarefund_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'linktoinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'linktoinvoice',col_precision = '' where tablename = 'configview' AND field = 'linktoinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','linktoinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'configview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'configview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','configview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'configview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'configview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','configview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'mandate_numerationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'mandate_numerationkind',col_precision = '' where tablename = 'configview' AND field = 'mandate_numerationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','mandate_numerationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'minpayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '9',field = 'minpayment',col_precision = '19' where tablename = 'configview' AND field = 'minpayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','configview','N','','9','minpayment','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'minrefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '9',field = 'minrefund',col_precision = '19' where tablename = 'configview' AND field = 'minrefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','configview','N','','9','minrefund','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'motivelen')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '2',field = 'motivelen',col_precision = '' where tablename = 'configview' AND field = 'motivelen'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','configview','N','','2','motivelen','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'motiveprefix')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '20',field = 'motiveprefix',col_precision = '' where tablename = 'configview' AND field = 'motiveprefix'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','configview','N','','20','motiveprefix','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'motiveseparator')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'motiveseparator',col_precision = '' where tablename = 'configview' AND field = 'motiveseparator'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','motiveseparator','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'owncar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'owncar',col_precision = '' where tablename = 'configview' AND field = 'owncar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','owncar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'parasubcontract_numerationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'parasubcontract_numerationkind',col_precision = '' where tablename = 'configview' AND field = 'parasubcontract_numerationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','parasubcontract_numerationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'patrimony_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'patrimony_acc',col_precision = '' where tablename = 'configview' AND field = 'patrimony_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','patrimony_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'pay_finleveldescr')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'pay_finleveldescr',col_precision = '' where tablename = 'configview' AND field = 'pay_finleveldescr'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','pay_finleveldescr','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'payment_finlevel')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'payment_finlevel',col_precision = '' where tablename = 'configview' AND field = 'payment_finlevel'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','payment_finlevel','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'payment_flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'payment_flag',col_precision = '' where tablename = 'configview' AND field = 'payment_flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','payment_flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'payment_flagautoprintdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'payment_flagautoprintdate',col_precision = '' where tablename = 'configview' AND field = 'payment_flagautoprintdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','payment_flagautoprintdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'paymentagency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'paymentagency',col_precision = '' where tablename = 'configview' AND field = 'paymentagency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','paymentagency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'paymentagency_title')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '100',field = 'paymentagency_title',col_precision = '' where tablename = 'configview' AND field = 'paymentagency_title'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','configview','N','','100','paymentagency_title','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'payments_groupingkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'payments_groupingkind',col_precision = '' where tablename = 'configview' AND field = 'payments_groupingkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','payments_groupingkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'pl_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'pl_acc',col_precision = '' where tablename = 'configview' AND field = 'pl_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','pl_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'previsionkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'previsionkind',col_precision = '' where tablename = 'configview' AND field = 'previsionkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','previsionkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'prevpartitiontitle')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'prevpartitiontitle',col_precision = '' where tablename = 'configview' AND field = 'prevpartitiontitle'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','prevpartitiontitle','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'pro_finleveldescr')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'pro_finleveldescr',col_precision = '' where tablename = 'configview' AND field = 'pro_finleveldescr'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','pro_finleveldescr','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'proceeds_finlevel')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'proceeds_finlevel',col_precision = '' where tablename = 'configview' AND field = 'proceeds_finlevel'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','proceeds_finlevel','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'proceeds_flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'proceeds_flag',col_precision = '' where tablename = 'configview' AND field = 'proceeds_flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','configview','N','','1','proceeds_flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'proceeds_flagautoprintdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'proceeds_flagautoprintdate',col_precision = '' where tablename = 'configview' AND field = 'proceeds_flagautoprintdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','proceeds_flagautoprintdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'proceeds_groupingkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'proceeds_groupingkind',col_precision = '' where tablename = 'configview' AND field = 'proceeds_groupingkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','proceeds_groupingkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'profservice_flagnumbering')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'profservice_flagnumbering',col_precision = '' where tablename = 'configview' AND field = 'profservice_flagnumbering'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','profservice_flagnumbering','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'profservice_flagrestart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'profservice_flagrestart',col_precision = '' where tablename = 'configview' AND field = 'profservice_flagrestart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','profservice_flagrestart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'refundagency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '4',field = 'refundagency',col_precision = '' where tablename = 'configview' AND field = 'refundagency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','configview','N','','4','refundagency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'refundagency_title')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '100',field = 'refundagency_title',col_precision = '' where tablename = 'configview' AND field = 'refundagency_title'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','configview','N','','100','refundagency_title','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'configview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','configview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'secprevisionkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'secprevisionkind',col_precision = '' where tablename = 'configview' AND field = 'secprevisionkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','secprevisionkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'sorting1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'sorting1',col_precision = '' where tablename = 'configview' AND field = 'sorting1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','sorting1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'sorting2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'sorting2',col_precision = '' where tablename = 'configview' AND field = 'sorting2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','sorting2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'sorting3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '50',field = 'sorting3',col_precision = '' where tablename = 'configview' AND field = 'sorting3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','configview','N','','50','sorting3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'supplier_acc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '150',field = 'supplier_acc',col_precision = '' where tablename = 'configview' AND field = 'supplier_acc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','configview','N','','150','supplier_acc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'wageaddition_flagnumbering')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'wageaddition_flagnumbering',col_precision = '' where tablename = 'configview' AND field = 'wageaddition_flagnumbering'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','wageaddition_flagnumbering','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'configview' AND field = 'wageaddition_flagrestart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'configview',denynull = 'N',format = '',col_len = '1',field = 'wageaddition_flagrestart',col_precision = '' where tablename = 'configview' AND field = 'wageaddition_flagrestart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','configview','N','','1','wageaddition_flagrestart','')
GO

-- VERIFICA DI configview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'configview')
UPDATE customobject set isreal = 'N' where objectname = 'configview'
ELSE
INSERT INTO customobject (objectname, isreal) values('configview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA estimatedetailtoinvoice
IF EXISTS(select * from sysobjects where id = object_id(N'[estimatedetailtoinvoice]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [estimatedetailtoinvoice]
GO


CREATE  VIEW [estimatedetailtoinvoice]
(
	idestimkind,
	yestim,
	nestim,
	rownum,
	idgroup,
	estimatekind,
	idreg,
	registry,
	idcurrency,
	codecurrency, 
	detaildescription,
	ordered,
	invoiced,
	residual,
	taxrate,
	taxable,
	tax,
	discount,
	start,
	stop,
	competencystart,
	competencystop,
	idupb,
	idsor1,
	idsor2,
	idsor3,
	idaccmotive,
	idivakind,
	ivakind,
	toinvoice,
	linktoinvoice,
	multireg
)
AS SELECT 
	estimatedetail.idestimkind,
	estimatedetail.yestim, 
	estimatedetail.nestim, 
	estimatedetail.rownum, 
	estimatedetail.idgroup,
	estimatekind.description,
	--estimate.idreg,
	CASE
		WHEN (estimate.idreg is not null) THEN (estimate.idreg)
		WHEN (estimatedetail.idreg is not null) THEN (estimatedetail.idreg)
		ELSE null
	END,
	--registry.title, 
	CASE
		WHEN (estimate.idreg is not null) THEN (select title from
						registry 
						where idreg= estimate.idreg)
		WHEN (estimatedetail.idreg is not null) THEN (select title from
						registry 
						where idreg= estimatedetail.idreg)
		ELSE null
	END, 
	estimate.idcurrency,
	currency.codecurrency,
	estimatedetail.detaildescription, 
	estimatedetail.number,		-- ordered
	/*(SELECT ISNULL(SUM(number), 0)
		FROM invoicedetail
		WHERE estimatedetail.idestimkind = invoicedetail.idestimkind
		AND estimatedetail.yestim = invoicedetail.yestim
		AND estimatedetail.nestim = invoicedetail.nestim
		AND estimatedetail.rownum = invoicedetail.estimrownum), 	*/
	(SELECT  SUM (iv.number)
	FROM (SELECT DISTINCT number,idestimkind,yestim,nestim,estimrownum,idgroup
		FROM invoicedetail) 
		AS iv
	WHERE estimatedetail.idestimkind = iv.idestimkind
		AND estimatedetail.yestim = iv.yestim
		AND estimatedetail.nestim = iv.nestim
		AND estimatedetail.rownum = iv.estimrownum 
	),		-- invoiced
	/*ISNULL(estimatedetail.number, 0) -
	(SELECT ISNULL(SUM(number), 0)
		FROM invoicedetail
		WHERE estimatedetail.idestimkind = invoicedetail.idestimkind
		AND estimatedetail.yestim = invoicedetail.yestim
		AND estimatedetail.nestim = invoicedetail.nestim
		AND estimatedetail.rownum = invoicedetail.estimrownum), */
	ISNULL(estimatedetail.number, 0) 
	- (SELECT  SUM (iv.number)
   	   FROM (SELECT DISTINCT number,idestimkind,yestim,nestim,estimrownum,idgroup
		FROM invoicedetail) 
		AS iv
	  WHERE estimatedetail.idestimkind = iv.idestimkind
		AND estimatedetail.yestim = iv.yestim
		AND estimatedetail.nestim = iv.nestim
		AND estimatedetail.rownum = iv.estimrownum 
	), 	-- residual
	estimatedetail.taxrate,
	estimatedetail.taxable,
	estimatedetail.tax,
	estimatedetail.discount,
	estimatedetail.start,
	estimatedetail.stop,
	estimatedetail.competencystart,
	estimatedetail.competencystop,
	estimatedetail.idupb,
	estimatedetail.idsor1,
	estimatedetail.idsor2,
	estimatedetail.idsor3,
	estimatedetail.idaccmotive,
	estimatedetail.idivakind,
	ivakind.description,
	estimatedetail.toinvoice,
	estimatekind.linktoinvoice,
	estimatekind.multireg
	FROM estimatedetail WITH (NOLOCK)
	JOIN estimatekind
	ON estimatekind.idestimkind = estimatedetail.idestimkind
	INNER JOIN estimate WITH (NOLOCK)
	ON estimate.idestimkind = estimatedetail.idestimkind
	AND estimate.yestim = estimatedetail.yestim
	AND estimate.nestim = estimatedetail.nestim
	--INNER JOIN registry WITH (NOLOCK) ON registry.idreg = estimate.idreg
	LEFT OUTER JOIN ivakind
	ON ivakind.idivakind = estimatedetail.idivakind
	LEFT OUTER JOIN currency
	ON currency.idcurrency = estimate.idcurrency
	WHERE estimatedetail.stop is null

GO

-- VERIFICA DI estimatedetailtoinvoice IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'estimatedetailtoinvoice'
IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','estimatedetailtoinvoice','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'competencystart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'competencystart',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'competencystart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailtoinvoice','N','','8','competencystart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'competencystop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'competencystop',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'competencystop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailtoinvoice','N','','8','competencystop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimatedetailtoinvoice','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','estimatedetailtoinvoice','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'estimatekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'S',format = '',col_len = '150',field = 'estimatekind',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'estimatekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','estimatedetailtoinvoice','S','','150','estimatekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','estimatedetailtoinvoice','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailtoinvoice','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idestimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'S',format = '',col_len = '20',field = 'idestimkind',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idestimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','estimatedetailtoinvoice','S','','20','idestimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idgroup',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailtoinvoice','N','','4','idgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailtoinvoice','N','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailtoinvoice','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idsor1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '32',field = 'idsor1',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idsor1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','estimatedetailtoinvoice','N','','32','idsor1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idsor2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '32',field = 'idsor2',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idsor2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','estimatedetailtoinvoice','N','','32','idsor2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idsor3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '32',field = 'idsor3',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idsor3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','estimatedetailtoinvoice','N','','32','idsor3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','estimatedetailtoinvoice','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'invoiced')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '17',field = 'invoiced',col_precision = '38' where tablename = 'estimatedetailtoinvoice' AND field = 'invoiced'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','estimatedetailtoinvoice','N','','17','invoiced','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatedetailtoinvoice','N','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'linktoinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'linktoinvoice',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'linktoinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','estimatedetailtoinvoice','N','','1','linktoinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'multireg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'multireg',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'multireg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','estimatedetailtoinvoice','N','','1','multireg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'nestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'S',format = '',col_len = '4',field = 'nestim',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'nestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','estimatedetailtoinvoice','S','','4','nestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'ordered')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '9',field = 'ordered',col_precision = '19' where tablename = 'estimatedetailtoinvoice' AND field = 'ordered'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','estimatedetailtoinvoice','N','','9','ordered','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','estimatedetailtoinvoice','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '17',field = 'residual',col_precision = '38' where tablename = 'estimatedetailtoinvoice' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','estimatedetailtoinvoice','N','','17','residual','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'rownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'S',format = '',col_len = '4',field = 'rownum',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'rownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','estimatedetailtoinvoice','S','','4','rownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailtoinvoice','N','','8','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'stop',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailtoinvoice','N','','8','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '9',field = 'tax',col_precision = '19' where tablename = 'estimatedetailtoinvoice' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','estimatedetailtoinvoice','N','','9','tax','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,5)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '9',field = 'taxable',col_precision = '19' where tablename = 'estimatedetailtoinvoice' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(19,5)','N','estimatedetailtoinvoice','N','','9','taxable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'taxrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'taxrate',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'taxrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','estimatedetailtoinvoice','N','','8','taxrate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'toinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'toinvoice',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'toinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','estimatedetailtoinvoice','N','','1','toinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailtoinvoice' AND field = 'yestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'estimatedetailtoinvoice',denynull = 'S',format = '',col_len = '2',field = 'yestim',col_precision = '' where tablename = 'estimatedetailtoinvoice' AND field = 'yestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','estimatedetailtoinvoice','S','','2','yestim','')
GO

-- VERIFICA DI estimatedetailtoinvoice IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'estimatedetailtoinvoice')
UPDATE customobject set isreal = 'N' where objectname = 'estimatedetailtoinvoice'
ELSE
INSERT INTO customobject (objectname, isreal) values('estimatedetailtoinvoice', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA estimatedetailview
IF EXISTS(select * from sysobjects where id = object_id(N'[estimatedetailview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [estimatedetailview]
GO


CREATE  VIEW [estimatedetailview]
(
	idestimkind,
	yestim,
	nestim,
	rownum,
	idgroup,
	estimkind,
  	idreg,
  	registry,
	detaildescription,
	annotations,
	number,
	taxable,
	taxrate,
	tax,
  	discount,
	start,
	stop,
	competencystart,
	competencystop,
	idinc_taxable,
	idinc_iva,	
	taxable_euro,
	iva_euro,
	rowtotal,
	idupb,
	codeupb,
	upb,
	cu,
	ct,
	lu,
	lt,
	idaccmotive,
	codemotive,
	idsor1,
	idsor2,
	idsor3,
	sortcode1,
	sortcode2,
	sortcode3,
	idivakind,
	ivakind,
	toinvoice,
	exchangerate,
	description
)
	AS SELECT
	estimatedetail.idestimkind,
	estimatedetail.yestim,
	estimatedetail.nestim,
	estimatedetail.rownum,
	estimatedetail.idgroup,
	estimatekind.description,
 	estimatedetail.idreg,
  	registry.title,
	estimatedetail.detaildescription,
	estimatedetail.annotations,
	estimatedetail.number,
	estimatedetail.taxable,
	estimatedetail.taxrate,
	estimatedetail.tax,
  	estimatedetail.discount,
	estimatedetail.start,
	estimatedetail.stop,
	estimatedetail.competencystart,
	estimatedetail.competencystop,
	estimatedetail.idinc_taxable,
	estimatedetail.idinc_iva,
 	    ROUND(estimatedetail.taxable * estimatedetail.number * 
		  CONVERT(DECIMAL(19,6),estimate.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(estimatedetail.discount, 0.0))),2
		),
	ROUND(estimatedetail.tax * CONVERT(decimal(19,6), estimate.exchangerate),2),
 	    ROUND(estimatedetail.taxable * estimatedetail.number * 
		  CONVERT(DECIMAL(19,6),estimate.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(estimatedetail.discount, 0.0))),2
		)+
	ROUND(estimatedetail.tax * CONVERT(decimal(19,6), estimate.exchangerate),2),
	estimatedetail.idupb,
	upb.codeupb,
	upb.title,
	estimatedetail.cu,
	estimatedetail.ct,
	estimatedetail.lu,
	estimatedetail.lt,
	estimatedetail.idaccmotive,
	accmotive.codemotive,
	estimatedetail.idsor1,
	estimatedetail.idsor2,
	estimatedetail.idsor3,
	sorting1.sortcode,
	sorting2.sortcode,
	sorting3.sortcode,
	estimatedetail.idivakind,
	ivakind.description,
	estimatedetail.toinvoice,
	estimate.exchangerate,
	estimate.description    
FROM estimatedetail
JOIN estimatekind
	ON estimatekind.idestimkind = estimatedetail.idestimkind
JOIN estimate
	ON estimate.yestim = estimatedetail.yestim
	AND estimate.nestim = estimatedetail.nestim
	AND estimate.idestimkind = estimatedetail.idestimkind
JOIN ivakind
	ON ivakind.idivakind = estimatedetail.idivakind
LEFT OUTER JOIN registry
	ON registry.idreg = estimatedetail.idreg
LEFT OUTER JOIN upb
	ON upb.idupb = estimatedetail.idupb
LEFT OUTER JOIN accmotive
	ON accmotive.idaccmotive = estimatedetail.idaccmotive
LEFT OUTER JOIN config
	ON config.ayear = estimatedetail.yestim
LEFT OUTER JOIN sorting sorting1
	ON sorting1.idsorkind = config.idsortingkind1
	AND sorting1.idsor = estimatedetail.idsor1
LEFT OUTER JOIN sorting sorting2
	ON sorting2.idsorkind = config.idsortingkind2
	AND sorting2.idsor = estimatedetail.idsor2
LEFT OUTER JOIN sorting sorting3
	ON sorting3.idsorkind = config.idsortingkind3
	AND sorting3.idsor = estimatedetail.idsor3



GO

-- VERIFICA DI estimatedetailview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'estimatedetailview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'annotations')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(400)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '400',field = 'annotations',col_precision = '' where tablename = 'estimatedetailview' AND field = 'annotations'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(400)','N','estimatedetailview','N','','400','annotations','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'codemotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '50',field = 'codemotive',col_precision = '' where tablename = 'estimatedetailview' AND field = 'codemotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatedetailview','N','','50','codemotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'codeupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '50',field = 'codeupb',col_precision = '' where tablename = 'estimatedetailview' AND field = 'codeupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatedetailview','N','','50','codeupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'competencystart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '8',field = 'competencystart',col_precision = '' where tablename = 'estimatedetailview' AND field = 'competencystart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailview','N','','8','competencystart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'competencystop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '8',field = 'competencystop',col_precision = '' where tablename = 'estimatedetailview' AND field = 'competencystop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailview','N','','8','competencystop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'estimatedetailview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','estimatedetailview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'estimatedetailview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','estimatedetailview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'estimatedetailview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','estimatedetailview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'estimatedetailview' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimatedetailview','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'estimatedetailview' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','estimatedetailview','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'estimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '150',field = 'estimkind',col_precision = '' where tablename = 'estimatedetailview' AND field = 'estimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','estimatedetailview','S','','150','estimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'estimatedetailview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','estimatedetailview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','estimatedetailview','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idestimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '20',field = 'idestimkind',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idestimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','estimatedetailview','S','','20','idestimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idgroup',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailview','N','','4','idgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idinc_iva')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idinc_iva',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idinc_iva'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailview','N','','4','idinc_iva','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idinc_taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idinc_taxable',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idinc_taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailview','N','','4','idinc_taxable','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailview','N','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatedetailview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idsor1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '32',field = 'idsor1',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idsor1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','estimatedetailview','N','','32','idsor1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idsor2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '32',field = 'idsor2',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idsor2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','estimatedetailview','N','','32','idsor2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idsor3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '32',field = 'idsor3',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idsor3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','estimatedetailview','N','','32','idsor3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'estimatedetailview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','estimatedetailview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'iva_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '17',field = 'iva_euro',col_precision = '38' where tablename = 'estimatedetailview' AND field = 'iva_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','S','System.Decimal','decimal(38,7)','N','estimatedetailview','N','','17','iva_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'estimatedetailview' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','estimatedetailview','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'estimatedetailview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','estimatedetailview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'estimatedetailview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','estimatedetailview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'nestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '4',field = 'nestim',col_precision = '' where tablename = 'estimatedetailview' AND field = 'nestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','estimatedetailview','S','','4','nestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'number')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '9',field = 'number',col_precision = '19' where tablename = 'estimatedetailview' AND field = 'number'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','estimatedetailview','N','','9','number','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'estimatedetailview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','estimatedetailview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'rownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '4',field = 'rownum',col_precision = '' where tablename = 'estimatedetailview' AND field = 'rownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','estimatedetailview','S','','4','rownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'rowtotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '17',field = 'rowtotal',col_precision = '38' where tablename = 'estimatedetailview' AND field = 'rowtotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','estimatedetailview','N','','17','rowtotal','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'sortcode1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '50',field = 'sortcode1',col_precision = '' where tablename = 'estimatedetailview' AND field = 'sortcode1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatedetailview','N','','50','sortcode1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'sortcode2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '50',field = 'sortcode2',col_precision = '' where tablename = 'estimatedetailview' AND field = 'sortcode2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatedetailview','N','','50','sortcode2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'sortcode3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '50',field = 'sortcode3',col_precision = '' where tablename = 'estimatedetailview' AND field = 'sortcode3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatedetailview','N','','50','sortcode3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'estimatedetailview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailview','N','','8','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '8',field = 'stop',col_precision = '' where tablename = 'estimatedetailview' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','estimatedetailview','N','','8','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '9',field = 'tax',col_precision = '19' where tablename = 'estimatedetailview' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','estimatedetailview','N','','9','tax','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,5)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '9',field = 'taxable',col_precision = '19' where tablename = 'estimatedetailview' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(19,5)','N','estimatedetailview','N','','9','taxable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'taxable_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '17',field = 'taxable_euro',col_precision = '38' where tablename = 'estimatedetailview' AND field = 'taxable_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','estimatedetailview','N','','17','taxable_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'taxrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '8',field = 'taxrate',col_precision = '' where tablename = 'estimatedetailview' AND field = 'taxrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','estimatedetailview','N','','8','taxrate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'toinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '1',field = 'toinvoice',col_precision = '' where tablename = 'estimatedetailview' AND field = 'toinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','estimatedetailview','N','','1','toinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatedetailview',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'estimatedetailview' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimatedetailview','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatedetailview' AND field = 'yestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'estimatedetailview',denynull = 'S',format = '',col_len = '2',field = 'yestim',col_precision = '' where tablename = 'estimatedetailview' AND field = 'yestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','estimatedetailview','S','','2','yestim','')
GO

-- VERIFICA DI estimatedetailview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'estimatedetailview')
UPDATE customobject set isreal = 'N' where objectname = 'estimatedetailview'
ELSE
INSERT INTO customobject (objectname, isreal) values('estimatedetailview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA estimatelinked
IF EXISTS(select * from sysobjects where id = object_id(N'[estimatelinked]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [estimatelinked]
GO







CREATE                          VIEW [estimatelinked]
(
	ayear,
	idestimkind, yestim, nestim, estimkind,
	idreg, registry, registryreference, idman, 
	manager,	
	description, deliveryexpiration, deliveryaddress, paymentexpiring, 
	idexpirationkind, idcurrency, 	codecurrency, currency,
	exchangerate, doc, docdate, adate, officiallyprinted,
	txt, rtf,
	cu, ct, lu, lt
)
AS
SELECT
	accountingyear.ayear,
	estimate.idestimkind, estimate.yestim, estimate.nestim, estimatekind.description,
	estimate.idreg, registry.title, estimate.registryreference, estimate.idman, 
	manager.title,
	estimate.description, deliveryexpiration,
	deliveryaddress, paymentexpiring, 
	idexpirationkind, estimate.idcurrency, currency.codecurrency,
	currency.description,
	estimate.exchangerate, estimate.doc, 
	estimate.docdate, adate, officiallyprinted,
	estimate.txt, estimate.rtf, 
	estimate.cu, estimate.ct, estimate.lu, estimate.lt
FROM estimate (NOLOCK)
JOIN estimatekind
	ON estimatekind.idestimkind = estimate.idestimkind
INNER JOIN incomeestimate WITH (NOLOCK)
	ON estimate.idestimkind = incomeestimate.idestimkind
	AND estimate.yestim = incomeestimate.yestim
	AND estimate.nestim = incomeestimate.nestim	
	LEFT OUTER JOIN registry (NOLOCK)
	ON registry.idreg = estimate.idreg
	LEFT OUTER JOIN currency (NOLOCK)
	ON currency.idcurrency = estimate.idcurrency
	LEFT OUTER JOIN manager (NOLOCK)
	ON manager.idman = estimate.idman
	CROSS JOIN accountingyear
	WHERE EXISTS (SELECT * FROM incomeestimate AS MM 
			JOIN incomeyear II
			  ON II.idinc=MM.idinc
			 AND MM.idestimkind = estimate.idestimkind
			 AND MM.yestim=estimate.yestim
			 AND MM.nestim=estimate.nestim
		      WHERE  II.ayear = accountingyear.ayear) 
			
	





GO

-- VERIFICA DI estimatelinked IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'estimatelinked'
IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'estimatelinked' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','estimatelinked','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'ayear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '2',field = 'ayear',col_precision = '' where tablename = 'estimatelinked' AND field = 'ayear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','estimatelinked','S','','2','ayear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'estimatelinked' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','estimatelinked','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'estimatelinked' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','estimatelinked','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'estimatelinked' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','estimatelinked','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'estimatelinked' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatelinked','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'deliveryaddress')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '150',field = 'deliveryaddress',col_precision = '' where tablename = 'estimatelinked' AND field = 'deliveryaddress'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimatelinked','N','','150','deliveryaddress','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'deliveryexpiration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '50',field = 'deliveryexpiration',col_precision = '' where tablename = 'estimatelinked' AND field = 'deliveryexpiration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimatelinked','N','','50','deliveryexpiration','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'estimatelinked' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','estimatelinked','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'estimatelinked' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','estimatelinked','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'estimatelinked' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','estimatelinked','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'estimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '150',field = 'estimkind',col_precision = '' where tablename = 'estimatelinked' AND field = 'estimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','estimatelinked','S','','150','estimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'estimatelinked' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','estimatelinked','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'estimatelinked' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatelinked','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'idestimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '20',field = 'idestimkind',col_precision = '' where tablename = 'estimatelinked' AND field = 'idestimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','estimatelinked','S','','20','idestimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'estimatelinked' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','estimatelinked','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'estimatelinked' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatelinked','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'estimatelinked' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimatelinked','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'estimatelinked' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','estimatelinked','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'estimatelinked' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','estimatelinked','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'estimatelinked' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimatelinked','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'nestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '4',field = 'nestim',col_precision = '' where tablename = 'estimatelinked' AND field = 'nestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','estimatelinked','S','','4','nestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'estimatelinked' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','estimatelinked','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'estimatelinked' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','estimatelinked','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'estimatelinked' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','estimatelinked','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'estimatelinked' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimatelinked','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'rtf')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'image',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte[]',sqldeclaration = 'image',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '16',field = 'rtf',col_precision = '' where tablename = 'estimatelinked' AND field = 'rtf'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','image','','S','System.Byte[]','image','N','estimatelinked','N','','16','rtf','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'estimatelinked',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'estimatelinked' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','estimatelinked','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimatelinked' AND field = 'yestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'estimatelinked',denynull = 'S',format = '',col_len = '2',field = 'yestim',col_precision = '' where tablename = 'estimatelinked' AND field = 'yestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','estimatelinked','S','','2','yestim','')
GO

-- VERIFICA DI estimatelinked IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'estimatelinked')
UPDATE customobject set isreal = 'N' where objectname = 'estimatelinked'
ELSE
INSERT INTO customobject (objectname, isreal) values('estimatelinked', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA estimateview
IF EXISTS(select * from sysobjects where id = object_id(N'[estimateview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [estimateview]
GO







--Pino Rana, elaborazione del 10/08/2005 15:18:03
CREATE    VIEW [estimateview]
(
	idestimkind,
	yestim,
	nestim,
	estimkind,
	idreg,
	registry,
	registryreference,
	description,
	idman,
	manager,
	deliveryexpiration,
	deliveryaddress,
	paymentexpiring,
	idexpirationkind,
	idcurrency,
	codecurrency,
	currency,
	exchangerate,
	doc,
	docdate,
	adate,
	officiallyprinted,
	txt,
	cu, 
	ct, 
	lu, 
	lt,
	active
)
	AS SELECT
	estimate.idestimkind,
	estimate.yestim,
	estimate.nestim,
	estimatekind.description,
	estimate.idreg,
	registry.title,
	estimate.registryreference,
	estimate.description,
	estimate.idman,
	manager.title,
	estimate.deliveryexpiration,
	estimate.deliveryaddress,
	estimate.paymentexpiring,
	estimate.idexpirationkind,
	estimate.idcurrency,
	currency.codecurrency,
	currency.description,
	estimate.exchangerate,
	estimate.doc,
	estimate.docdate,
	estimate.adate,
	estimate.officiallyprinted,
	estimate.txt,
	estimate.cu, 
	estimate.ct, 
	estimate.lu, 
	estimate.lt,
	estimate.active
	FROM estimate (NOLOCK)
	JOIN estimatekind (NOLOCK)
	ON estimatekind.idestimkind = estimate.idestimkind
	LEFT OUTER JOIN registry (NOLOCK)
	ON registry.idreg = estimate.idreg
	LEFT OUTER JOIN currency (NOLOCK)
	ON currency.idcurrency = estimate.idcurrency
	LEFT OUTER JOIN manager (NOLOCK)
	ON manager.idman = estimate.idman










GO

-- VERIFICA DI estimateview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'estimateview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'estimateview' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','estimateview','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'estimateview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','estimateview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'estimateview' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','estimateview','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'estimateview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','estimateview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'estimateview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','estimateview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'estimateview' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimateview','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'deliveryaddress')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '150',field = 'deliveryaddress',col_precision = '' where tablename = 'estimateview' AND field = 'deliveryaddress'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimateview','N','','150','deliveryaddress','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'deliveryexpiration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '50',field = 'deliveryexpiration',col_precision = '' where tablename = 'estimateview' AND field = 'deliveryexpiration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','estimateview','N','','50','deliveryexpiration','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'estimateview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','estimateview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'estimateview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','estimateview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'estimateview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','estimateview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'estimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '150',field = 'estimkind',col_precision = '' where tablename = 'estimateview' AND field = 'estimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','estimateview','S','','150','estimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'estimateview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','estimateview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'estimateview' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimateview','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'idestimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '20',field = 'idestimkind',col_precision = '' where tablename = 'estimateview' AND field = 'idestimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','estimateview','S','','20','idestimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'estimateview' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','estimateview','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'estimateview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimateview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'estimateview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','estimateview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'estimateview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','estimateview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'estimateview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','estimateview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'estimateview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimateview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'nestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '4',field = 'nestim',col_precision = '' where tablename = 'estimateview' AND field = 'nestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','estimateview','S','','4','nestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'estimateview' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','estimateview','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'estimateview' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','estimateview','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'estimateview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','estimateview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'estimateview' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','estimateview','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'estimateview',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'estimateview' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','estimateview','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'estimateview' AND field = 'yestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'estimateview',denynull = 'S',format = '',col_len = '2',field = 'yestim',col_precision = '' where tablename = 'estimateview' AND field = 'yestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','estimateview','S','','2','yestim','')
GO

-- VERIFICA DI estimateview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'estimateview')
UPDATE customobject set isreal = 'N' where objectname = 'estimateview'
ELSE
INSERT INTO customobject (objectname, isreal) values('estimateview', 'N')
GO

-- GENERAZIONE DATI PER estimateview --
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA expenseinvoiceview
IF EXISTS(select * from sysobjects where id = object_id(N'[expenseinvoiceview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [expenseinvoiceview]
GO



--	select * from expenseinvoiceview

CREATE  VIEW expenseinvoiceview 
	(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	movkind,
	idexp,
	nphase,
	phase,
	ymov,
	nmov,
	--ycreation,
	parentidexp,
	parentymov,
	parentnmov,
	ayear,
	idfin,
	codefin,
	finance,
	idupb,
	codeupb,
	upb,
	idreg,
	registry,
	idman,
	manager,
	ypay,
	npay,
	doc,
	docdate,
	description,
	amount,
	ayearstartamount,
	curramount,
	available,
	--regmodcode,
	idpaymethod,
	cin,
	idbank,
	idcab,
	cc,
	paymentdescr,
	idser,
	service,
	servicestart,
	servicestop,
	ivaamount,
	flag, --fulfilled,autotaxflag,autoclawbackflag,
	totflag, 
	flagarrear,
	autokind,
	--idproceeds,
	idpayment,
	expiration,
	adate,
	cu,
	ct,
	lu,
	lt
	)
	AS SELECT
	expenseinvoice.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	expenseinvoice.yinv,
	expenseinvoice.ninv,
	expenseinvoice.movkind,
	expenseinvoice.idexp,
	expense.nphase,
	expensephase.description,
	expense.ymov,
	expense.nmov,
	--expense.ycreation,
	expense.parentidexp,
	parentexpense.ymov,
	parentexpense.nmov,
	expenseyear.ayear,
	expenseyear.idfin,
	fin.codefin,
	fin.title,
	upb.idupb,	
	upb.codeupb,	
	upb.title,	
	expense.idreg,
	registry.title,
	expense.idman,
	manager.title,
	expense.ymov,
	expenselast.npay,
	expense.doc,
	expense.docdate,
	expense.description,
	expenseyear_starting.amount, --expense.amount,
	expenseyear.amount,--expensetotal.amount,
	expensetotal.curramount,
	expensetotal.available,
	--expense.regmodcode,
	expenselast.idpaymethod,
	expenselast.cin,
	expenselast.idbank,
	expenselast.idcab,
	expenselast.cc,
	expenselast.paymentdescr,
	expenselast.idser,
	service.description,
	expenselast.servicestart,
	expenselast.servicestop,
	expenselast.ivaamount,
	expenselast.flag, -- expense.fulfilled,expense.autotaxflag,expense.autoclawbackflag,
	expensetotal.flag,
	CASE
		WHEN ((expensetotal.flag&1)=0) THEN 'C'
		WHEN ((expensetotal.flag&1)=1) THEN 'R'
	END, 
	expense.autokind,
	--expense.idproceeds,
	expense.idpayment,
	expense.expiration,
	expense.adate,
	expenseinvoice.cu,
	expenseinvoice.ct,
	expenseinvoice.lu,
	expenseinvoice.lt
	FROM expenseinvoice (NOLOCK)
	JOIN invoicekind (NOLOCK)
		ON invoicekind.idinvkind = expenseinvoice.idinvkind
	JOIN expense (NOLOCK) 
		ON expense.idexp = expenseinvoice.idexp
	JOIN expensephase (NOLOCK)
		ON expensephase.nphase = expense.nphase
	JOIN expenseyear (NOLOCK)
		ON expenseyear.idexp = expense.idexp
	JOIN expensetotal (NOLOCK)
		ON expensetotal.idexp = expenseyear.idexp
		AND expensetotal.ayear = expenseyear.ayear
	LEFT OUTER JOIN expense parentexpense (NOLOCK) 
		ON expense.parentidexp = parentexpense.idexp
	LEFT OUTER JOIN expensetotal expensetotal_firstyear(NOLOCK)
		ON expensetotal_firstyear.idexp = expense.idexp
		AND ((expensetotal_firstyear.flag & 2) <> 0 )
	LEFT OUTER JOIN expenseyear expenseyear_starting(NOLOCK) 
		ON expenseyear_starting.idexp = expensetotal_firstyear.idexp
		AND expenseyear_starting.ayear = expensetotal_firstyear.ayear
	LEFT OUTER JOIN expenselast (NOLOCK) 
		ON expense.idexp = expenselast.idexp
	LEFT OUTER JOIN fin (NOLOCK)
		ON fin.idfin = expenseyear.idfin
	LEFT OUTER JOIN upb
		on upb.idupb = expenseyear.idupb
	LEFT OUTER JOIN registry (NOLOCK)
		ON registry.idreg = expense.idreg
	LEFT OUTER JOIN manager (NOLOCK)
		ON manager.idman = expense.idman
	LEFT OUTER JOIN service (NOLOCK)
		ON service.idser = expenselast.idser











GO

-- VERIFICA DI expenseinvoiceview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'expenseinvoiceview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','expenseinvoiceview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'expenseinvoiceview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','expenseinvoiceview','N','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'autokind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '1',field = 'autokind',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'autokind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','expenseinvoiceview','N','','1','autokind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'available')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'available',col_precision = '19' where tablename = 'expenseinvoiceview' AND field = 'available'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','expenseinvoiceview','N','','9','available','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'ayear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'ayear',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'ayear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','expenseinvoiceview','S','','2','ayear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'ayearstartamount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'ayearstartamount',col_precision = '19' where tablename = 'expenseinvoiceview' AND field = 'ayearstartamount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','expenseinvoiceview','N','','9','ayearstartamount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'cc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(30)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '30',field = 'cc',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'cc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(30)','N','expenseinvoiceview','N','','30','cc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'cin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(2)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '2',field = 'cin',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'cin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(2)','N','expenseinvoiceview','N','','2','cin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'codefin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codefin',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'codefin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','expenseinvoiceview','N','','50','codefin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','expenseinvoiceview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'codeupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codeupb',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'codeupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','expenseinvoiceview','N','','50','codeupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','expenseinvoiceview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','expenseinvoiceview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'curramount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'curramount',col_precision = '19' where tablename = 'expenseinvoiceview' AND field = 'curramount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','expenseinvoiceview','N','','9','curramount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','expenseinvoiceview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','expenseinvoiceview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','expenseinvoiceview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'expiration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'expiration',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'expiration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','expenseinvoiceview','N','','4','expiration','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'finance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'finance',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'finance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','expenseinvoiceview','N','','150','finance','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','expenseinvoiceview','N','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'flagarrear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '1',field = 'flagarrear',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'flagarrear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','expenseinvoiceview','N','','1','flagarrear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idbank')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '20',field = 'idbank',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idbank'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','expenseinvoiceview','N','','20','idbank','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idcab')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '20',field = 'idcab',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idcab'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','expenseinvoiceview','N','','20','idcab','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idexp')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'idexp',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idexp'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','expenseinvoiceview','S','','4','idexp','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idfin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idfin',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idfin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','idfin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','expenseinvoiceview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idpayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idpayment',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idpayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','idpayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idpaymethod')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '20',field = 'idpaymethod',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idpaymethod'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','expenseinvoiceview','N','','20','idpaymethod','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idser')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idser',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idser'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','idser','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','expenseinvoiceview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','expenseinvoiceview','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'ivaamount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'ivaamount',col_precision = '19' where tablename = 'expenseinvoiceview' AND field = 'ivaamount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','expenseinvoiceview','N','','9','ivaamount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','expenseinvoiceview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','expenseinvoiceview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','expenseinvoiceview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'movkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(5)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '5',field = 'movkind',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'movkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(5)','N','expenseinvoiceview','N','','5','movkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','expenseinvoiceview','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'nmov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'nmov',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'nmov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','expenseinvoiceview','S','','4','nmov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'npay')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'npay',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'npay'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','npay','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'nphase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '1',field = 'nphase',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'nphase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','expenseinvoiceview','S','','1','nphase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'parentidexp')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'parentidexp',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'parentidexp'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','parentidexp','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'parentnmov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'parentnmov',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'parentnmov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expenseinvoiceview','N','','4','parentnmov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'parentymov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '2',field = 'parentymov',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'parentymov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','expenseinvoiceview','N','','2','parentymov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'paymentdescr')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'paymentdescr',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'paymentdescr'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','expenseinvoiceview','N','','150','paymentdescr','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'phase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '50',field = 'phase',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'phase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','expenseinvoiceview','S','','50','phase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','expenseinvoiceview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'service')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'service',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'service'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','expenseinvoiceview','N','','50','service','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'servicestart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '8',field = 'servicestart',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'servicestart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','expenseinvoiceview','N','','8','servicestart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'servicestop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '8',field = 'servicestop',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'servicestop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','expenseinvoiceview','N','','8','servicestop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'totflag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '1',field = 'totflag',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'totflag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','expenseinvoiceview','N','','1','totflag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','expenseinvoiceview','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','expenseinvoiceview','S','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'ymov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'ymov',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'ymov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','expenseinvoiceview','S','','2','ymov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expenseinvoiceview' AND field = 'ypay')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expenseinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'ypay',col_precision = '' where tablename = 'expenseinvoiceview' AND field = 'ypay'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','expenseinvoiceview','S','','2','ypay','')
GO

-- VERIFICA DI expenseinvoiceview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'expenseinvoiceview')
UPDATE customobject set isreal = 'N' where objectname = 'expenseinvoiceview'
ELSE
INSERT INTO customobject (objectname, isreal) values('expenseinvoiceview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA expensevarview
IF EXISTS(select * from sysobjects where id = object_id(N'[expensevarview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [expensevarview]
GO


CREATE  VIEW [expensevarview]
(
	idexp,
	nvar,
	yvar,
	nphase,
	phase,
	ymov,
	nmov,
	description,
	amount,
	doc,
	docdate,
	autokind,
	idpayment,
	adate,
	transferkind,
	cu,
	ct,
	lu,
	lt,
	codefin,
	finance,
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	movkind
)
AS SELECT
	expensevar.idexp,
	expensevar.nvar,
	expensevar.yvar,
	expense.nphase,
	expensephase.description,
	expense.ymov,
	expense.nmov,
	expensevar.description,
	expensevar.amount,
	expensevar.doc,
	expensevar.docdate,
	expensevar.autokind,
	expensevar.idpayment,
	expensevar.adate,
	expensevar.transferkind,
	expensevar.cu,
	expensevar.ct,
	expensevar.lu,
	expensevar.lt,
	fin.codefin,
	fin.title,
	expensevar.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	expensevar.yinv,
	expensevar.ninv,
	expensevar.movkind
FROM expensevar (NOLOCK)
JOIN expense (NOLOCK)
	ON expense.idexp = expensevar.idexp
JOIN expensephase (NOLOCK)
	ON expensephase.nphase = expense.nphase
JOIN expenseyear (NOLOCK)
	ON expenseyear.idexp= expense.idexp
     AND expenseyear.ayear= expensevar.yvar
LEFT OUTER JOIN fin (NOLOCK)
	ON fin.idfin= expenseyear.idfin
LEFT OUTER JOIN invoicekind
	ON expensevar.idinvkind = invoicekind.idinvkind
	
	









GO

-- VERIFICA DI expensevarview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'expensevarview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'expensevarview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','expensevarview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'expensevarview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','expensevarview','N','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'autokind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '1',field = 'autokind',col_precision = '' where tablename = 'expensevarview' AND field = 'autokind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','expensevarview','N','','1','autokind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'codefin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '50',field = 'codefin',col_precision = '' where tablename = 'expensevarview' AND field = 'codefin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','expensevarview','N','','50','codefin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'expensevarview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','expensevarview','N','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'expensevarview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','expensevarview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'expensevarview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','expensevarview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'expensevarview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','expensevarview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'expensevarview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','expensevarview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'expensevarview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','expensevarview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'finance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '150',field = 'finance',col_precision = '' where tablename = 'expensevarview' AND field = 'finance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','expensevarview','N','','150','finance','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'idexp')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '4',field = 'idexp',col_precision = '' where tablename = 'expensevarview' AND field = 'idexp'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','expensevarview','S','','4','idexp','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'expensevarview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expensevarview','N','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'idpayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '4',field = 'idpayment',col_precision = '' where tablename = 'expensevarview' AND field = 'idpayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expensevarview','N','','4','idpayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'expensevarview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','expensevarview','N','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'expensevarview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','expensevarview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'expensevarview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','expensevarview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'movkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(5)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '5',field = 'movkind',col_precision = '' where tablename = 'expensevarview' AND field = 'movkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(5)','N','expensevarview','N','','5','movkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'expensevarview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','expensevarview','N','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'nmov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '4',field = 'nmov',col_precision = '' where tablename = 'expensevarview' AND field = 'nmov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','expensevarview','S','','4','nmov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'nphase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '1',field = 'nphase',col_precision = '' where tablename = 'expensevarview' AND field = 'nphase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','expensevarview','S','','1','nphase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'nvar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '4',field = 'nvar',col_precision = '' where tablename = 'expensevarview' AND field = 'nvar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','expensevarview','S','','4','nvar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'phase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '50',field = 'phase',col_precision = '' where tablename = 'expensevarview' AND field = 'phase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','expensevarview','S','','50','phase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'transferkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '1',field = 'transferkind',col_precision = '' where tablename = 'expensevarview' AND field = 'transferkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','expensevarview','N','','1','transferkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expensevarview',denynull = 'N',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'expensevarview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','expensevarview','N','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'ymov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '2',field = 'ymov',col_precision = '' where tablename = 'expensevarview' AND field = 'ymov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','expensevarview','S','','2','ymov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'expensevarview' AND field = 'yvar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'expensevarview',denynull = 'S',format = '',col_len = '2',field = 'yvar',col_precision = '' where tablename = 'expensevarview' AND field = 'yvar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','expensevarview','S','','2','yvar','')
GO

-- VERIFICA DI expensevarview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'expensevarview')
UPDATE customobject set isreal = 'N' where objectname = 'expensevarview'
ELSE
INSERT INTO customobject (objectname, isreal) values('expensevarview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA foreigngroupruledetailview
IF EXISTS(select * from sysobjects where id = object_id(N'[dbo].[foreigngroupruledetailview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [dbo].[foreigngroupruledetailview]
GO



CREATE VIEW DBO.foreigngroupruledetailview
(
	idforeigngrouprule,
	iddetail,
	start,
	idposition,
	codeposition,
	position,
	minincomeclass,
	maxincomeclass,
	foreigngroupnumber,
	ct, cu, lt, lu
)
AS SELECT 
	DET.idforeigngrouprule,
	DET.iddetail,
	F.start,
	DET.idposition,
	P.codeposition,
	P.description,
	DET.minincomeclass,
	DET.maxincomeclass,
	DET.foreigngroupnumber,
	DET.ct, DET.cu, DET.lt, DET.lu
FROM foreigngroupruledetail DET
JOIN foreigngrouprule F
	ON F.idforeigngrouprule = DET.idforeigngrouprule
JOIN position P
	ON P.idposition = DET.idposition



GO

-- VERIFICA DI foreigngroupruledetailview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'foreigngroupruledetailview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'codeposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '20',field = 'codeposition',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'codeposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','foreigngroupruledetailview','S','','20','codeposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','foreigngroupruledetailview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','foreigngroupruledetailview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'foreigngroupnumber')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '2',field = 'foreigngroupnumber',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'foreigngroupnumber'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','foreigngroupruledetailview','S','','2','foreigngroupnumber','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'iddetail')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '4',field = 'iddetail',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'iddetail'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','foreigngroupruledetailview','S','','4','iddetail','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'idforeigngrouprule')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '4',field = 'idforeigngrouprule',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'idforeigngrouprule'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','foreigngroupruledetailview','S','','4','idforeigngrouprule','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'idposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '4',field = 'idposition',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'idposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','foreigngroupruledetailview','S','','4','idposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','foreigngroupruledetailview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','foreigngroupruledetailview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'maxincomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '4',field = 'maxincomeclass',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'maxincomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','foreigngroupruledetailview','S','','4','maxincomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'minincomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '4',field = 'minincomeclass',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'minincomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','foreigngroupruledetailview','S','','4','minincomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'position')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '50',field = 'position',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'position'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','foreigngroupruledetailview','S','','50','position','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'foreigngroupruledetailview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'foreigngroupruledetailview',denynull = 'S',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'foreigngroupruledetailview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','foreigngroupruledetailview','S','','8','start','')
GO

-- VERIFICA DI foreigngroupruledetailview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'foreigngroupruledetailview')
UPDATE customobject set isreal = 'N' where objectname = 'foreigngroupruledetailview'
ELSE
INSERT INTO customobject (objectname, isreal) values('foreigngroupruledetailview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA incomeinvoiceview
IF EXISTS(select * from sysobjects where id = object_id(N'[incomeinvoiceview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [incomeinvoiceview]
GO





-- select * from incomeinvoiceview
CREATE  VIEW incomeinvoiceview 
	(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	movkind,
	idinc,
	nphase,
	phase,
	ymov,
	nmov,
	--ycreation,
	parentidinc,
	parentymov,
	parentnmov,
	ayear,
	idfin,
	codefin,
	finance,
	idupb,
	codeupb,
	upb,
	idreg,
	registry,
	idman,
	manager,
	ypro,
	npro,
	doc,
	docdate,
	description,
	amount,
	ayearstartamount,
	curramount,
	available,
	unpartitioned,
	incomelastflag,--fulfilled,
	flag, 
	flagarrear,
	autokind,
	--idproceeds,
	idpayment,
	expiration,
	adate,
	cu,
	ct,
	lu,
	lt
	)
	AS SELECT
	incomeinvoice.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	incomeinvoice.yinv,
	incomeinvoice.ninv,
	incomeinvoice.movkind,
	incomeinvoice.idinc,
	income.nphase,
	incomephase.description,
	income.ymov,
	income.nmov,
	--income.ycreation,
	income.parentidinc,
	parentincome.ymov,
	parentincome.nmov,
	incomeyear.ayear,
	incomeyear.idfin,
	fin.codefin,
	fin.title,
	upb.idupb,	
	upb.codeupb,	
	upb.title,	
	income.idreg,
	registry.title,
	income.idman,
	manager.title,
	income.ymov,
	incomelast.npro,
	income.doc,
	income.docdate,
	income.description,
	incomeyear_starting.amount, --income.amount,
	incomeyear.amount,--incometotal.amount,
	incometotal.curramount,
	incometotal.available,
	ISNULL(incometotal.curramount,0) - ISNULL(incometotal.partitioned,0),
	incomelast.flag, --fulfilled
	incometotal.flag,
	CASE
		WHEN ((incometotal.flag&1)=0) THEN 'C'
		WHEN ((incometotal.flag&1)=1) THEN 'R'
	END, 
	income.autokind,
	--income.idproceeds,
	income.idpayment,
	income.expiration,
	income.adate,
	incomeinvoice.cu,
	incomeinvoice.ct,
	incomeinvoice.lu,
	incomeinvoice.lt
	FROM incomeinvoice (NOLOCK)
	JOIN invoicekind (NOLOCK)
		ON invoicekind.idinvkind = incomeinvoice.idinvkind
	JOIN income (NOLOCK)
		ON income.idinc = incomeinvoice.idinc
	JOIN incomephase (NOLOCK)
		ON incomephase.nphase = income.nphase
	JOIN incomeyear (NOLOCK)
		ON incomeyear.idinc = income.idinc
	JOIN incometotal (NOLOCK)
		ON incometotal.idinc = incomeyear.idinc
		AND incometotal.ayear = incomeyear.ayear
	LEFT OUTER JOIN incometotal incometotal_firstyear(NOLOCK)
		ON incometotal_firstyear.idinc = income.idinc
		AND ((incometotal_firstyear.flag & 2) <> 0 )
	LEFT OUTER JOIN incomeyear incomeyear_starting(NOLOCK) 
		ON incomeyear_starting.idinc = incometotal_firstyear.idinc
		AND incomeyear_starting.ayear = incometotal_firstyear.ayear
	LEFT OUTER JOIN income parentincome (NOLOCK)
		ON income.parentidinc = parentincome.idinc
	LEFT OUTER JOIN incomelast  (NOLOCK)
		ON incomelast.idinc = income.idinc
	LEFT OUTER JOIN fin (NOLOCK)
		ON fin.idfin = incomeyear.idfin
	LEFT OUTER JOIN upb (NOLOCK)
		ON upb.idupb=incomeyear.idupb
	LEFT OUTER JOIN registry (NOLOCK)
		ON registry.idreg = income.idreg
	LEFT OUTER JOIN manager (NOLOCK)
		ON manager.idman = income.idman





GO

-- VERIFICA DI incomeinvoiceview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'incomeinvoiceview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','incomeinvoiceview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'incomeinvoiceview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','incomeinvoiceview','N','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'autokind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '1',field = 'autokind',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'autokind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','incomeinvoiceview','N','','1','autokind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'available')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'available',col_precision = '19' where tablename = 'incomeinvoiceview' AND field = 'available'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','incomeinvoiceview','N','','9','available','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'ayear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'ayear',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'ayear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','incomeinvoiceview','S','','2','ayear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'ayearstartamount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'ayearstartamount',col_precision = '19' where tablename = 'incomeinvoiceview' AND field = 'ayearstartamount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','incomeinvoiceview','N','','9','ayearstartamount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'codefin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codefin',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'codefin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','incomeinvoiceview','N','','50','codefin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','incomeinvoiceview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'codeupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codeupb',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'codeupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','incomeinvoiceview','N','','50','codeupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','incomeinvoiceview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','incomeinvoiceview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'curramount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'curramount',col_precision = '19' where tablename = 'incomeinvoiceview' AND field = 'curramount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','incomeinvoiceview','N','','9','curramount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','incomeinvoiceview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','incomeinvoiceview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','incomeinvoiceview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'expiration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'expiration',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'expiration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','incomeinvoiceview','N','','4','expiration','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'finance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'finance',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'finance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','incomeinvoiceview','N','','150','finance','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','incomeinvoiceview','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'flagarrear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '1',field = 'flagarrear',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'flagarrear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','incomeinvoiceview','N','','1','flagarrear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'idfin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idfin',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'idfin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomeinvoiceview','N','','4','idfin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'idinc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'idinc',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'idinc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','incomeinvoiceview','S','','4','idinc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','incomeinvoiceview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomeinvoiceview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'idpayment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idpayment',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'idpayment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomeinvoiceview','N','','4','idpayment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomeinvoiceview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','incomeinvoiceview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'incomelastflag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '1',field = 'incomelastflag',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'incomelastflag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','incomeinvoiceview','N','','1','incomelastflag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','incomeinvoiceview','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','incomeinvoiceview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','incomeinvoiceview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','incomeinvoiceview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'movkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(5)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '5',field = 'movkind',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'movkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(5)','N','incomeinvoiceview','N','','5','movkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','incomeinvoiceview','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'nmov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'nmov',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'nmov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','incomeinvoiceview','S','','4','nmov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'nphase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '1',field = 'nphase',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'nphase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','incomeinvoiceview','S','','1','nphase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'npro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'npro',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'npro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomeinvoiceview','N','','4','npro','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'parentidinc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'parentidinc',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'parentidinc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomeinvoiceview','N','','4','parentidinc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'parentnmov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'parentnmov',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'parentnmov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomeinvoiceview','N','','4','parentnmov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'parentymov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '2',field = 'parentymov',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'parentymov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','incomeinvoiceview','N','','2','parentymov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'phase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '50',field = 'phase',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'phase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','incomeinvoiceview','S','','50','phase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','incomeinvoiceview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'unpartitioned')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(20,2)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '13',field = 'unpartitioned',col_precision = '20' where tablename = 'incomeinvoiceview' AND field = 'unpartitioned'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(20,2)','N','incomeinvoiceview','N','','13','unpartitioned','20')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','incomeinvoiceview','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','incomeinvoiceview','S','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'ymov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'ymov',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'ymov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','incomeinvoiceview','S','','2','ymov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomeinvoiceview' AND field = 'ypro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomeinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'ypro',col_precision = '' where tablename = 'incomeinvoiceview' AND field = 'ypro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','incomeinvoiceview','S','','2','ypro','')
GO

-- VERIFICA DI incomeinvoiceview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'incomeinvoiceview')
UPDATE customobject set isreal = 'N' where objectname = 'incomeinvoiceview'
ELSE
INSERT INTO customobject (objectname, isreal) values('incomeinvoiceview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA incomevarview
IF EXISTS(select * from sysobjects where id = object_id(N'[incomevarview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [incomevarview]
GO






CREATE  VIEW [incomevarview]
(
	idinc,
	nvar,
	yvar,
	nphase,
	phase,
	ymov,
	nmov,
	description,
	amount,
	doc,
	docdate,
	adate,
	transferkind,
	autokind,
	cu,
	ct,
	lu,
	lt,
	codefin,
	finance,
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	movkind
)
AS SELECT
	incomevar.idinc,
	incomevar.nvar,
	incomevar.yvar,
	income.nphase,
	incomephase.description,
	income.ymov,
	income.nmov,
	incomevar.description,
	incomevar.amount,
	incomevar.doc,
	incomevar.docdate,
	incomevar.adate,
	incomevar.transferkind,
	incomevar.autokind,
	incomevar.cu,
	incomevar.ct,
	incomevar.lu,
	incomevar.lt,
	fin.codefin,
	fin.title,
	incomevar.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	incomevar.yinv,
	incomevar.ninv,
	incomevar.movkind
FROM incomevar (NOLOCK)
JOIN income (NOLOCK)
	ON income.idinc = incomevar.idinc
JOIN incomephase (NOLOCK)
	ON incomephase.nphase = income.nphase
JOIN incomeyear (NOLOCK)
	ON incomeyear.idinc= income.idinc
	AND incomeyear.ayear= incomevar.yvar
LEFT OUTER JOIN fin (NOLOCK)
	ON fin.idfin= incomeyear.idfin
LEFT OUTER JOIN invoicekind
	ON incomevar.idinvkind = invoicekind.idinvkind
	
	









GO

-- VERIFICA DI incomevarview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'incomevarview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'incomevarview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','incomevarview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'incomevarview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','incomevarview','N','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'autokind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '1',field = 'autokind',col_precision = '' where tablename = 'incomevarview' AND field = 'autokind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','S','System.Byte','tinyint','N','incomevarview','N','','1','autokind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'codefin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '50',field = 'codefin',col_precision = '' where tablename = 'incomevarview' AND field = 'codefin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','incomevarview','N','','50','codefin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'incomevarview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','incomevarview','N','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'incomevarview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','incomevarview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'incomevarview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','incomevarview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'incomevarview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','incomevarview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'incomevarview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','incomevarview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'incomevarview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','incomevarview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'finance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '150',field = 'finance',col_precision = '' where tablename = 'incomevarview' AND field = 'finance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','incomevarview','N','','150','finance','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'idinc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '4',field = 'idinc',col_precision = '' where tablename = 'incomevarview' AND field = 'idinc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','incomevarview','S','','4','idinc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'incomevarview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomevarview','N','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'incomevarview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','incomevarview','N','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'incomevarview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','incomevarview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'incomevarview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','incomevarview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'movkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(5)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '5',field = 'movkind',col_precision = '' where tablename = 'incomevarview' AND field = 'movkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(5)','N','incomevarview','N','','5','movkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'incomevarview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','incomevarview','N','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'nmov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '4',field = 'nmov',col_precision = '' where tablename = 'incomevarview' AND field = 'nmov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','incomevarview','S','','4','nmov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'nphase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '1',field = 'nphase',col_precision = '' where tablename = 'incomevarview' AND field = 'nphase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','incomevarview','S','','1','nphase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'nvar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '4',field = 'nvar',col_precision = '' where tablename = 'incomevarview' AND field = 'nvar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','incomevarview','S','','4','nvar','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'phase')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '50',field = 'phase',col_precision = '' where tablename = 'incomevarview' AND field = 'phase'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','incomevarview','S','','50','phase','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'transferkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '1',field = 'transferkind',col_precision = '' where tablename = 'incomevarview' AND field = 'transferkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','incomevarview','N','','1','transferkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomevarview',denynull = 'N',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'incomevarview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','incomevarview','N','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'ymov')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '2',field = 'ymov',col_precision = '' where tablename = 'incomevarview' AND field = 'ymov'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','incomevarview','S','','2','ymov','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'incomevarview' AND field = 'yvar')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'incomevarview',denynull = 'S',format = '',col_len = '2',field = 'yvar',col_precision = '' where tablename = 'incomevarview' AND field = 'yvar'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','incomevarview','S','','2','yvar','')
GO

-- VERIFICA DI incomevarview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'incomevarview')
UPDATE customobject set isreal = 'N' where objectname = 'incomevarview'
ELSE
INSERT INTO customobject (objectname, isreal) values('incomevarview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceavailable
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceavailable]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceavailable]
GO





CREATE    VIEW [invoiceavailable]
(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flag,
	flagbuysell,
	flagvariation,
	idreg,
	registry,
	registryreference,
	description,
	paymentexpiring,
	idexpirationkind,
	doc,
	docdate,
	ycon,
	ncon,
	adate,
	packinglistnum,
	packinglistdate,
	officiallyprinted,
	cu, 
	ct, 
	lu, 
	lt,
	taxabletotal,
	ivatotal,
	linkedamount,
	residual,
	active
)
AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoice.yinv,
	invoice.ninv,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	invoice.idreg,
	registry.title,
	invoice.registryreference,
	invoice.description,
	invoice.paymentexpiring,
	invoice.idexpirationkind,
	invoice.doc,
	invoice.docdate,
	profservice.ycon,
	profservice.ncon,
	invoice.adate,
	invoice.packinglistnum,
	invoice.packinglistdate,
	invoice.officiallyprinted,
	invoice.cu, 
	invoice.ct, 
	invoice.lu, 
	invoice.lt,
	totinvoiceview.taxabletotal,
	totinvoiceview.ivatotal,
	CONVERT(decimal(23,5),
	CASE 
	WHEN ((invoicekind.flag&1)<>0) AND ((invoicekind.flag&4)=0) THEN  
		ISNULL(
			(SELECT ISNULL(SUM(incomeyear_starting.amount), 0.0) 
			FROM incomeinvoice i
			JOIN income e
			ON e.idinc = i.idinc
			LEFT OUTER JOIN incometotal incometotal_firstyear(NOLOCK)
  			ON incometotal_firstyear.idinc = e.idinc
  			AND ((incometotal_firstyear.flag & 2) <> 0 )
 			LEFT OUTER JOIN incomeyear incomeyear_starting(NOLOCK) 
			ON incomeyear_starting.idinc = incometotal_firstyear.idinc
  			AND incomeyear_starting.ayear = incometotal_firstyear.ayear
			WHERE i.idinvkind = invoice.idinvkind
			AND i.yinv = invoice.yinv
			AND i.ninv = invoice.ninv)
		,0)
	WHEN ((invoicekind.flag&1)<>0) AND ((invoicekind.flag&4)<>0) THEN
		ISNULL(
			(SELECT ABS(SUM(e.amount)) 
			FROM incomevar e 
			WHERE e.idinvkind = invoice.idinvkind
			AND e.yinv = invoice.yinv
			AND e.ninv = invoice.ninv)
		,0)
	WHEN ((invoicekind.flag&1)=0) AND ((invoicekind.flag&4)=0) THEN 
		ISNULL(
			(SELECT SUM(expenseyear_starting.amount)
			FROM expenseinvoice i (NOLOCK), expense s (NOLOCK)
			LEFT OUTER JOIN expensetotal expensetotal_firstyear(NOLOCK)
  			ON expensetotal_firstyear.idexp = s.idexp
  			AND ((expensetotal_firstyear.flag & 2) <> 0 )
 			LEFT OUTER JOIN expenseyear expenseyear_starting(NOLOCK) 
			ON expenseyear_starting.idexp = expensetotal_firstyear.idexp
  			AND expenseyear_starting.ayear = expensetotal_firstyear.ayear
			WHERE i.idinvkind = invoice.idinvkind
			AND i.yinv = invoice.yinv
			AND i.ninv = invoice.ninv
			AND s.idexp = i.idexp)
		,0) +
		ISNULL(
			(SELECT SUM(p.amount)
			FROM pettycashoperationinvoice mov
			JOIN pettycashoperation p
			ON mov.idpettycash = p.idpettycash
			AND mov.yoperation = p.yoperation
			AND mov.noperation = p.noperation
			WHERE mov.idinvkind = invoice.idinvkind
			AND mov.yinv = invoice.yinv
			AND mov.ninv = invoice.ninv)
		,0)
	WHEN ((invoicekind.flag&1)=0) AND ((invoicekind.flag&4)<>0) THEN 
		ISNULL(
			(SELECT ABS(SUM(s.amount)) 
			FROM expensevar s
			WHERE s.idinvkind = invoice.idinvkind
			AND s.yinv = invoice.yinv
			AND s.ninv = invoice.ninv)
		,0)
	END),
	--residuo = totaleimponibile + totaleiva - totale movimenti
	ISNULL(totinvoiceview.taxabletotal, 0.0) +
	ISNULL(totinvoiceview.ivatotal, 0.0) - 
	
	CONVERT(decimal(19,5),
	CASE 
	WHEN ((invoicekind.flag&1)<>0) AND ((invoicekind.flag&4)=0) THEN 
		ISNULL(
			(SELECT SUM(incomeyear_starting.amount)
			FROM incomeinvoice i
			JOIN income e
			ON e.idinc = i.idinc
			LEFT OUTER JOIN incometotal incometotal_firstyear(NOLOCK)
  			ON incometotal_firstyear.idinc = e.idinc
  			AND ((incometotal_firstyear.flag & 2) <> 0 )
 			LEFT OUTER JOIN incomeyear incomeyear_starting(NOLOCK) 
			ON incomeyear_starting.idinc = incometotal_firstyear.idinc
  			AND incomeyear_starting.ayear = incometotal_firstyear.ayear
			WHERE i.idinvkind = invoice.idinvkind
			AND i.yinv = invoice.yinv
			AND i.ninv = invoice.ninv)
		,0)
	WHEN ((invoicekind.flag&1)<>0) AND ((invoicekind.flag&4)<>0) THEN 
		ISNULL(
			(SELECT ABS(SUM(e.amount)) 
			FROM incomevar e
			WHERE e.idinvkind = invoice.idinvkind
			AND e.yinv = invoice.yinv
			AND e.ninv = invoice.ninv)
		,0)
	WHEN ((invoicekind.flag&1)=0) AND ((invoicekind.flag&4)=0) THEN
		ISNULL(
			(SELECT SUM(expenseyear_starting.amount)
			FROM expenseinvoice i (NOLOCK), expense s (NOLOCK)
			LEFT OUTER JOIN expensetotal expensetotal_firstyear(NOLOCK)
  			ON expensetotal_firstyear.idexp = s.idexp
  			AND ((expensetotal_firstyear.flag & 2) <> 0 )
 			LEFT OUTER JOIN expenseyear expenseyear_starting(NOLOCK) 
			ON expenseyear_starting.idexp = expensetotal_firstyear.idexp
  			AND expenseyear_starting.ayear = expensetotal_firstyear.ayear
			WHERE i.idinvkind = invoice.idinvkind
			AND i.yinv = invoice.yinv
			AND i.ninv = invoice.ninv
			AND s.idexp = i.idexp)
		,0) +
		ISNULL(
			(SELECT SUM(p.amount)
			FROM pettycashoperationinvoice mov
			JOIN pettycashoperation p
			ON mov.idpettycash = p.idpettycash
			AND mov.yoperation = p.yoperation
			AND mov.noperation = p.noperation
			WHERE mov.idinvkind = invoice.idinvkind
			AND mov.yinv = invoice.yinv
			AND mov.ninv = invoice.ninv)
		,0)
	WHEN ((invoicekind.flag&1)=0) AND ((invoicekind.flag&4)<>0) THEN 
		ISNULL(
			(SELECT ABS(SUM(s.amount)) 
			FROM expensevar s (NOLOCK)
			WHERE s.idinvkind = invoice.idinvkind
			AND s.yinv = invoice.yinv
			AND s.ninv = invoice.ninv)
		,0)
	END),
	invoice.active
FROM invoice (NOLOCK)
JOIN invoicekind (NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
LEFT OUTER JOIN totinvoiceview (NOLOCK)
	ON totinvoiceview.idinvkind = invoice.idinvkind
	AND totinvoiceview.yinv = invoice.yinv
	AND totinvoiceview.ninv = invoice.ninv
LEFT OUTER JOIN profservice 
ON profservice.idinvkind=invoice.idinvkind and profservice.yinv=invoice.yinv and profservice.ninv=invoice.ninv




GO

-- VERIFICA DI invoiceavailable IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceavailable'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'invoiceavailable' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceavailable','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoiceavailable' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoiceavailable','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceavailable' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceavailable','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'invoiceavailable' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceavailable','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'invoiceavailable' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceavailable','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceavailable' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceavailable','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'invoiceavailable' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','invoiceavailable','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'invoiceavailable' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceavailable','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoiceavailable' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoiceavailable','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoiceavailable' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceavailable','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoiceavailable' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceavailable','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'invoiceavailable' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceavailable','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceavailable' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceavailable','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoiceavailable' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceavailable','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'invoiceavailable' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoiceavailable','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'ivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '9',field = 'ivatotal',col_precision = '19' where tablename = 'invoiceavailable' AND field = 'ivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceavailable','N','','9','ivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'linkedamount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(23,5)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '13',field = 'linkedamount',col_precision = '23' where tablename = 'invoiceavailable' AND field = 'linkedamount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(23,5)','N','invoiceavailable','N','','13','linkedamount','23')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'invoiceavailable' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceavailable','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'invoiceavailable' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceavailable','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'ncon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '4',field = 'ncon',col_precision = '' where tablename = 'invoiceavailable' AND field = 'ncon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceavailable','N','','4','ncon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceavailable' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceavailable','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'invoiceavailable' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','invoiceavailable','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'packinglistdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '4',field = 'packinglistdate',col_precision = '' where tablename = 'invoiceavailable' AND field = 'packinglistdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceavailable','N','','4','packinglistdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'packinglistnum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(25)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '25',field = 'packinglistnum',col_precision = '' where tablename = 'invoiceavailable' AND field = 'packinglistnum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(25)','N','invoiceavailable','N','','25','packinglistnum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'invoiceavailable' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoiceavailable','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceavailable' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoiceavailable','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'invoiceavailable' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceavailable','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(24,5)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '13',field = 'residual',col_precision = '24' where tablename = 'invoiceavailable' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(24,5)','N','invoiceavailable','N','','13','residual','24')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'taxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '9',field = 'taxabletotal',col_precision = '19' where tablename = 'invoiceavailable' AND field = 'taxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceavailable','N','','9','taxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'ycon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceavailable',denynull = 'N',format = '',col_len = '4',field = 'ycon',col_precision = '' where tablename = 'invoiceavailable' AND field = 'ycon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceavailable','N','','4','ycon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceavailable' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceavailable',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceavailable' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceavailable','S','','2','yinv','')
GO

-- VERIFICA DI invoiceavailable IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceavailable')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceavailable'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceavailable', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoicedetailgroupview
IF EXISTS(select * from sysobjects where id = object_id(N'[invoicedetailgroupview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoicedetailgroupview]
GO







CREATE   VIEW invoicedetailgroupview
(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flag,
	flagbuysell,
	flagvariation,
	rownum,
	detaildescription,
	idivakind,
	ivakind,
	rate,
	unabatabilitypercentage,
	number,
	taxable,
	discount,
	tax,
	unabatable,
	exchangerate,
	annotations,
	idmankind,
	mankind,
	yman,
	nman,
	manrownum,
	manidgroup,
	mandetaildescription,
	adate
)
	AS SELECT
	invoicedetail.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoicedetail.yinv,
	invoicedetail.ninv,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)=1) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)=1) THEN 'S'
	END, 
	invoicedetail.rownum,
	invoicedetail.detaildescription,
	invoicedetail.idivakind,
	ivakind.description,
	ivakind.rate,
	ivakind.unabatabilitypercentage,
	invoicedetail.number,
	isnull(sum(invoicedetail.taxable),0),
	invoicedetail.discount,
	isnull(sum(invoicedetail.tax),0),
	isnull(sum(invoicedetail.unabatable),0),
	invoice.exchangerate,
	invoicedetail.annotations,
	invoicedetail.idmankind,
	mandatekind.description,
	invoicedetail.yman,
	invoicedetail.nman,
	invoicedetail.manrownum,
	mandatedetail.idgroup,
	mandatedetail.detaildescription,
	invoice.adate
FROM invoicedetail (NOLOCK)
JOIN ivakind (NOLOCK)
	ON ivakind.idivakind = invoicedetail.idivakind
JOIN invoice (NOLOCK)
	ON invoice.ninv = invoicedetail.ninv
	AND invoice.yinv = invoicedetail.yinv
	AND invoice.idinvkind = invoicedetail.idinvkind
JOIN invoicekind (NOLOCK)
	ON invoicekind.idinvkind = invoicedetail.idinvkind
JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
LEFT OUTER JOIN mandatedetail
	ON invoicedetail.idmankind = mandatedetail.idmankind
	AND invoicedetail.yman = mandatedetail.yman
	AND invoicedetail.nman = mandatedetail.nman
	AND invoicedetail.manrownum = mandatedetail.rownum
LEFT OUTER JOIN mandatekind 
	ON mandatekind.idmankind = mandatedetail.idmankind
GROUP BY 
	invoicedetail.yman,
	invoicedetail.nman,
	invoicedetail.manrownum,
	mandatedetail.idgroup,
	invoicedetail.idinvkind,
	invoicedetail.yinv,
	invoicedetail.ninv,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoicekind.flag,
	(invoicekind.flag&1),
	(invoicekind.flag&4),
	invoicedetail.rownum,
	invoicedetail.detaildescription,
	invoicedetail.idivakind,
	ivakind.description,
	ivakind.rate,
	ivakind.unabatabilitypercentage,
	invoicedetail.number,
	invoicedetail.discount,
	invoice.exchangerate,
	invoicedetail.annotations,
	invoicedetail.idmankind,
	mandatekind.description,
	mandatedetail.detaildescription,
	invoice.adate




GO

-- VERIFICA DI invoicedetailgroupview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoicedetailgroupview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoicedetailgroupview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'annotations')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(400)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '400',field = 'annotations',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'annotations'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(400)','N','invoicedetailgroupview','N','','400','annotations','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoicedetailgroupview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicedetailgroupview','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoicedetailgroupview','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoicedetailgroupview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoicedetailgroupview','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicedetailgroupview','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicedetailgroupview','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailgroupview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailgroupview','S','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoicedetailgroupview','N','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoicedetailgroupview','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoicedetailgroupview','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'mandetaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '150',field = 'mandetaildescription',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'mandetaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicedetailgroupview','N','','150','mandetaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'manidgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'manidgroup',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'manidgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailgroupview','N','','4','manidgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'mankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '150',field = 'mankind',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'mankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicedetailgroupview','N','','150','mankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'manrownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'manrownum',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'manrownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailgroupview','N','','4','manrownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailgroupview','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailgroupview','N','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'number')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '9',field = 'number',col_precision = '19' where tablename = 'invoicedetailgroupview' AND field = 'number'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoicedetailgroupview','N','','9','number','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'rate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '9',field = 'rate',col_precision = '19' where tablename = 'invoicedetailgroupview' AND field = 'rate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(19,6)','N','invoicedetailgroupview','S','','9','rate','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'rownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '4',field = 'rownum',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'rownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailgroupview','S','','4','rownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'tax',col_precision = '38' where tablename = 'invoicedetailgroupview' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','invoicedetailgroupview','S','','17','tax','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,5)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'taxable',col_precision = '38' where tablename = 'invoicedetailgroupview' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','N','System.Decimal','decimal(38,5)','N','invoicedetailgroupview','S','','17','taxable','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'unabatabilitypercentage')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '9',field = 'unabatabilitypercentage',col_precision = '19' where tablename = 'invoicedetailgroupview' AND field = 'unabatabilitypercentage'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(19,6)','N','invoicedetailgroupview','S','','9','unabatabilitypercentage','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'unabatable',col_precision = '38' where tablename = 'invoicedetailgroupview' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','invoicedetailgroupview','S','','17','unabatable','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoicedetailgroupview','S','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailgroupview' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoicedetailgroupview',denynull = 'N',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'invoicedetailgroupview' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoicedetailgroupview','N','','2','yman','')
GO

-- VERIFICA DI invoicedetailgroupview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoicedetailgroupview')
UPDATE customobject set isreal = 'N' where objectname = 'invoicedetailgroupview'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoicedetailgroupview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoicedetailview
IF EXISTS(select * from sysobjects where id = object_id(N'[invoicedetailview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoicedetailview]
GO




CREATE VIEW invoicedetailview
(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flag,
	flagbuysell,
	flagvariation,
	rownum,
	detaildescription,
	idivakind,
	ivakind,
	rate,
	unabatabilitypercentage,
	number,
	taxable,
	discount,
	tax,
	unabatable,
	exchangerate,
	annotations,
	idmankind,
	mankind,
	yman,
	nman,
	manrownum,
	mandetaildescription,
	idupb, 
	codeupb,	
	upb, 
	adate,
	idexp_iva,
	idexp_taxable,
	idexp_ivamand,
	idexp_taxablemand,
	idinc_iva,
	idinc_taxable,
	idinc_ivaestim,
	idinc_taxableestim,
	taxable_euro,
	iva_euro,
	unabatable_euro,
	rowtotal,
	competencystart,
	competencystop,
	yinv_main,
	ninv_main,
	description,
	idaccmotive,
	codemotive,
	idsor1,
	idsor2,
	idsor3,
	sortcode1,
	sortcode2,
	sortcode3,
	cu, 
	ct, 
	lu, 
	lt
)
	AS SELECT
	invoicedetail.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoicedetail.yinv,
	invoicedetail.ninv,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	invoicedetail.rownum,
	invoicedetail.detaildescription,
	invoicedetail.idivakind,
	ivakind.description,
	ivakind.rate,
	ivakind.unabatabilitypercentage,
	invoicedetail.number,
	invoicedetail.taxable,
	invoicedetail.discount,
	invoicedetail.tax,
	invoicedetail.unabatable,
	invoice.exchangerate,
	invoicedetail.annotations,
	invoicedetail.idmankind,
	mandatekind.description,
	invoicedetail.yman,
	invoicedetail.nman,
	invoicedetail.manrownum,
	mandatedetail.detaildescription,
	invoicedetail.idupb, 
	upb.codeupb,	
	upb.title, 
	invoice.adate,
	invoicedetail.idexp_iva,
	invoicedetail.idexp_taxable,
	mandatedetail.idexp_iva,
	mandatedetail.idexp_taxable,
	invoicedetail.idinc_iva,
	invoicedetail.idinc_taxable,
	estimatedetail.idinc_iva,
	estimatedetail.idinc_taxable,
 	    ROUND(invoicedetail.taxable * invoicedetail.number * 
		  CONVERT(DECIMAL(19,6),invoice.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(invoicedetail.discount, 0.0))),2
		),
	ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2),
	ROUND(invoicedetail.unabatable * CONVERT(decimal(19,6), invoice.exchangerate),2),
	ROUND(invoicedetail.taxable * invoicedetail.number * 
		  CONVERT(DECIMAL(19,6),invoice.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(invoicedetail.discount, 0.0))),2
		)+
	ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2),
	invoicedetail.competencystart,
	invoicedetail.competencystop,
	invoicedetail.yinv_main,
	invoicedetail.ninv_main,
	invoice.description,
	invoicedetail.idaccmotive,
	accmotive.codemotive,
	invoicedetail.idsor1,
	invoicedetail.idsor2,
	invoicedetail.idsor3,
	sorting1.sortcode,
	sorting2.sortcode,
	sorting3.sortcode,
	invoicedetail.cu, 
	invoicedetail.ct, 
	invoicedetail.lu,
	invoicedetail.lt 
FROM invoicedetail
JOIN ivakind
	ON ivakind.idivakind = invoicedetail.idivakind
JOIN invoice
	ON invoice.ninv = invoicedetail.ninv
	AND invoice.yinv = invoicedetail.yinv
	AND invoice.idinvkind = invoicedetail.idinvkind
JOIN invoicekind
	ON invoicekind.idinvkind = invoicedetail.idinvkind
JOIN registry
	ON registry.idreg = invoice.idreg
LEFT OUTER JOIN mandatedetail
	ON invoicedetail.idmankind = mandatedetail.idmankind
	AND invoicedetail.yman = mandatedetail.yman
	AND invoicedetail.nman = mandatedetail.nman
	AND invoicedetail.manrownum = mandatedetail.rownum
LEFT OUTER JOIN mandatekind 
	ON mandatekind.idmankind = mandatedetail.idmankind
LEFT OUTER JOIN estimatedetail
	ON invoicedetail.idestimkind = estimatedetail.idestimkind
	AND invoicedetail.yestim = estimatedetail.yestim
	AND invoicedetail.nestim = estimatedetail.nestim
	AND invoicedetail.estimrownum = estimatedetail.rownum
LEFT OUTER JOIN upb
	ON upb.idupb = invoicedetail.idupb
LEFT OUTER JOIN accmotive
	ON accmotive.idaccmotive = invoicedetail.idaccmotive
LEFT OUTER JOIN config
	ON config.ayear = invoicedetail.yinv
LEFT OUTER JOIN sorting sorting1
	ON sorting1.idsorkind = config.idsortingkind1
	AND sorting1.idsor = invoicedetail.idsor1
LEFT OUTER JOIN sorting sorting2
	ON sorting2.idsorkind = config.idsortingkind2
	AND sorting2.idsor = invoicedetail.idsor2
LEFT OUTER JOIN sorting sorting3
	ON sorting3.idsorkind = config.idsortingkind3
	AND sorting3.idsor = invoicedetail.idsor3




GO

-- VERIFICA DI invoicedetailview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoicedetailview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoicedetailview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoicedetailview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'annotations')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(400)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '400',field = 'annotations',col_precision = '' where tablename = 'invoicedetailview' AND field = 'annotations'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(400)','N','invoicedetailview','N','','400','annotations','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoicedetailview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoicedetailview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'codemotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '50',field = 'codemotive',col_precision = '' where tablename = 'invoicedetailview' AND field = 'codemotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoicedetailview','N','','50','codemotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'codeupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '50',field = 'codeupb',col_precision = '' where tablename = 'invoicedetailview' AND field = 'codeupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoicedetailview','N','','50','codeupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'competencystart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '8',field = 'competencystart',col_precision = '' where tablename = 'invoicedetailview' AND field = 'competencystart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','invoicedetailview','N','','8','competencystart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'competencystop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '8',field = 'competencystop',col_precision = '' where tablename = 'invoicedetailview' AND field = 'competencystop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','invoicedetailview','N','','8','competencystop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'invoicedetailview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoicedetailview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'invoicedetailview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoicedetailview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoicedetailview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoicedetailview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'invoicedetailview' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicedetailview','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'invoicedetailview' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoicedetailview','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'invoicedetailview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoicedetailview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoicedetailview' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoicedetailview','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoicedetailview' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicedetailview','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoicedetailview' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicedetailview','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','invoicedetailview','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idexp_iva')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idexp_iva',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idexp_iva'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idexp_iva','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idexp_ivamand')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idexp_ivamand',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idexp_ivamand'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idexp_ivamand','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idexp_taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idexp_taxable',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idexp_taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idexp_taxable','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idexp_taxablemand')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idexp_taxablemand',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idexp_taxablemand'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idexp_taxablemand','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idinc_iva')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idinc_iva',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idinc_iva'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idinc_iva','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idinc_ivaestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idinc_ivaestim',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idinc_ivaestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idinc_ivaestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idinc_taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idinc_taxable',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idinc_taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idinc_taxable','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idinc_taxableestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'idinc_taxableestim',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idinc_taxableestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','idinc_taxableestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailview','S','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoicedetailview','N','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idsor1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '32',field = 'idsor1',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idsor1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','invoicedetailview','N','','32','idsor1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idsor2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '32',field = 'idsor2',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idsor2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','invoicedetailview','N','','32','idsor2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idsor3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '32',field = 'idsor3',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idsor3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','invoicedetailview','N','','32','idsor3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'invoicedetailview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','invoicedetailview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'invoicedetailview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoicedetailview','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'iva_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '17',field = 'iva_euro',col_precision = '38' where tablename = 'invoicedetailview' AND field = 'iva_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','S','System.Decimal','decimal(38,7)','N','invoicedetailview','N','','17','iva_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'invoicedetailview' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoicedetailview','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'invoicedetailview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoicedetailview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'invoicedetailview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoicedetailview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'mandetaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '150',field = 'mandetaildescription',col_precision = '' where tablename = 'invoicedetailview' AND field = 'mandetaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicedetailview','N','','150','mandetaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'mankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '150',field = 'mankind',col_precision = '' where tablename = 'invoicedetailview' AND field = 'mankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicedetailview','N','','150','mankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'manrownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'manrownum',col_precision = '' where tablename = 'invoicedetailview' AND field = 'manrownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','manrownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoicedetailview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailview','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'ninv_main')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'ninv_main',col_precision = '' where tablename = 'invoicedetailview' AND field = 'ninv_main'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','ninv_main','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'invoicedetailview' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicedetailview','N','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'number')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '9',field = 'number',col_precision = '19' where tablename = 'invoicedetailview' AND field = 'number'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoicedetailview','N','','9','number','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'rate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '9',field = 'rate',col_precision = '19' where tablename = 'invoicedetailview' AND field = 'rate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(19,6)','N','invoicedetailview','S','','9','rate','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'rownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '4',field = 'rownum',col_precision = '' where tablename = 'invoicedetailview' AND field = 'rownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicedetailview','S','','4','rownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'rowtotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '17',field = 'rowtotal',col_precision = '38' where tablename = 'invoicedetailview' AND field = 'rowtotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','invoicedetailview','N','','17','rowtotal','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'sortcode1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '50',field = 'sortcode1',col_precision = '' where tablename = 'invoicedetailview' AND field = 'sortcode1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoicedetailview','N','','50','sortcode1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'sortcode2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '50',field = 'sortcode2',col_precision = '' where tablename = 'invoicedetailview' AND field = 'sortcode2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoicedetailview','N','','50','sortcode2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'sortcode3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '50',field = 'sortcode3',col_precision = '' where tablename = 'invoicedetailview' AND field = 'sortcode3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoicedetailview','N','','50','sortcode3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '9',field = 'tax',col_precision = '19' where tablename = 'invoicedetailview' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoicedetailview','N','','9','tax','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,5)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '9',field = 'taxable',col_precision = '19' where tablename = 'invoicedetailview' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(19,5)','N','invoicedetailview','N','','9','taxable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'taxable_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '17',field = 'taxable_euro',col_precision = '38' where tablename = 'invoicedetailview' AND field = 'taxable_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','invoicedetailview','N','','17','taxable_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'unabatabilitypercentage')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '9',field = 'unabatabilitypercentage',col_precision = '19' where tablename = 'invoicedetailview' AND field = 'unabatabilitypercentage'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(19,6)','N','invoicedetailview','S','','9','unabatabilitypercentage','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '9',field = 'unabatable',col_precision = '19' where tablename = 'invoicedetailview' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoicedetailview','N','','9','unabatable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'unabatable_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '17',field = 'unabatable_euro',col_precision = '38' where tablename = 'invoicedetailview' AND field = 'unabatable_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','S','System.Decimal','decimal(38,7)','N','invoicedetailview','N','','17','unabatable_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'invoicedetailview' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicedetailview','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoicedetailview',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoicedetailview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoicedetailview','S','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'yinv_main')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '2',field = 'yinv_main',col_precision = '' where tablename = 'invoicedetailview' AND field = 'yinv_main'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoicedetailview','N','','2','yinv_main','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicedetailview' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoicedetailview',denynull = 'N',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'invoicedetailview' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoicedetailview','N','','2','yman','')
GO

-- VERIFICA DI invoicedetailview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoicedetailview')
UPDATE customobject set isreal = 'N' where objectname = 'invoicedetailview'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoicedetailview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceexpavailable
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceexpavailable]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceexpavailable]
GO



CREATE  VIEW [invoiceexpavailable]
(
	idinvkind,
	codeinvkind,
	yinv,
	ninv,
	invkind,
	registry,
	description,
	doc,
	docdate,
	adate,
	taxabletotal,
	ivatotal,
	detailtaxabletotal,
	detailivatotal,
	linkedtotal,
	residual,
	active
)
AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoice.yinv,
	invoice.ninv,
	invoicekind.description,
	registry.title,
	invoice.description,
	invoice.doc,
	invoice.docdate,
	invoice.adate,
	totinvoiceview.taxabletotal, -- totale imponibile su tutta la fattura
	totinvoiceview.ivatotal,--totale iva su tutta la fattura
	totinvoicedetailview.taxabletotal,--totale imponibile dei dettagli associati a movimenti di spesa
	totinvoicedetailview.ivatotal,--totale iva dei dettagli associati a movimenti di spesa
	--totale movimenti = somma (importo) del join di expenseinvoice con expense
	convert(decimal(19,2),ROUND(
	(SELECT ISNULL(SUM(expenseyear_starting.amount), 0) 
	FROM expenseinvoice mov (NOLOCK)
	JOIN expense s (NOLOCK)
	ON s.idexp = mov.idexp
	LEFT OUTER JOIN expensetotal expensetotal_firstyear(NOLOCK)
	ON expensetotal_firstyear.idexp = s.idexp
	AND ((expensetotal_firstyear.flag & 2) <> 0 )
	LEFT OUTER JOIN expenseyear expenseyear_starting(NOLOCK) 
	ON expenseyear_starting.idexp = expensetotal_firstyear.idexp
	AND expenseyear_starting.ayear = expensetotal_firstyear.ayear
	WHERE mov.idinvkind = invoice.idinvkind
	AND mov.yinv = invoice.yinv
	AND mov.ninv = invoice.ninv)
	,2)),
	--residuo :somma dei dett. fattura non contabilizzati
	(SELECT CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN (invoicedetail.idexp_taxable IS  NULL) AND (invoicedetail.idexp_iva IS  NOT NULL)
			THEN
			     ROUND((ISNULL(invoicedetail.taxable,0)* invoicedetail.number )  ,2)
			WHEN ( invoicedetail.idexp_iva IS NULL) AND (invoicedetail.idexp_taxable IS  NOT NULL)
			THEN
			     ROUND( ISNULL(invoicedetail.tax,0)  ,2)
			WHEN ( invoicedetail.idexp_iva IS  NULL) AND (invoicedetail.idexp_taxable IS  NULL)
			THEN
			     ROUND((ISNULL(invoicedetail.taxable,0)* invoicedetail.number + ISNULL(invoicedetail.tax,0))  ,2)
			ELSE   0
		    END
		   ),0)
		) 
	FROM invoicedetail 
	WHERE invoicedetail.idinvkind = invoice.idinvkind
		AND invoicedetail.yinv = invoice.yinv
		AND invoicedetail.ninv = invoice.ninv),
	invoice.active
FROM invoice (NOLOCK)
JOIN invoicekind
	ON invoicekind.idinvkind = invoice.idinvkind
JOIN totinvoiceview (NOLOCK)
	ON totinvoiceview.idinvkind = invoice.idinvkind
	AND totinvoiceview.yinv = invoice.yinv
	AND totinvoiceview.ninv = invoice.ninv
LEFT OUTER JOIN totinvoicedetailview (NOLOCK)
	ON totinvoicedetailview.idinvkind = invoice.idinvkind
	AND totinvoicedetailview.yinv = invoice.yinv
	AND totinvoicedetailview.ninv = invoice.ninv
LEFT OUTER JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
WHERE ((invoicekind.flag&1)=0) AND ((invoicekind.flag&2)=0)







GO

-- VERIFICA DI invoiceexpavailable IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceexpavailable'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceexpavailable','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoiceexpavailable','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceexpavailable','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceexpavailable','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'detailivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '9',field = 'detailivatotal',col_precision = '19' where tablename = 'invoiceexpavailable' AND field = 'detailivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceexpavailable','N','','9','detailivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'detailtaxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '9',field = 'detailtaxabletotal',col_precision = '19' where tablename = 'invoiceexpavailable' AND field = 'detailtaxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceexpavailable','N','','9','detailtaxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','invoiceexpavailable','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceexpavailable','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceexpavailable','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'invkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'S',format = '',col_len = '50',field = 'invkind',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'invkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoiceexpavailable','S','','50','invkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'ivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '9',field = 'ivatotal',col_precision = '19' where tablename = 'invoiceexpavailable' AND field = 'ivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceexpavailable','N','','9','ivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'linkedtotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '9',field = 'linkedtotal',col_precision = '19' where tablename = 'invoiceexpavailable' AND field = 'linkedtotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceexpavailable','N','','9','linkedtotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceexpavailable','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','invoiceexpavailable','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '9',field = 'residual',col_precision = '19' where tablename = 'invoiceexpavailable' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceexpavailable','N','','9','residual','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'taxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'N',format = '',col_len = '9',field = 'taxabletotal',col_precision = '19' where tablename = 'invoiceexpavailable' AND field = 'taxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceexpavailable','N','','9','taxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpavailable' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceexpavailable',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceexpavailable' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceexpavailable','S','','2','yinv','')
GO

-- VERIFICA DI invoiceexpavailable IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceexpavailable')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceexpavailable'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceexpavailable', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceexpenselinked
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceexpenselinked]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceexpenselinked]
GO





CREATE                                   VIEW [invoiceexpenselinked]
	(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flag,
	flagbuysell,
	flagvariation,
	idreg,
	registry,
	registryreference,
	description,
	paymentexpiring,
	idexpirationkind,
	idcurrency,
	codecurrency,
	currency,
	exchangerate,
	doc,
	docdate,
	adate,
	packinglistnum,
	packinglistdate,
	officiallyprinted,
	txt,
	cu, 
	ct, 
	lu, 
	lt
	)
	AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoice.yinv,
	invoice.ninv,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	invoice.idreg,
	registry.title,
	invoice.registryreference,
	invoice.description,
	invoice.paymentexpiring,
	invoice.idexpirationkind,
	invoice.idcurrency,
	currency.codecurrency,
	currency.description,
	invoice.exchangerate,
	invoice.doc,
	invoice.docdate,
	invoice.adate,
	invoice.packinglistnum,
	invoice.packinglistdate,
	invoice.officiallyprinted,
	invoice.txt,
	invoice.cu, 
	invoice.ct, 
	invoice.lu,
	invoice.lt 
	FROM invoice (NOLOCK)
	JOIN invoicekind(NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
	LEFT OUTER JOIN currency (NOLOCK)
	ON currency.idcurrency = invoice.idcurrency
	WHERE EXISTS
		(SELECT * FROM expenseinvoice
		WHERE expenseinvoice.idinvkind = invoice.idinvkind
		AND expenseinvoice.yinv=invoice.yinv
		AND expenseinvoice.ninv=invoice.ninv)









GO

-- VERIFICA DI invoiceexpenselinked IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceexpenselinked'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoiceexpenselinked','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoiceexpenselinked','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceexpenselinked','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceexpenselinked','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceexpenselinked','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoiceexpenselinked','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceexpenselinked','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','invoiceexpenselinked','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceexpenselinked','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoiceexpenselinked','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoiceexpenselinked','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceexpenselinked','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceexpenselinked','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceexpenselinked','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceexpenselinked','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceexpenselinked','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceexpenselinked','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoiceexpenselinked','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceexpenselinked','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceexpenselinked','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceexpenselinked','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','invoiceexpenselinked','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'packinglistdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '4',field = 'packinglistdate',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'packinglistdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceexpenselinked','N','','4','packinglistdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'packinglistnum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(25)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '25',field = 'packinglistnum',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'packinglistnum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(25)','N','invoiceexpenselinked','N','','25','packinglistnum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoiceexpenselinked','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoiceexpenselinked','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceexpenselinked','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','invoiceexpenselinked','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceexpenselinked' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceexpenselinked',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceexpenselinked' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceexpenselinked','S','','2','yinv','')
GO

-- VERIFICA DI invoiceexpenselinked IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceexpenselinked')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceexpenselinked'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceexpenselinked', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceincavailable
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceincavailable]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceincavailable]
GO







CREATE  VIEW [invoiceincavailable]
(
	idinvkind,
	codeinvkind,
	yinv,
	ninv,
	invkind,
	registry,
	description,
	doc,
	docdate,
	adate,
	taxabletotal,
	ivatotal,
	detailtaxabletotal,
	detailivatotal,
	linkedtotal,
	residual,
	active
)
AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoice.yinv,
	invoice.ninv,
	invoicekind.description,
	registry.title,
	invoice.description,
	invoice.doc,
	invoice.docdate,
	invoice.adate,
	totinvoiceview.taxabletotal, -- totale imponibile su tutta la fattura
	totinvoiceview.ivatotal,--totale iva su tutta la fattura
	totinvoicedetailview.taxabletotal,--totale imponibile dei dettagli associati a movimenti di spesa
	totinvoicedetailview.ivatotal,--totale iva dei dettagli associati a movimenti di spesa
	--totale movimenti = somma (importo) del join di expenseinvoice con expense
	convert(decimal(19,2),ROUND(
	(SELECT ISNULL(SUM(incomeyear_starting.amount), 0) 
	FROM incomeinvoice mov (NOLOCK)
	JOIN income s (NOLOCK)
	ON s.idinc = mov.idinc
	LEFT OUTER JOIN incometotal incometotal_firstyear(NOLOCK)
	ON incometotal_firstyear.idinc = s.idinc
	AND ((incometotal_firstyear.flag & 2) <> 0 )
	LEFT OUTER JOIN incomeyear incomeyear_starting(NOLOCK) 
	ON incomeyear_starting.idinc = incometotal_firstyear.idinc
	AND incomeyear_starting.ayear = incometotal_firstyear.ayear
	WHERE mov.idinvkind = invoice.idinvkind
	AND mov.yinv = invoice.yinv
	AND mov.ninv = invoice.ninv)
	,2)),
	--residuo :somma dei dett. ordine non contabilizzati
	(SELECT CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN (invoicedetail.idinc_taxable IS  NULL) AND (invoicedetail.idinc_iva IS  NOT NULL)
			THEN
			     ROUND((ISNULL(invoicedetail.taxable,0)* invoicedetail.number)  ,2)
			WHEN ( invoicedetail.idinc_iva IS NULL) AND (invoicedetail.idinc_taxable IS  NOT NULL)
			THEN
			     ROUND( ISNULL(invoicedetail.tax,0)  ,2)
			WHEN ( invoicedetail.idinc_iva IS  NULL) AND (invoicedetail.idinc_taxable IS  NULL)
			THEN
			     ROUND((ISNULL(invoicedetail.taxable,0)* invoicedetail.number + ISNULL(invoicedetail.tax,0))  ,2)
			ELSE   0
		    END
		   ),0)
		) 
	FROM invoicedetail 
	WHERE invoicedetail.idinvkind = invoice.idinvkind
		AND invoicedetail.yinv = invoice.yinv
		AND invoicedetail.ninv = invoice.ninv),
	invoice.active
FROM invoice (NOLOCK)
JOIN invoicekind
	ON invoicekind.idinvkind = invoice.idinvkind
JOIN totinvoiceview (NOLOCK)
	ON totinvoiceview.idinvkind = invoice.idinvkind
	AND totinvoiceview.yinv = invoice.yinv
	AND totinvoiceview.ninv = invoice.ninv
LEFT OUTER JOIN totinvoicedetailview (NOLOCK)
	ON totinvoicedetailview.idinvkind = invoice.idinvkind
	AND totinvoicedetailview.yinv = invoice.yinv
	AND totinvoicedetailview.ninv = invoice.ninv
LEFT OUTER JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
WHERE ((invoicekind.flag&1)<>0) AND ((invoicekind.flag&2)=0)


GO

-- VERIFICA DI invoiceincavailable IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceincavailable'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceincavailable','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoiceincavailable','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceincavailable','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceincavailable','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'detailivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '9',field = 'detailivatotal',col_precision = '19' where tablename = 'invoiceincavailable' AND field = 'detailivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceincavailable','N','','9','detailivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'detailtaxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '9',field = 'detailtaxabletotal',col_precision = '19' where tablename = 'invoiceincavailable' AND field = 'detailtaxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceincavailable','N','','9','detailtaxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','invoiceincavailable','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceincavailable','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceincavailable','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'invkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'S',format = '',col_len = '50',field = 'invkind',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'invkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoiceincavailable','S','','50','invkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'ivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '9',field = 'ivatotal',col_precision = '19' where tablename = 'invoiceincavailable' AND field = 'ivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceincavailable','N','','9','ivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'linkedtotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '9',field = 'linkedtotal',col_precision = '19' where tablename = 'invoiceincavailable' AND field = 'linkedtotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceincavailable','N','','9','linkedtotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceincavailable','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','invoiceincavailable','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '9',field = 'residual',col_precision = '19' where tablename = 'invoiceincavailable' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceincavailable','N','','9','residual','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'taxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'N',format = '',col_len = '9',field = 'taxabletotal',col_precision = '19' where tablename = 'invoiceincavailable' AND field = 'taxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceincavailable','N','','9','taxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincavailable' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceincavailable',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceincavailable' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceincavailable','S','','2','yinv','')
GO

-- VERIFICA DI invoiceincavailable IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceincavailable')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceincavailable'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceincavailable', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceincomelinked
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceincomelinked]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceincomelinked]
GO






CREATE                                 VIEW [invoiceincomelinked]
(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flag,
	flagbuysell,
	flagvariation,
	idreg,
	registry,
	registryreference,
	description,
	paymentexpiring,
	idexpirationkind,
	idcurrency,
	codecurrency,
	currency,
	exchangerate,
	doc,
	docdate,
	adate,
	packinglistnum,
	packinglistdate,
	officiallyprinted,
	txt,
	cu, 
	ct, 
	lu, 
	lt
)
	AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoice.yinv,
	invoice.ninv,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	invoice.idreg,
	registry.title,
	invoice.registryreference,
	invoice.description,
	invoice.paymentexpiring,
	invoice.idexpirationkind,
	invoice.idcurrency,
	currency.codecurrency,
	currency.description,
	invoice.exchangerate,
	invoice.doc,
	invoice.docdate,
	invoice.adate,
	invoice.packinglistnum,
	invoice.packinglistdate,
	invoice.officiallyprinted,
	invoice.txt,
	invoice.cu, 
	invoice.ct, 
	invoice.lu,
	invoice.lt 
	FROM invoice (NOLOCK)
	JOIN invoicekind(NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
	LEFT OUTER JOIN currency (NOLOCK)
	ON currency.idcurrency = invoice.idcurrency
	WHERE EXISTS
		(SELECT * FROM incomeinvoice
		WHERE incomeinvoice.idinvkind = invoice.idinvkind
		AND incomeinvoice.yinv=invoice.yinv
		AND incomeinvoice.ninv=invoice.ninv)








GO

-- VERIFICA DI invoiceincomelinked IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceincomelinked'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoiceincomelinked','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoiceincomelinked','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceincomelinked','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceincomelinked','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceincomelinked','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoiceincomelinked','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceincomelinked','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','invoiceincomelinked','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceincomelinked','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoiceincomelinked','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoiceincomelinked','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceincomelinked','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceincomelinked','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceincomelinked','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceincomelinked','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceincomelinked','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceincomelinked','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoiceincomelinked','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceincomelinked','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceincomelinked','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceincomelinked','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','invoiceincomelinked','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'packinglistdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '4',field = 'packinglistdate',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'packinglistdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceincomelinked','N','','4','packinglistdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'packinglistnum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(25)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '25',field = 'packinglistnum',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'packinglistnum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(25)','N','invoiceincomelinked','N','','25','packinglistnum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoiceincomelinked','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoiceincomelinked','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceincomelinked','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','invoiceincomelinked','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceincomelinked' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceincomelinked',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceincomelinked' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceincomelinked','S','','2','yinv','')
GO

-- VERIFICA DI invoiceincomelinked IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceincomelinked')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceincomelinked'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceincomelinked', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoicekindyearview
IF EXISTS(select * from sysobjects where id = object_id(N'[invoicekindyearview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoicekindyearview]
GO



CREATE                              VIEW [invoicekindyearview]
(
	ayear,
	idinvkind,
	codeinvkind,
	description,
	flag,
	flagbuysell,
	flagvariation,
	flagmixed,
	idacc,
	idacc_deferred,
	idacc_discount,
	idacc_unabatable,
	proratarate,
	mixedrate,
	abatablerate,
	cu,
	ct,
	lu,
	lt
)
AS SELECT  
	IPR.ayear,	--IKY.ayear,
	IK.idinvkind,
	IK.codeinvkind,
	IK.description,
	IK.flag,
	CASE
		WHEN ((IK.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((IK.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((IK.flag&2)=0) THEN 'N'--flagmixed
		WHEN ((IK.flag&2)<>0) THEN 'S'
	END, 
	CASE
		WHEN ((IK.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((IK.flag&4)<>0) THEN 'S'
	END, 
	
	IKY.idacc,
	IKY.idacc_deferred,
	IKY.idacc_discount,
	IKY.idacc_unabatable,
	IPR.prorata,
	IM.mixed,
	CASE
		WHEN ((IK.flag&2)<>0) THEN IPR.prorata * IM.mixed
		ELSE IPR.prorata
	END,
	IK.cu,
	IK.ct,
	IK.lu,
	IK.lt
FROM invoicekind IK
CROSS JOIN iva_prorata IPR
	--ON IPR.ayear = IKY.ayear
LEFT OUTER JOIN iva_mixed IM
	ON IM.ayear = IPR.ayear
LEFT OUTER JOIN invoicekindyear IKY
	ON IK.idinvkind = IKY.idinvkind
	AND IKY.ayear = IM.ayear









GO

-- VERIFICA DI invoicekindyearview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoicekindyearview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'abatablerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '11',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,11)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '17',field = 'abatablerate',col_precision = '38' where tablename = 'invoicekindyearview' AND field = 'abatablerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','11','decimal','','S','System.Decimal','decimal(38,11)','N','invoicekindyearview','N','','17','abatablerate','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'ayear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '4',field = 'ayear',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'ayear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicekindyearview','S','','4','ayear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoicekindyearview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoicekindyearview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoicekindyearview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '50',field = 'description',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoicekindyearview','S','','50','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoicekindyearview','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicekindyearview','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'flagmixed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '1',field = 'flagmixed',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'flagmixed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicekindyearview','N','','1','flagmixed','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicekindyearview','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'idacc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '38',field = 'idacc',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'idacc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','invoicekindyearview','N','','38','idacc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'idacc_deferred')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '38',field = 'idacc_deferred',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'idacc_deferred'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','invoicekindyearview','N','','38','idacc_deferred','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'idacc_discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '38',field = 'idacc_discount',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'idacc_discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','invoicekindyearview','N','','38','idacc_discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'idacc_unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(38)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '38',field = 'idacc_unabatable',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'idacc_unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(38)','N','invoicekindyearview','N','','38','idacc_unabatable','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicekindyearview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoicekindyearview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'invoicekindyearview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoicekindyearview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'mixedrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '9',field = 'mixedrate',col_precision = '19' where tablename = 'invoicekindyearview' AND field = 'mixedrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(19,6)','N','invoicekindyearview','N','','9','mixedrate','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicekindyearview' AND field = 'proratarate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'invoicekindyearview',denynull = 'N',format = '',col_len = '9',field = 'proratarate',col_precision = '19' where tablename = 'invoicekindyearview' AND field = 'proratarate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(19,6)','N','invoicekindyearview','N','','9','proratarate','19')
GO

-- VERIFICA DI invoicekindyearview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoicekindyearview')
UPDATE customobject set isreal = 'N' where objectname = 'invoicekindyearview'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoicekindyearview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoicelinked
IF EXISTS(select * from sysobjects where id = object_id(N'[invoicelinked]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoicelinked]
GO







CREATE                                 VIEW [invoicelinked]
	(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flag,
	flagbuysell,
	flagvariation,
	idreg,
	registry,
	registryreference,
	description,
	paymentexpiring,
	idexpirationkind,
	idcurrency,
	codecurrency,
	currency,
	exchangerate,
	doc,
	docdate,
	adate,
	packinglistnum,
	packinglistdate,
	--flagintra,
	officiallyprinted,
	txt,
	cu, 
	ct, 
	lu, 
	lt
	)
	AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoice.yinv,
	invoice.ninv,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	invoice.idreg,
	registry.title,
	invoice.registryreference,
	invoice.description,
	invoice.paymentexpiring,
	invoice.idexpirationkind,
	invoice.idcurrency,
	currency.codecurrency,
	currency.description,
	invoice.exchangerate,
	invoice.doc,
	invoice.docdate,
	invoice.adate,
	invoice.packinglistnum,
	invoice.packinglistdate,
	--invoice.flagintra,
	invoice.officiallyprinted,
	invoice.txt,
	invoice.cu, 
	invoice.ct, 
	invoice.lu,
	invoice.lt 
	FROM invoice (NOLOCK)
	JOIN invoicekind(NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
	LEFT OUTER JOIN currency (NOLOCK)
	ON currency.idcurrency = invoice.idcurrency
	WHERE EXISTS
		(SELECT * FROM expenseinvoice
		WHERE expenseinvoice.idinvkind = invoice.idinvkind
		AND expenseinvoice.yinv=invoice.yinv
		AND expenseinvoice.ninv=invoice.ninv)









GO

-- VERIFICA DI invoicelinked IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoicelinked'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoicelinked' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoicelinked','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'invoicelinked' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoicelinked','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoicelinked' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoicelinked','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'invoicelinked' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoicelinked','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'invoicelinked' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoicelinked','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'invoicelinked' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoicelinked','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoicelinked' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoicelinked','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'invoicelinked' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','invoicelinked','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'invoicelinked' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoicelinked','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'invoicelinked' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoicelinked','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoicelinked' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoicelinked','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoicelinked' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicelinked','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoicelinked' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoicelinked','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'invoicelinked' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoicelinked','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'invoicelinked' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoicelinked','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoicelinked' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicelinked','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoicelinked' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicelinked','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'invoicelinked' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoicelinked','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'invoicelinked' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoicelinked','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'invoicelinked' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoicelinked','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoicelinked' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoicelinked','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'invoicelinked' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','invoicelinked','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'packinglistdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '4',field = 'packinglistdate',col_precision = '' where tablename = 'invoicelinked' AND field = 'packinglistdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoicelinked','N','','4','packinglistdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'packinglistnum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(25)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '25',field = 'packinglistnum',col_precision = '' where tablename = 'invoicelinked' AND field = 'packinglistnum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(25)','N','invoicelinked','N','','25','packinglistnum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'invoicelinked' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoicelinked','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoicelinked' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoicelinked','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'invoicelinked' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoicelinked','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'invoicelinked',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'invoicelinked' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','invoicelinked','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoicelinked' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoicelinked',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoicelinked' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoicelinked','S','','2','yinv','')
GO

-- VERIFICA DI invoicelinked IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoicelinked')
UPDATE customobject set isreal = 'N' where objectname = 'invoicelinked'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoicelinked', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceresidual
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceresidual]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceresidual]
GO




CREATE     VIEW [invoiceresidual]
(
	idinvkind,
	codeinvkind,
	yinv,
	ninv,
	description,
	idreg,
	idupb,
	registry,
	taxabletotal,
	ivatotal,
	residual,
	linkedimpon,
	linkedimpos,
	linkeddocum,
	flag,
	flagbuysell,
	flagvariation,
	ycon,
	ncon,
	active,
	upb
)
	AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoice.yinv,
	invoice.ninv,
	invoice.description,
	invoice.idreg,
	invoicedetail.idupb,
	registry.title,
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(  ROUND(invoicedetail.taxable * invoicedetail.number * 
		     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
		     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
	   ),0)
	),
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
	   ),0)
	),
	-- residuo :somma dei dett. fattura non contabilizzati 
	-- oppure 0 se la fattura è di ACQUISTO contabilizzata con fondo economale
	-- (la contabilizzazione totale è obbligatoria in questo caso)
	CASE 
	WHEN (((invoicekind.flag&1)=0) AND pettycashoperationinvoice.idinvkind IS NOT NULL)
	THEN 0
	WHEN (((invoicekind.flag&1)=0) AND pettycashoperationinvoice.idinvkind IS NULL)
	THEN CONVERT(DECIMAL(19,2),
			ISNULL(SUM(
			    CASE 
				WHEN (invoicedetail.idexp_taxable IS  NULL) AND (invoicedetail.idexp_iva IS  NOT NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
	
				WHEN (invoicedetail.idexp_iva IS NULL) AND (invoicedetail.idexp_taxable IS  NOT NULL)
				THEN
				    ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
	
				WHEN (invoicedetail.idexp_iva IS  NULL) AND (invoicedetail.idexp_taxable IS  NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2) 
				     +
				     ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
				ELSE   0
	
			    END
			   ),0)
			)
	WHEN  ((invoicekind.flag&1)<>0)
	THEN	CONVERT(DECIMAL(19,2),
			ISNULL(SUM(
			    CASE 
				WHEN (invoicedetail.idinc_taxable IS  NULL) AND (invoicedetail.idinc_iva IS  NOT NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
	
				WHEN (invoicedetail.idinc_iva IS NULL) AND (invoicedetail.idinc_taxable IS  NOT NULL)
				THEN
				    ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
	
				WHEN (invoicedetail.idinc_iva IS  NULL) AND (invoicedetail.idinc_taxable IS  NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2) 
				     +
				     ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
				ELSE   0
	
			    END
			   ),0)
			)
	END,
-- (mov.movkind = 'IMPON' )
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN ((((invoicekind.flag&1)=0) AND invoicedetail.idexp_taxable IS NOT NULL 
				AND (invoicedetail.idexp_iva IS NULL OR 
				invoicedetail.idexp_taxable<>invoicedetail.idexp_iva)) OR
			      ( ((invoicekind.flag&1)<>0) AND invoicedetail.idinc_taxable IS NOT NULL 
				AND (invoicedetail.idinc_iva IS NULL OR 
				invoicedetail.idinc_taxable<>invoicedetail.idinc_iva)) )
			THEN
			      ROUND(invoicedetail.taxable * invoicedetail.number * 
		     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
		     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
			ELSE   0
		    END
			
		   ),0)
		),

-- (mov.movkind = 'IMPOS')
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN ((((invoicekind.flag&1)=0) AND  invoicedetail.idexp_iva IS NOT NULL 
				AND  (invoicedetail.idexp_taxable IS NULL OR 
				invoicedetail.idexp_taxable<>invoicedetail.idexp_iva)) OR
			     ( ((invoicekind.flag&1)<>0) AND invoicedetail.idinc_iva IS NOT NULL 
				AND  (invoicedetail.idinc_taxable IS NULL OR 
				invoicedetail.idinc_taxable<>invoicedetail.idinc_iva)) )
			
			THEN
			       ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
			ELSE   0
		    END
			
		   ),0)
		),
	
--  (mov.movkind = 'DOCUM' )
	CASE 
		WHEN (((invoicekind.flag&1)=0) AND pettycashoperationinvoice.idinvkind IS NOT NULL)
			THEN 
				CONVERT(DECIMAL(19,2),
						ISNULL(SUM(  ROUND(invoicedetail.taxable * invoicedetail.number * 
						     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
						     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
					   ),0)
					)
				+
				CONVERT(DECIMAL(19,2),
					ISNULL(SUM(ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
				   ),0)
				)
		ELSE
			CONVERT(DECIMAL(19,2),
			ISNULL(SUM(
			    CASE 
				WHEN ((((invoicekind.flag&1)=0) AND invoicedetail.idexp_taxable IS NOT NULL 
					AND invoicedetail.idexp_iva= invoicedetail.idexp_taxable) OR
				     ( ((invoicekind.flag&1)<>0) AND invoicedetail.idinc_taxable IS NOT NULL 
					AND invoicedetail.idinc_iva= invoicedetail.idinc_taxable))
				THEN
		  		     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2) 
				     +
				     ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)			
				ELSE   0
			    END
			   ),0)
			)
	END,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	profservice.ycon,
	profservice.ncon,
	invoice.active,
	upb.title
	FROM invoicedetail (NOLOCK)
	JOIN invoice (NOLOCK)
  	ON invoicedetail.idinvkind = invoice.idinvkind
	AND invoicedetail.yinv = invoice.yinv
  	AND invoicedetail.ninv = invoice.ninv
	JOIN invoicekind (NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
	LEFT OUTER JOIN profservice 
	ON profservice.idinvkind=invoice.idinvkind 
	and profservice.yinv=invoice.yinv 
	and profservice.ninv=invoice.ninv
	LEFT OUTER JOIN upb
	on upb.idupb=invoicedetail.idupb
	LEFT OUTER JOIN  pettycashoperationinvoice
	ON pettycashoperationinvoice.idinvkind=invoice.idinvkind 
	and pettycashoperationinvoice.yinv=invoice.yinv 
	and pettycashoperationinvoice.ninv=invoice.ninv
	GROUP BY invoice.idinvkind, invoicekind.codeinvkind, invoice.yinv, invoice.ninv,
	invoice.description,invoice.idreg,registry.title,invoicedetail.idupb,profservice.idinvkind,
	invoicekind.flag,(invoicekind.flag&1), (invoicekind.flag&4),profservice.ycon,
	profservice.ncon, pettycashoperationinvoice.idinvkind,invoice.active,upb.title











GO

-- VERIFICA DI invoiceresidual IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceresidual'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'invoiceresidual' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceresidual','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceresidual' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceresidual','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceresidual' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceresidual','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoiceresidual' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoiceresidual','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoiceresidual' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceresidual','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoiceresidual' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceresidual','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceresidual' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidual','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoiceresidual' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidual','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'invoiceresidual' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','invoiceresidual','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'ivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '9',field = 'ivatotal',col_precision = '19' where tablename = 'invoiceresidual' AND field = 'ivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidual','N','','9','ivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'linkeddocum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(20,2)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '13',field = 'linkeddocum',col_precision = '20' where tablename = 'invoiceresidual' AND field = 'linkeddocum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(20,2)','N','invoiceresidual','N','','13','linkeddocum','20')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'linkedimpon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '9',field = 'linkedimpon',col_precision = '19' where tablename = 'invoiceresidual' AND field = 'linkedimpon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidual','N','','9','linkedimpon','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'linkedimpos')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '9',field = 'linkedimpos',col_precision = '19' where tablename = 'invoiceresidual' AND field = 'linkedimpos'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidual','N','','9','linkedimpos','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'ncon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '4',field = 'ncon',col_precision = '' where tablename = 'invoiceresidual' AND field = 'ncon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidual','N','','4','ncon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceresidual' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidual','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceresidual' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoiceresidual','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '9',field = 'residual',col_precision = '19' where tablename = 'invoiceresidual' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidual','N','','9','residual','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'taxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '9',field = 'taxabletotal',col_precision = '19' where tablename = 'invoiceresidual' AND field = 'taxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidual','N','','9','taxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'invoiceresidual' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceresidual','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'ycon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidual',denynull = 'N',format = '',col_len = '4',field = 'ycon',col_precision = '' where tablename = 'invoiceresidual' AND field = 'ycon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidual','N','','4','ycon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidual' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceresidual',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceresidual' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceresidual','S','','2','yinv','')
GO

-- VERIFICA DI invoiceresidual IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceresidual')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceresidual'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceresidual', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceresidualestimate
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceresidualestimate]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceresidualestimate]
GO



CREATE     VIEW [invoiceresidualestimate]
(
	idinvkind,
	codeinvkind,
	yinv,
	ninv,
	description,
	idreg,
	idupb,
	registry,
	taxabletotal,
	ivatotal,
	residual,
	linkedimpon,
	linkedimpos,
	linkeddocum,
	flag,
	flagbuysell,
	flagvariation,
	idinc_taxableestim,
	idinc_ivaestim,
	idestimkind,
	estimatekind,
	yestim,
	nestim,
	estimrownum,
	active,
	upb
)
	AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoice.yinv,
	invoice.ninv,
	invoice.description,
	invoice.idreg,
	invoicedetail.idupb,
	registry.title,
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(  ROUND(invoicedetail.taxable * invoicedetail.number * 
		     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
		     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
	   ),0)
	),
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
	   ),0)
	),
	-- residuo :somma dei dett. fattura non contabilizzati 
	-- oppure 0 se la fattura è di ACQUISTO contabilizzata con fondo economale
	-- (la contabilizzazione totale è obbligatoria in questo caso)
	CASE 
	WHEN ((invoicekind.flag&1)<>0) 
	THEN	CONVERT(DECIMAL(19,2),
			ISNULL(SUM(
			    CASE 
				WHEN (invoicedetail.idinc_taxable IS  NULL) AND (invoicedetail.idinc_iva IS  NOT NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
	
				WHEN (invoicedetail.idinc_iva IS NULL) AND (invoicedetail.idinc_taxable IS  NOT NULL)
				THEN
				    ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
	
				WHEN (invoicedetail.idinc_iva IS  NULL) AND (invoicedetail.idinc_taxable IS  NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2) 
				     +
				     ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
				ELSE   0
	
			    END
			   ),0)
			)
	END,
-- (mov.movkind = 'IMPON' )
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN (((invoicekind.flag&1)<>0)  AND invoicedetail.idinc_taxable IS NOT NULL 
				AND (invoicedetail.idinc_iva IS NULL OR 
				invoicedetail.idinc_taxable<>invoicedetail.idinc_iva)) 
			THEN
			      ROUND(invoicedetail.taxable * invoicedetail.number * 
		     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
		     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
			ELSE   0
		    END
			
		   ),0)
		),

-- (mov.movkind = 'IMPOS')
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN (((invoicekind.flag&1)<>0)  AND invoicedetail.idinc_iva IS NOT NULL 
				AND  (invoicedetail.idinc_taxable IS NULL OR 
				invoicedetail.idinc_taxable<>invoicedetail.idinc_iva)) 
			THEN
			       ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
			ELSE   0
		    END
			
		   ),0)
		),
	
--  (mov.movkind = 'DOCUM' )
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN (((invoicekind.flag&1)<>0)  AND invoicedetail.idinc_taxable IS NOT NULL 
				AND invoicedetail.idinc_iva= invoicedetail.idinc_taxable)
			THEN
	  		     ROUND(invoicedetail.taxable * invoicedetail.number * 
		     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
		     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2) 
			     +
			     ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)			
			ELSE   0
		    END
		   ),0)
		),
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 

	estimatedetail.idinc_taxable,
	estimatedetail.idinc_iva,
	estimatedetail.idestimkind,
	estimatekind.description,
	estimatedetail.yestim,
	estimatedetail.nestim,
	estimatedetail.rownum,
	invoice.active,
	upb.title
	FROM invoicedetail (NOLOCK)
	JOIN invoice (NOLOCK)
  	ON invoicedetail.idinvkind = invoice.idinvkind
	AND invoicedetail.yinv = invoice.yinv
  	AND invoicedetail.ninv = invoice.ninv
	JOIN invoicekind (NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
	LEFT OUTER JOIN estimatekind
	ON estimatekind.idestimkind = invoicedetail.idestimkind
	LEFT OUTER JOIN upb
	on upb.idupb=invoicedetail.idupb
	LEFT OUTER JOIN estimatedetail
	ON  estimatedetail.idestimkind=invoicedetail.idestimkind 
	and estimatedetail.yestim=invoicedetail.yestim 
	and estimatedetail.nestim=invoicedetail.nestim
	and estimatedetail.rownum=invoicedetail.estimrownum
	GROUP BY invoice.idinvkind, invoicekind.codeinvkind,invoice.yinv, invoice.ninv,
	invoicedetail.idestimkind, invoicedetail.yestim, invoicedetail.nestim,
	estimatedetail.idinc_taxable,estimatedetail.idinc_iva,
	invoice.description,invoice.idreg,registry.title,invoicedetail.idupb,
	estimatedetail.idestimkind,estimatekind.description,estimatedetail.yestim,
	estimatedetail.nestim,estimatedetail.rownum,invoicekind.flag,
	(invoicekind.flag&1), (invoicekind.flag&4),invoice.active,upb.title












GO

-- VERIFICA DI invoiceresidualestimate IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceresidualestimate'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceresidualestimate','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceresidualestimate','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceresidualestimate','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'estimatekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '150',field = 'estimatekind',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'estimatekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceresidualestimate','N','','150','estimatekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'estimrownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '4',field = 'estimrownum',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'estimrownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualestimate','N','','4','estimrownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoiceresidualestimate','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceresidualestimate','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceresidualestimate','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'idestimkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '20',field = 'idestimkind',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'idestimkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoiceresidualestimate','N','','20','idestimkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'idinc_ivaestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '4',field = 'idinc_ivaestim',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'idinc_ivaestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualestimate','N','','4','idinc_ivaestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'idinc_taxableestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '4',field = 'idinc_taxableestim',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'idinc_taxableestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualestimate','N','','4','idinc_taxableestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidualestimate','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidualestimate','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','invoiceresidualestimate','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'ivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '9',field = 'ivatotal',col_precision = '19' where tablename = 'invoiceresidualestimate' AND field = 'ivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualestimate','N','','9','ivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'linkeddocum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '9',field = 'linkeddocum',col_precision = '19' where tablename = 'invoiceresidualestimate' AND field = 'linkeddocum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualestimate','N','','9','linkeddocum','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'linkedimpon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '9',field = 'linkedimpon',col_precision = '19' where tablename = 'invoiceresidualestimate' AND field = 'linkedimpon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualestimate','N','','9','linkedimpon','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'linkedimpos')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '9',field = 'linkedimpos',col_precision = '19' where tablename = 'invoiceresidualestimate' AND field = 'linkedimpos'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualestimate','N','','9','linkedimpos','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'nestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '4',field = 'nestim',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'nestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualestimate','N','','4','nestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidualestimate','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoiceresidualestimate','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '9',field = 'residual',col_precision = '19' where tablename = 'invoiceresidualestimate' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualestimate','N','','9','residual','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'taxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '9',field = 'taxabletotal',col_precision = '19' where tablename = 'invoiceresidualestimate' AND field = 'taxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualestimate','N','','9','taxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceresidualestimate','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'yestim')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'N',format = '',col_len = '2',field = 'yestim',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'yestim'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoiceresidualestimate','N','','2','yestim','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualestimate' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceresidualestimate',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceresidualestimate' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceresidualestimate','S','','2','yinv','')
GO

-- VERIFICA DI invoiceresidualestimate IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceresidualestimate')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceresidualestimate'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceresidualestimate', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceresidualmandate
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceresidualmandate]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceresidualmandate]
GO




CREATE       VIEW [invoiceresidualmandate]
(
	idinvkind,
	codeinvkind,
	yinv,
	ninv,
	description,
	idreg,
	idupb,
	registry,
	taxabletotal,
	ivatotal,
	residual,
	linkedimpon,
	linkedimpos,
	linkeddocum,
	flag,
	flagbuysell,
	flagvariation,
	idexp_taxablemand,
	idexp_ivamand,
	ycon,
	ncon,
	idmankind,
	mandatekind,
	yman,
	nman,
	manrownum,
	active,
	upb
)
	AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoice.yinv,
	invoice.ninv,
	invoice.description,
	invoice.idreg,
	invoicedetail.idupb,
	registry.title,
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(  ROUND(invoicedetail.taxable * invoicedetail.number * 
		     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
		     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
	   ),0)
	),
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
	   ),0)
	),
	-- residuo :somma dei dett. fattura non contabilizzati 
	-- oppure 0 se la fattura è di ACQUISTO contabilizzata con fondo economale
	-- (la contabilizzazione totale è obbligatoria in questo caso)
	CASE 
	WHEN (((invoicekind.flag&1)=0) AND pettycashoperationinvoice.idinvkind IS NOT NULL)
	THEN 0
	WHEN (((invoicekind.flag&1)=0) AND pettycashoperationinvoice.idinvkind IS NULL)
	THEN CONVERT(DECIMAL(19,2),
			ISNULL(SUM(
			    CASE 
				WHEN (invoicedetail.idexp_taxable IS  NULL) AND (invoicedetail.idexp_iva IS  NOT NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
	
				WHEN (invoicedetail.idexp_iva IS NULL) AND (invoicedetail.idexp_taxable IS  NOT NULL)
				THEN
				    ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
	
				WHEN (invoicedetail.idexp_iva IS  NULL) AND (invoicedetail.idexp_taxable IS  NULL)
				THEN
				     ROUND(invoicedetail.taxable * invoicedetail.number * 
			     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
			     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2) 
				     +
				     ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
				ELSE   0
	
			    END
			   ),0)
			)
	END,
-- (mov.movkind = 'IMPON' )
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN (((invoicekind.flag&1)=0) AND invoicedetail.idexp_taxable IS NOT NULL 
				AND (invoicedetail.idexp_iva IS NULL OR 
				invoicedetail.idexp_taxable<>invoicedetail.idexp_iva)) 
			THEN
			      ROUND(invoicedetail.taxable * invoicedetail.number * 
		     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
		     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
			ELSE   0
		    END
			
		   ),0)
		),

-- (mov.movkind = 'IMPOS')
	CONVERT(DECIMAL(19,2),
		ISNULL(SUM(
		    CASE 
			WHEN (((invoicekind.flag&1)=0) AND  invoicedetail.idexp_iva IS NOT NULL 
				AND  (invoicedetail.idexp_taxable IS NULL OR 
				invoicedetail.idexp_taxable<>invoicedetail.idexp_iva)) 
			THEN
			       ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
			ELSE   0
		    END
			
		   ),0)
		),
	
--  (mov.movkind = 'DOCUM' )
	CASE 
		WHEN (((invoicekind.flag&1)=0) AND pettycashoperationinvoice.idinvkind IS NOT NULL)
		THEN 
			CONVERT(DECIMAL(19,2),
					ISNULL(SUM(  ROUND(invoicedetail.taxable * invoicedetail.number * 
					     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
					     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2)
				   ),0)
				)
			+
			CONVERT(DECIMAL(19,2),
				ISNULL(SUM(ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)
			   ),0)
			)
		ELSE
			CONVERT(DECIMAL(19,2),
				ISNULL(SUM(
				    CASE 
					WHEN ((((invoicekind.flag&1)=0) AND invoicedetail.idexp_taxable IS NOT NULL 
						AND invoicedetail.idexp_iva= invoicedetail.idexp_taxable) )
					THEN
			  		     ROUND(invoicedetail.taxable * invoicedetail.number * 
				     	     CONVERT(decimal(19,6),invoice.exchangerate) * 
				     	     (1 - CONVERT(decimal(19,6),ISNULL(invoicedetail.discount, 0.0))),2) 
					     +
					     ROUND(invoicedetail.tax * CONVERT(decimal(19,6), invoice.exchangerate),2)			
					ELSE   0
				    END
				   ),0)
				)
	END,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	mandatedetail.idexp_taxable,
	mandatedetail.idexp_iva,
	profservice.ycon,
	profservice.ncon,
	mandatedetail.idmankind,
	mandatekind.description,
	mandatedetail.yman,
	mandatedetail.nman,
	mandatedetail.rownum,
	invoice.active,
	upb.title
	FROM invoicedetail (NOLOCK)
	JOIN invoice (NOLOCK)
  	ON invoicedetail.idinvkind = invoice.idinvkind
	AND invoicedetail.yinv = invoice.yinv
  	AND invoicedetail.ninv = invoice.ninv
	JOIN invoicekind (NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
	LEFT OUTER JOIN profservice 
	ON profservice.idinvkind=invoice.idinvkind 
	and profservice.yinv=invoice.yinv 
	and profservice.ninv=invoice.ninv
	LEFT OUTER JOIN upb
	on upb.idupb=invoicedetail.idupb
	LEFT OUTER JOIN mandatedetail
	ON  mandatedetail.idmankind=invoicedetail.idmankind 
	and mandatedetail.yman=invoicedetail.yman 
	and mandatedetail.nman=invoicedetail.nman
	and mandatedetail.rownum=invoicedetail.manrownum
	LEFT OUTER JOIN mandatekind
	ON mandatekind.idmankind = mandatedetail.idmankind
	LEFT OUTER JOIN  pettycashoperationinvoice
	ON pettycashoperationinvoice.idinvkind=invoice.idinvkind 
	and pettycashoperationinvoice.yinv=invoice.yinv 
	and pettycashoperationinvoice.ninv=invoice.ninv
	GROUP BY invoice.idinvkind, invoicekind.codeinvkind, invoice.yinv, invoice.ninv,
	invoicedetail.idmankind, invoicedetail.yman, invoicedetail.nman,
	mandatedetail.idexp_taxable,mandatedetail.idexp_iva,
	invoice.description,invoice.idreg,registry.title,invoicedetail.idupb,profservice.idinvkind,
	mandatedetail.idmankind,mandatekind.description,mandatedetail.yman,mandatedetail.nman, mandatedetail.rownum,
	invoicekind.flag,(invoicekind.flag&1),(invoicekind.flag&4),profservice.ycon,
	profservice.ncon, pettycashoperationinvoice.idinvkind,invoice.active,upb.title













GO

-- VERIFICA DI invoiceresidualmandate IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceresidualmandate'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceresidualmandate','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceresidualmandate','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceresidualmandate','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoiceresidualmandate','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceresidualmandate','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceresidualmandate','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'idexp_ivamand')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '4',field = 'idexp_ivamand',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'idexp_ivamand'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualmandate','N','','4','idexp_ivamand','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'idexp_taxablemand')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '4',field = 'idexp_taxablemand',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'idexp_taxablemand'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualmandate','N','','4','idexp_taxablemand','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidualmandate','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoiceresidualmandate','N','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidualmandate','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','invoiceresidualmandate','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'ivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '9',field = 'ivatotal',col_precision = '19' where tablename = 'invoiceresidualmandate' AND field = 'ivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualmandate','N','','9','ivatotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'linkeddocum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(20,2)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '13',field = 'linkeddocum',col_precision = '20' where tablename = 'invoiceresidualmandate' AND field = 'linkeddocum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(20,2)','N','invoiceresidualmandate','N','','13','linkeddocum','20')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'linkedimpon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '9',field = 'linkedimpon',col_precision = '19' where tablename = 'invoiceresidualmandate' AND field = 'linkedimpon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualmandate','N','','9','linkedimpon','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'linkedimpos')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '9',field = 'linkedimpos',col_precision = '19' where tablename = 'invoiceresidualmandate' AND field = 'linkedimpos'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualmandate','N','','9','linkedimpos','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'mandatekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '150',field = 'mandatekind',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'mandatekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceresidualmandate','N','','150','mandatekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'manrownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '4',field = 'manrownum',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'manrownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualmandate','N','','4','manrownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'ncon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '4',field = 'ncon',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'ncon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualmandate','N','','4','ncon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceresidualmandate','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualmandate','N','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoiceresidualmandate','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '9',field = 'residual',col_precision = '19' where tablename = 'invoiceresidualmandate' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualmandate','N','','9','residual','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'taxabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '9',field = 'taxabletotal',col_precision = '19' where tablename = 'invoiceresidualmandate' AND field = 'taxabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','invoiceresidualmandate','N','','9','taxabletotal','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceresidualmandate','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'ycon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '4',field = 'ycon',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'ycon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceresidualmandate','N','','4','ycon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceresidualmandate','S','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceresidualmandate' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceresidualmandate',denynull = 'N',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'invoiceresidualmandate' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoiceresidualmandate','N','','2','yman','')
GO

-- VERIFICA DI invoiceresidualmandate IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceresidualmandate')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceresidualmandate'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceresidualmandate', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA invoiceview
IF EXISTS(select * from sysobjects where id = object_id(N'[invoiceview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [invoiceview]
GO




CREATE  VIEW [invoiceview]
(
	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flag,
	flagbuysell,
	flagvariation,
	idreg,
	registry,
	registryreference,
	description,
	paymentexpiring,
	idexpirationkind,
	idcurrency,
	codecurrency,
	currency,
	exchangerate,
	doc,
	docdate,
	adate,
	packinglistnum,
	packinglistdate,
	officiallyprinted,
	flagdeferred,
	taxable,
	tax,
	unabatable,
	total,
	active,
	txt,
	cu, 
	ct, 
	lu, 
	lt,
	ycon,
	ncon
)

	AS SELECT
	invoice.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	invoice.yinv,
	invoice.ninv,
	invoicekind.flag,
	CASE
		WHEN ((invoicekind.flag&1)=0) THEN 'A'--flagbuysell
		WHEN ((invoicekind.flag&1)<>0) THEN 'V'
	END, 
	CASE
		WHEN ((invoicekind.flag&4)=0) THEN 'N'--flagvariation
		WHEN ((invoicekind.flag&4)<>0) THEN 'S'
	END, 
	invoice.idreg,
	registry.title,
	invoice.registryreference,
	invoice.description,
	invoice.paymentexpiring,
	invoice.idexpirationkind,
	invoice.idcurrency,
	currency.codecurrency,
	currency.description,
	invoice.exchangerate,
	invoice.doc,
	invoice.docdate,
	invoice.adate,
	invoice.packinglistnum,
	invoice.packinglistdate,
	--invoice.flagintra,
	invoice.officiallyprinted,
	invoice.flagdeferred,
	ISNULL(
		(SELECT
 	    SUM(
			ROUND(D.taxable * D.number * CONVERT(decimal(19,6),M.exchangerate) *
				(1 - CONVERT(decimal(19,6),ISNULL(D.discount, 0.0)))
			,2)
		)
		FROM invoicedetail D
		JOIN invoice M
		ON D.idinvkind = M.idinvkind
		AND D.yinv = M.yinv
		AND D.ninv = M.ninv
		WHERE D.idinvkind = invoice.idinvkind
		AND D.yinv = invoice.yinv
		AND D.ninv = invoice.ninv)
	, 0),
	ISNULL(
		(SELECT SUM(ROUND(D.tax * CONVERT(decimal(19,6),M.exchangerate),2))
		FROM invoicedetail D
		JOIN invoice M 
		ON D.idinvkind = M.idinvkind
		AND D.yinv = M.yinv
		AND D.ninv = M.ninv
		WHERE D.idinvkind = invoice.idinvkind
		AND D.yinv = invoice.yinv
		AND D.ninv = invoice.ninv)
	, 0),
	ISNULL(
		(SELECT
		SUM(ROUND(D.unabatable * CONVERT(decimal(19,6),M.exchangerate),2))
		FROM invoicedetail D
		JOIN invoice M 
		ON D.idinvkind = M.idinvkind
		AND D.yinv = M.yinv
		AND D.ninv = M.ninv
		WHERE D.idinvkind = invoice.idinvkind
		AND D.yinv = invoice.yinv
		AND D.ninv = invoice.ninv)
	, 0),
	ISNULL(
		(SELECT
 	    SUM(
			ROUND(D.taxable * D.number * CONVERT(decimal(19,6),M.exchangerate) *
				(1 - CONVERT(decimal(19,6),ISNULL(D.discount, 0.0)))
			,2)
		)
		FROM invoicedetail D
		JOIN invoice M 
		ON D.idinvkind = M.idinvkind
		AND D.yinv = M.yinv
		AND D.ninv = M.ninv
		WHERE D.idinvkind = invoice.idinvkind
		AND D.yinv = invoice.yinv
		AND D.ninv = invoice.ninv)
	, 0) +
	ISNULL(
		(SELECT SUM(ROUND(D.tax * CONVERT(decimal(19,6),M.exchangerate),2))
		FROM invoicedetail D
		JOIN invoice M 
		ON D.idinvkind = M.idinvkind
		AND D.yinv = M.yinv
		AND D.ninv = M.ninv
		WHERE D.idinvkind = invoice.idinvkind
		AND D.yinv = invoice.yinv
		AND D.ninv = invoice.ninv)
	, 0),
	invoice.active,
	invoice.txt,
	invoice.cu, 
	invoice.ct, 
	invoice.lu,
	invoice.lt,
	profservice.ycon,
	profservice.ncon
	FROM invoice (NOLOCK)
	JOIN invoicekind(NOLOCK)
	ON invoicekind.idinvkind = invoice.idinvkind
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg
	LEFT OUTER JOIN currency (NOLOCK)
	ON currency.idcurrency = invoice.idcurrency
	LEFT OUTER JOIN profservice 
	ON profservice.idinvkind=invoice.idinvkind and profservice.yinv=invoice.yinv and profservice.ninv=invoice.ninv









GO

-- VERIFICA DI invoiceview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'invoiceview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'invoiceview' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceview','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'invoiceview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','invoiceview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'invoiceview' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','invoiceview','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'invoiceview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','invoiceview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'invoiceview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'invoiceview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'invoiceview' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','invoiceview','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'invoiceview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','invoiceview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'invoiceview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','invoiceview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'invoiceview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'invoiceview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','invoiceview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'flag')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'tinyint',defaultvalue = '',allownull = 'N',systemtype = 'System.Byte',sqldeclaration = 'tinyint',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '1',field = 'flag',col_precision = '' where tablename = 'invoiceview' AND field = 'flag'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','tinyint','','N','System.Byte','tinyint','N','invoiceview','S','','1','flag','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'flagbuysell')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '1',field = 'flagbuysell',col_precision = '' where tablename = 'invoiceview' AND field = 'flagbuysell'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceview','N','','1','flagbuysell','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'flagdeferred')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '1',field = 'flagdeferred',col_precision = '' where tablename = 'invoiceview' AND field = 'flagdeferred'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceview','N','','1','flagdeferred','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'flagvariation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(1)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '1',field = 'flagvariation',col_precision = '' where tablename = 'invoiceview' AND field = 'flagvariation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(1)','N','invoiceview','N','','1','flagvariation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'invoiceview' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceview','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'invoiceview' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','invoiceview','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'invoiceview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'invoiceview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceview','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'invoiceview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','invoiceview','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'invoiceview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','invoiceview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'invoiceview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','invoiceview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'ncon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '4',field = 'ncon',col_precision = '' where tablename = 'invoiceview' AND field = 'ncon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceview','N','','4','ncon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'invoiceview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','invoiceview','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'invoiceview' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','invoiceview','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'packinglistdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '4',field = 'packinglistdate',col_precision = '' where tablename = 'invoiceview' AND field = 'packinglistdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','invoiceview','N','','4','packinglistdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'packinglistnum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(25)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '25',field = 'packinglistnum',col_precision = '' where tablename = 'invoiceview' AND field = 'packinglistnum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(25)','N','invoiceview','N','','25','packinglistnum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'invoiceview' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','invoiceview','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'invoiceview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','invoiceview','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'invoiceview' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','invoiceview','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '17',field = 'tax',col_precision = '38' where tablename = 'invoiceview' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','N','System.Decimal','decimal(38,7)','N','invoiceview','S','','17','tax','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '17',field = 'taxable',col_precision = '38' where tablename = 'invoiceview' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(38,6)','N','invoiceview','S','','17','taxable','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'total')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '17',field = 'total',col_precision = '38' where tablename = 'invoiceview' AND field = 'total'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','invoiceview','N','','17','total','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'invoiceview' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','invoiceview','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '17',field = 'unabatable',col_precision = '38' where tablename = 'invoiceview' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','N','System.Decimal','decimal(38,7)','N','invoiceview','S','','17','unabatable','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'ycon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'invoiceview',denynull = 'N',format = '',col_len = '4',field = 'ycon',col_precision = '' where tablename = 'invoiceview' AND field = 'ycon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','invoiceview','N','','4','ycon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'invoiceview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'invoiceview',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'invoiceview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','invoiceview','S','','2','yinv','')
GO

-- VERIFICA DI invoiceview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'invoiceview')
UPDATE customobject set isreal = 'N' where objectname = 'invoiceview'
ELSE
INSERT INTO customobject (objectname, isreal) values('invoiceview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA itinerationrefundruledetailview
IF EXISTS(select * from sysobjects where id = object_id(N'[dbo].[itinerationrefundruledetailview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [dbo].[itinerationrefundruledetailview]
GO



CREATE VIEW DBO.itinerationrefundruledetailview
(
	iditinerationrefundrule,
	ruledescr,
	iddetail,
	start,
	iditinerationrefundkindgroup,
	itinerationrefundkindgroup,
	idposition,
	codeposition,
	position,
	minincomeclass,
	maxincomeclass,
	flag_italy,
	flag_eu,
	flag_extraeu,
	nhour_min,
	nhour_max,
	limit,
	advancepercentage,
	ct, cu, lt, lu
)
AS SELECT 
	DET.iditinerationrefundrule,
	F.description,
	DET.iddetail,
	F.start,
	DET.iditinerationrefundkindgroup,
	G.description,
	DET.idposition,
	P.codeposition,
	P.description,
	DET.minincomeclass,
	DET.maxincomeclass,
	DET.flag_italy,
	DET.flag_eu,
	DET.flag_extraeu,
	DET.nhour_min,
	DET.nhour_max,
	DET.limit,
	DET.advancepercentage,
	DET.ct, DET.cu, DET.lt, DET.lu
FROM itinerationrefundruledetail DET
JOIN itinerationrefundrule F
	ON F.iditinerationrefundrule = DET.iditinerationrefundrule
JOIN position P
	ON P.idposition = DET.idposition
JOIN itinerationrefundkindgroup G
	ON G.iditinerationrefundkindgroup = DET.iditinerationrefundkindgroup



GO

-- VERIFICA DI itinerationrefundruledetailview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'itinerationrefundruledetailview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'advancepercentage')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '9',field = 'advancepercentage',col_precision = '19' where tablename = 'itinerationrefundruledetailview' AND field = 'advancepercentage'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(19,6)','N','itinerationrefundruledetailview','S','','9','advancepercentage','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'codeposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '20',field = 'codeposition',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'codeposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','itinerationrefundruledetailview','S','','20','codeposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','itinerationrefundruledetailview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','itinerationrefundruledetailview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'flag_eu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '1',field = 'flag_eu',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'flag_eu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','itinerationrefundruledetailview','S','','1','flag_eu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'flag_extraeu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '1',field = 'flag_extraeu',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'flag_extraeu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','itinerationrefundruledetailview','S','','1','flag_extraeu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'flag_italy')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '1',field = 'flag_italy',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'flag_italy'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','itinerationrefundruledetailview','S','','1','flag_italy','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'iddetail')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '4',field = 'iddetail',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'iddetail'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','itinerationrefundruledetailview','S','','4','iddetail','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'iditinerationrefundkindgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '4',field = 'iditinerationrefundkindgroup',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'iditinerationrefundkindgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','itinerationrefundruledetailview','S','','4','iditinerationrefundkindgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'iditinerationrefundrule')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '4',field = 'iditinerationrefundrule',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'iditinerationrefundrule'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','itinerationrefundruledetailview','S','','4','iditinerationrefundrule','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'idposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '4',field = 'idposition',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'idposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','itinerationrefundruledetailview','S','','4','idposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'itinerationrefundkindgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '100',field = 'itinerationrefundkindgroup',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'itinerationrefundkindgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','itinerationrefundruledetailview','S','','100','itinerationrefundkindgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'limit')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'N',format = '',col_len = '9',field = 'limit',col_precision = '19' where tablename = 'itinerationrefundruledetailview' AND field = 'limit'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','itinerationrefundruledetailview','N','','9','limit','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','itinerationrefundruledetailview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','itinerationrefundruledetailview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'maxincomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '4',field = 'maxincomeclass',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'maxincomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','itinerationrefundruledetailview','S','','4','maxincomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'minincomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '4',field = 'minincomeclass',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'minincomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','itinerationrefundruledetailview','S','','4','minincomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'nhour_max')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'N',format = '',col_len = '4',field = 'nhour_max',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'nhour_max'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','itinerationrefundruledetailview','N','','4','nhour_max','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'nhour_min')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'N',format = '',col_len = '4',field = 'nhour_min',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'nhour_min'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','itinerationrefundruledetailview','N','','4','nhour_min','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'position')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '50',field = 'position',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'position'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','itinerationrefundruledetailview','S','','50','position','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'ruledescr')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '100',field = 'ruledescr',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'ruledescr'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','itinerationrefundruledetailview','S','','100','ruledescr','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundruledetailview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'itinerationrefundruledetailview',denynull = 'S',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'itinerationrefundruledetailview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','itinerationrefundruledetailview','S','','8','start','')
GO

-- VERIFICA DI itinerationrefundruledetailview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'itinerationrefundruledetailview')
UPDATE customobject set isreal = 'N' where objectname = 'itinerationrefundruledetailview'
ELSE
INSERT INTO customobject (objectname, isreal) values('itinerationrefundruledetailview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA itinerationrefundview
IF EXISTS(select * from sysobjects where id = object_id(N'[itinerationrefundview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [itinerationrefundview]
GO




CREATE  VIEW itinerationrefundview 
(
	yitineration,
	nitineration,
	nrefund,
	idcurrency,
	codecurrency,
	currency,
	iditinerationrefundkind,
	codeitinerationrefundkind,
	itinerationrefundkind,
	iditinerationrefundkindgroup,
	itinerationrefundkindgroup,
	description,
	amount,
	exchangerate,
	extraallowance,
	advancepercentage,
	starttime,
	stoptime,
	flagitalian,
	cu, 
	ct, 
	lu, 
	lt
)
AS SELECT
	itinerationrefund.yitineration,
	itinerationrefund.nitineration,
	itinerationrefund.nrefund,
	itinerationrefund.idcurrency,
	currency.codecurrency,
	currency.description,
	itinerationrefund.iditinerationrefundkind,
	itinerationrefundkind.codeitinerationrefundkind,
	itinerationrefundkind.description,
	itinerationrefundkindgroup.iditinerationrefundkindgroup,
	itinerationrefundkindgroup.description,
	itinerationrefund.description,
	itinerationrefund.amount,
	itinerationrefund.exchangerate,
	itinerationrefund.extraallowance,
	itinerationrefund.advancepercentage,
	itinerationrefund.starttime,
	itinerationrefund.stoptime,
	itinerationrefund.flag_geo,
	itinerationrefund.cu, 
	itinerationrefund.ct, 
	itinerationrefund.lu, 
	itinerationrefund.lt
FROM itinerationrefund
LEFT OUTER JOIN currency
	ON currency.idcurrency = itinerationrefund.idcurrency
LEFT OUTER JOIN itinerationrefundkind
	ON itinerationrefundkind.iditinerationrefundkind = itinerationrefund.iditinerationrefundkind
LEFT OUTER JOIN itinerationrefundkindgroup
	ON itinerationrefundkindgroup.iditinerationrefundkindgroup = itinerationrefundkind.iditinerationrefundkindgroup




GO

-- VERIFICA DI itinerationrefundview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'itinerationrefundview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'advancepercentage')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '8',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,8)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '9',field = 'advancepercentage',col_precision = '19' where tablename = 'itinerationrefundview' AND field = 'advancepercentage'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','8','decimal','','S','System.Decimal','decimal(19,8)','N','itinerationrefundview','N','','9','advancepercentage','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'itinerationrefundview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','itinerationrefundview','N','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','itinerationrefundview','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'codeitinerationrefundkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '20',field = 'codeitinerationrefundkind',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'codeitinerationrefundkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','itinerationrefundview','N','','20','codeitinerationrefundkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','itinerationrefundview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','itinerationrefundview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','itinerationrefundview','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','itinerationrefundview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','itinerationrefundview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'extraallowance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '9',field = 'extraallowance',col_precision = '19' where tablename = 'itinerationrefundview' AND field = 'extraallowance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','itinerationrefundview','N','','9','extraallowance','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'flagitalian')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '1',field = 'flagitalian',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'flagitalian'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','itinerationrefundview','N','','1','flagitalian','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','itinerationrefundview','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'iditinerationrefundkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '4',field = 'iditinerationrefundkind',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'iditinerationrefundkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','itinerationrefundview','N','','4','iditinerationrefundkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'iditinerationrefundkindgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '4',field = 'iditinerationrefundkindgroup',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'iditinerationrefundkindgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','itinerationrefundview','N','','4','iditinerationrefundkindgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'itinerationrefundkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '150',field = 'itinerationrefundkind',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'itinerationrefundkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','itinerationrefundview','N','','150','itinerationrefundkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'itinerationrefundkindgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '100',field = 'itinerationrefundkindgroup',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'itinerationrefundkindgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','itinerationrefundview','N','','100','itinerationrefundkindgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','itinerationrefundview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','itinerationrefundview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'nitineration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '4',field = 'nitineration',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'nitineration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','itinerationrefundview','S','','4','nitineration','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'nrefund')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '2',field = 'nrefund',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'nrefund'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','itinerationrefundview','S','','2','nrefund','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'starttime')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '8',field = 'starttime',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'starttime'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','itinerationrefundview','N','','8','starttime','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'stoptime')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'N',format = '',col_len = '8',field = 'stoptime',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'stoptime'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','itinerationrefundview','N','','8','stoptime','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'itinerationrefundview' AND field = 'yitineration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'itinerationrefundview',denynull = 'S',format = '',col_len = '2',field = 'yitineration',col_precision = '' where tablename = 'itinerationrefundview' AND field = 'yitineration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','itinerationrefundview','S','','2','yitineration','')
GO

-- VERIFICA DI itinerationrefundview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'itinerationrefundview')
UPDATE customobject set isreal = 'N' where objectname = 'itinerationrefundview'
ELSE
INSERT INTO customobject (objectname, isreal) values('itinerationrefundview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA ivapaydetailview
IF EXISTS(select * from sysobjects where id = object_id(N'[ivapaydetailview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [ivapaydetailview]
GO




--Pino Rana, elaborazione del 10/08/2005 15:18:11
CREATE  VIEW [ivapaydetailview]
(
	yivapay,
	nivapay,
	start,
	stop,
	idivaregisterkind,
	codeivaregisterkind,
	description,
	registerclass,
	iva,
	ivadeferred,
	ivatotal,
	unabatable,
	unabatabledeferred,
	unabatabletotal,
	prorata,
	mixed,
	ivanet,
	ivanetdeferred,
	cu, 
	ct, 
	lu, 
	lt
	)
	AS SELECT
	ivapaydetail.yivapay,
	ivapaydetail.nivapay,
	ivapay.start,
	ivapay.stop,
	ivapaydetail.idivaregisterkind,
	ivaregisterkind.codeivaregisterkind,
	ivaregisterkind.description,
	ivaregisterkind.registerclass,
	ivapaydetail.iva,
	ivapaydetail.ivadeferred,
	ISNULL(ivapaydetail.iva,0) + ISNULL(ivapaydetail.ivadeferred,0),
	ivapaydetail.unabatable,
	ivapaydetail.unabatabledeferred,
	ISNULL(ivapaydetail.unabatable,0) + ISNULL(ivapaydetail.unabatabledeferred,0),
	ivapaydetail.prorata,
	ivapaydetail.mixed,
	ivapaydetail.ivanet,
	ivapaydetail.ivanetdeferred,
	ivapaydetail.cu, 
	ivapaydetail.ct, 
	ivapaydetail.lu,
	ivapaydetail.lt 
	FROM ivapaydetail (NOLOCK)
	JOIN ivaregisterkind (NOLOCK)
	ON ivaregisterkind.idivaregisterkind = ivapaydetail.idivaregisterkind
  JOIN ivapay (NOLOCK)
	ON ivapay.nivapay = ivapaydetail.nivapay
	AND ivapay.yivapay = ivapaydetail.yivapay

GO

-- VERIFICA DI ivapaydetailview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'ivapaydetailview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'codeivaregisterkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '20',field = 'codeivaregisterkind',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'codeivaregisterkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','ivapaydetailview','S','','20','codeivaregisterkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','ivapaydetailview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','ivapaydetailview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '50',field = 'description',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','ivapaydetailview','S','','50','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'idivaregisterkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '4',field = 'idivaregisterkind',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'idivaregisterkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivapaydetailview','S','','4','idivaregisterkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'iva')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'iva',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'iva'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','ivapaydetailview','N','','9','iva','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'ivadeferred')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'ivadeferred',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'ivadeferred'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','ivapaydetailview','N','','9','ivadeferred','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'ivanet')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'ivanet',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'ivanet'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','ivapaydetailview','N','','9','ivanet','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'ivanetdeferred')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'ivanetdeferred',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'ivanetdeferred'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','ivapaydetailview','N','','9','ivanetdeferred','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'ivatotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(20,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '13',field = 'ivatotal',col_precision = '20' where tablename = 'ivapaydetailview' AND field = 'ivatotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(20,2)','N','ivapaydetailview','N','','13','ivatotal','20')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','ivapaydetailview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','ivapaydetailview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'mixed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'mixed',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'mixed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(19,6)','N','ivapaydetailview','N','','9','mixed','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'nivapay')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '4',field = 'nivapay',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'nivapay'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivapaydetailview','S','','4','nivapay','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'prorata')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'prorata',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'prorata'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(19,6)','N','ivapaydetailview','N','','9','prorata','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'registerclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '1',field = 'registerclass',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'registerclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','ivapaydetailview','S','','1','registerclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '4',field = 'start',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','ivapaydetailview','S','','4','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '4',field = 'stop',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','ivapaydetailview','S','','4','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'unabatable',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','ivapaydetailview','N','','9','unabatable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'unabatabledeferred')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '9',field = 'unabatabledeferred',col_precision = '19' where tablename = 'ivapaydetailview' AND field = 'unabatabledeferred'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','ivapaydetailview','N','','9','unabatabledeferred','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'unabatabletotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(20,2)',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'N',format = '',col_len = '13',field = 'unabatabletotal',col_precision = '20' where tablename = 'ivapaydetailview' AND field = 'unabatabletotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(20,2)','N','ivapaydetailview','N','','13','unabatabletotal','20')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivapaydetailview' AND field = 'yivapay')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivapaydetailview',denynull = 'S',format = '',col_len = '4',field = 'yivapay',col_precision = '' where tablename = 'ivapaydetailview' AND field = 'yivapay'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivapaydetailview','S','','4','yivapay','')
GO

-- VERIFICA DI ivapaydetailview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'ivapaydetailview')
UPDATE customobject set isreal = 'N' where objectname = 'ivapaydetailview'
ELSE
INSERT INTO customobject (objectname, isreal) values('ivapaydetailview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA ivaregisterview
IF EXISTS(select * from sysobjects where id = object_id(N'[ivaregisterview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [ivaregisterview]
GO



--Pino Rana, elaborazione del 10/08/2005 15:18:12
CREATE                               VIEW ivaregisterview 
  (
	idivaregisterkind,
	ivaregisterkind,
	codeivaregisterkind,
	registerclass,
	yivaregister,
	nivaregister,
 	idinvkind,
	codeinvkind,
	invoicekind,
	yinv,
	ninv,
	flagdeferred,
	idreg,
	registry,
	doc,
	docdate,
	adate,
	protocolnum,
	cu,
	ct,
	lu,
	lt
  )
  AS SELECT
	ivaregister.idivaregisterkind,
	ivaregisterkind.codeivaregisterkind,
	ivaregisterkind.description,
	ivaregisterkind.registerclass,
	ivaregister.yivaregister,
	ivaregister.nivaregister,
 	ivaregister.idinvkind,
	invoicekind.codeinvkind,
	invoicekind.description,
	ivaregister.yinv,
	ivaregister.ninv,
	invoice.flagdeferred,
	invoice.idreg,
	registry.title,
	invoice.doc,
	invoice.docdate,
	invoice.adate,
	ivaregister.protocolnum,
	ivaregister.cu,
	ivaregister.ct,
	ivaregister.lu,
	ivaregister.lt
  	FROM ivaregister (NOLOCK)
	JOIN ivaregisterkind (NOLOCK)
	ON ivaregisterkind.idivaregisterkind = ivaregister.idivaregisterkind
	JOIN invoicekind (NOLOCK)
	ON invoicekind.idinvkind = ivaregister.idinvkind
	JOIN invoice (NOLOCK)
	ON invoice.idinvkind = ivaregister.idinvkind
  	AND invoice.yinv = ivaregister.yinv
  	AND invoice.ninv = ivaregister.ninv
	JOIN registry (NOLOCK)
	ON registry.idreg = invoice.idreg

GO

-- VERIFICA DI ivaregisterview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'ivaregisterview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'ivaregisterview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','ivaregisterview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'ivaregisterview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','ivaregisterview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'codeivaregisterkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '50',field = 'codeivaregisterkind',col_precision = '' where tablename = 'ivaregisterview' AND field = 'codeivaregisterkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','ivaregisterview','S','','50','codeivaregisterkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'ivaregisterview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','ivaregisterview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'ivaregisterview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','ivaregisterview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'ivaregisterview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','ivaregisterview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'ivaregisterview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'ivaregisterview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','ivaregisterview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'flagdeferred')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'N',format = '',col_len = '1',field = 'flagdeferred',col_precision = '' where tablename = 'ivaregisterview' AND field = 'flagdeferred'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','ivaregisterview','N','','1','flagdeferred','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'ivaregisterview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivaregisterview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'idivaregisterkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '4',field = 'idivaregisterkind',col_precision = '' where tablename = 'ivaregisterview' AND field = 'idivaregisterkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivaregisterview','S','','4','idivaregisterkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'ivaregisterview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivaregisterview','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'ivaregisterview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','ivaregisterview','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'ivaregisterkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '20',field = 'ivaregisterkind',col_precision = '' where tablename = 'ivaregisterview' AND field = 'ivaregisterkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','ivaregisterview','S','','20','ivaregisterkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'ivaregisterview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','ivaregisterview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'ivaregisterview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','ivaregisterview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'ivaregisterview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivaregisterview','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'nivaregister')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '4',field = 'nivaregister',col_precision = '' where tablename = 'ivaregisterview' AND field = 'nivaregister'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','ivaregisterview','S','','4','nivaregister','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'protocolnum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'ivaregisterview',denynull = 'N',format = '',col_len = '4',field = 'protocolnum',col_precision = '' where tablename = 'ivaregisterview' AND field = 'protocolnum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','ivaregisterview','N','','4','protocolnum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'registerclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '1',field = 'registerclass',col_precision = '' where tablename = 'ivaregisterview' AND field = 'registerclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','ivaregisterview','S','','1','registerclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'ivaregisterview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','ivaregisterview','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'ivaregisterview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','ivaregisterview','S','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'ivaregisterview' AND field = 'yivaregister')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'ivaregisterview',denynull = 'S',format = '',col_len = '2',field = 'yivaregister',col_precision = '' where tablename = 'ivaregisterview' AND field = 'yivaregister'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','ivaregisterview','S','','2','yivaregister','')
GO

-- VERIFICA DI ivaregisterview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'ivaregisterview')
UPDATE customobject set isreal = 'N' where objectname = 'ivaregisterview'
ELSE
INSERT INTO customobject (objectname, isreal) values('ivaregisterview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA legalstatuscontract
IF EXISTS(select * from sysobjects where id = object_id(N'[dbo].[legalstatuscontract]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [dbo].[legalstatuscontract]
GO






CREATE  VIEW [DBO].[legalstatuscontract]
	(
	idreg,
	idposition,
	codeposition,
	position,
	incomeclass,
	incomeclassvalidity,
	maxincomeclass,
	start
	)
	AS SELECT 
	registrylegalstatus.idreg,
	registrylegalstatus.idposition,
	position.codeposition,
	position.description,
	isnull(registrylegalstatus.incomeclass,0),
	registrylegalstatus.incomeclassvalidity,
	position.maxincomeclass,
	registrylegalstatus.start
	FROM registrylegalstatus (NOLOCK)
	JOIN position (NOLOCK)
	ON position.idposition = registrylegalstatus.idposition
	





GO

-- VERIFICA DI legalstatuscontract IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'legalstatuscontract'
IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'codeposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'S',format = '',col_len = '20',field = 'codeposition',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'codeposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','legalstatuscontract','S','','20','codeposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'idposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'N',format = '',col_len = '4',field = 'idposition',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'idposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','legalstatuscontract','N','','4','idposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','legalstatuscontract','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'incomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'S',format = '',col_len = '2',field = 'incomeclass',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'incomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','legalstatuscontract','S','','2','incomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'incomeclassvalidity')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'N',format = '',col_len = '4',field = 'incomeclassvalidity',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'incomeclassvalidity'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','legalstatuscontract','N','','4','incomeclassvalidity','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'maxincomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'N',format = '',col_len = '2',field = 'maxincomeclass',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'maxincomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','legalstatuscontract','N','','2','maxincomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'position')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'S',format = '',col_len = '50',field = 'position',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'position'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','legalstatuscontract','S','','50','position','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'legalstatuscontract' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'legalstatuscontract',denynull = 'S',format = '',col_len = '4',field = 'start',col_precision = '' where tablename = 'legalstatuscontract' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','legalstatuscontract','S','','4','start','')
GO

-- VERIFICA DI legalstatuscontract IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'legalstatuscontract')
UPDATE customobject set isreal = 'N' where objectname = 'legalstatuscontract'
ELSE
INSERT INTO customobject (objectname, isreal) values('legalstatuscontract', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA mandatedetailgroupview
IF EXISTS(select * from sysobjects where id = object_id(N'[mandatedetailgroupview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [mandatedetailgroupview]
GO




CREATE VIEW [mandatedetailgroupview]
(
	idmankind,
	yman,
	nman,
	idgroup,
	mankind,
	idinv,
	codeinv,
	inventorytree,
  	idreg,
  	registry,
	detaildescription,
	annotations,
	number,
	taxable,
	taxrate,
	tax,
  	discount,
	assetkind,
	start,
	stop,
	taxable_euro,
	iva_euro,
	idaccmotive,
	idivakind,
	ivakind,
	unabatable,
	flagmixed,
	toinvoice,
	exchangerate,
	linktoinvoice,
	linktoasset,
	multireg,
	mandateidreg,
	mandatedetailidreg
)
	AS SELECT
	mandatedetail.idmankind,
	mandatedetail.yman,
	mandatedetail.nman,
	mandatedetail.idgroup,
	mandatekind.description,
	mandatedetail.idinv,
	inventorytree.codeinv,
	inventorytree.description,
-- 	mandate.idreg,
	CASE
		WHEN (mandate.idreg is not null) THEN (mandate.idreg)
		WHEN (mandatedetail.idreg is not null) THEN (mandatedetail.idreg)
		ELSE null
	END,
	--registry.title, 
	CASE
		WHEN (mandate.idreg is not null) THEN (select title from
						registry 
						where idreg= mandate.idreg)
		WHEN (mandatedetail.idreg is not null) THEN (select title from
						registry 
						where idreg= mandatedetail.idreg)
		ELSE null
	END,
	mandatedetail.detaildescription,
	mandatedetail.annotations,
	mandatedetail.number,
	isnull(sum(mandatedetail.taxable),0), -- sara
	mandatedetail.taxrate,
	isnull(sum(mandatedetail.tax),0), -- sara
  	mandatedetail.discount,
	mandatedetail.assetkind,
	mandatedetail.start,
	mandatedetail.stop,
	isnull(sum(
 	    ROUND(mandatedetail.taxable * mandatedetail.number * 
		  CONVERT(DECIMAL(19,6),mandate.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(mandatedetail.discount, 0.0))),2
		)
	),0) ,  -- sara

	isnull(sum(
		ROUND(mandatedetail.tax * CONVERT(decimal(19,6), mandate.exchangerate),2)
	),0) , -- sara
	mandatedetail.idaccmotive,
	mandatedetail.idivakind,
	ivakind.description,
	isnull(sum(mandatedetail.unabatable),0),
	mandatedetail.flagmixed,
	mandatedetail.toinvoice,
	mandate.exchangerate,
	mandatekind.linktoinvoice,
	mandatekind.linktoasset,
	mandatekind.multireg,
mandate.idreg,mandatedetail.idreg
FROM mandatedetail (NOLOCK)
JOIN mandatekind
	ON mandatekind.idmankind = mandatedetail.idmankind
LEFT JOIN inventorytree (NOLOCK)
	ON inventorytree.idinv = mandatedetail.idinv
JOIN mandate (NOLOCK)
	ON mandate.yman = mandatedetail.yman
	AND mandate.nman = mandatedetail.nman
	AND mandate.idmankind = mandatedetail.idmankind
JOIN ivakind
	ON ivakind.idivakind = mandatedetail.idivakind
GROUP BY 
	mandatedetail.idmankind,
	mandatedetail.yman,
	mandatedetail.nman,
	mandatedetail.idgroup,
	mandatekind.description,
	mandatedetail.idinv,
	inventorytree.codeinv,
	inventorytree.description,
 	mandate.idreg,
	mandatedetail.detaildescription,
	mandatedetail.annotations,
	mandatedetail.number,
	mandatedetail.taxrate,
  	mandatedetail.discount,
	mandatedetail.assetkind,
	mandatedetail.start,
	mandatedetail.stop,
	mandatedetail.idaccmotive,
	mandatedetail.idivakind,
	ivakind.description,
	mandatedetail.flagmixed,
	mandatedetail.toinvoice,
	mandate.exchangerate,
	mandatekind.linktoinvoice,
	mandatekind.linktoasset,
	mandatekind.multireg,
	mandate.idreg,
	mandatedetail.idreg

GO

-- VERIFICA DI mandatedetailgroupview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'mandatedetailgroupview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'annotations')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(400)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '400',field = 'annotations',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'annotations'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(400)','N','mandatedetailgroupview','N','','400','annotations','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'assetkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'assetkind',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'assetkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailgroupview','N','','1','assetkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'codeinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '50',field = 'codeinv',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'codeinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandatedetailgroupview','N','','50','codeinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatedetailgroupview','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailgroupview','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailgroupview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'flagmixed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'flagmixed',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'flagmixed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailgroupview','N','','1','flagmixed','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','mandatedetailgroupview','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'idgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'idgroup',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'idgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailgroupview','N','','4','idgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'idinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'idinv',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'idinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailgroupview','N','','4','idinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailgroupview','N','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','mandatedetailgroupview','S','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailgroupview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'inventorytree')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '150',field = 'inventorytree',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'inventorytree'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatedetailgroupview','N','','150','inventorytree','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'iva_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'iva_euro',col_precision = '38' where tablename = 'mandatedetailgroupview' AND field = 'iva_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','N','System.Decimal','decimal(38,7)','N','mandatedetailgroupview','S','','17','iva_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','mandatedetailgroupview','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'linktoasset')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'linktoasset',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'linktoasset'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailgroupview','N','','1','linktoasset','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'linktoinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'linktoinvoice',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'linktoinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailgroupview','N','','1','linktoinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'mandatedetailidreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'mandatedetailidreg',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'mandatedetailidreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailgroupview','N','','4','mandatedetailidreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'mandateidreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '4',field = 'mandateidreg',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'mandateidreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailgroupview','N','','4','mandateidreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'mankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '150',field = 'mankind',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'mankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandatedetailgroupview','S','','150','mankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'multireg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'multireg',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'multireg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailgroupview','N','','1','multireg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandatedetailgroupview','S','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'number')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '9',field = 'number',col_precision = '19' where tablename = 'mandatedetailgroupview' AND field = 'number'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandatedetailgroupview','N','','9','number','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','mandatedetailgroupview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailgroupview','N','','8','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '8',field = 'stop',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailgroupview','N','','8','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'tax',col_precision = '38' where tablename = 'mandatedetailgroupview' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','mandatedetailgroupview','S','','17','tax','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,5)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'taxable',col_precision = '38' where tablename = 'mandatedetailgroupview' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','N','System.Decimal','decimal(38,5)','N','mandatedetailgroupview','S','','17','taxable','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'taxable_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'taxable_euro',col_precision = '38' where tablename = 'mandatedetailgroupview' AND field = 'taxable_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','N','System.Decimal','decimal(38,6)','N','mandatedetailgroupview','S','','17','taxable_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'taxrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '8',field = 'taxrate',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'taxrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailgroupview','N','','8','taxrate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'toinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'N',format = '',col_len = '1',field = 'toinvoice',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'toinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailgroupview','N','','1','toinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '17',field = 'unabatable',col_precision = '38' where tablename = 'mandatedetailgroupview' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','mandatedetailgroupview','S','','17','unabatable','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailgroupview' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandatedetailgroupview',denynull = 'S',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'mandatedetailgroupview' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','mandatedetailgroupview','S','','2','yman','')
GO

-- VERIFICA DI mandatedetailgroupview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'mandatedetailgroupview')
UPDATE customobject set isreal = 'N' where objectname = 'mandatedetailgroupview'
ELSE
INSERT INTO customobject (objectname, isreal) values('mandatedetailgroupview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA mandatedetailtoinvoice
IF EXISTS(select * from sysobjects where id = object_id(N'[mandatedetailtoinvoice]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [mandatedetailtoinvoice]
GO





CREATE  VIEW [mandatedetailtoinvoice]
(
	idmankind,
	yman,
	nman,
	rownum,
	idgroup,
	mandatekind,
	idcurrency,
	codecurrency,
	codeinv,
	inventorytree,
	idreg,
	registry,
	detaildescription,
	ordered,
	invoiced,
	residual,
	taxrate,
	taxable,
	tax,
	discount,
	assetkind,
	start,
	stop,
	idupb,
	idsor1,
	idsor2,
	idsor3,
	idaccmotive,
	idivakind,
	ivakind,
	unabatable,
	flagmixed,
	competencystart,
	competencystop,
	toinvoice,
	linktoinvoice,
	linktoasset,
	multireg
)
AS SELECT 	
	mandatedetail.idmankind,
	mandatedetail.yman, 
	mandatedetail.nman, 
	mandatedetail.rownum, 
	mandatedetail.idgroup,
	mandatekind.description,
	mandate.idcurrency,
	currency.codecurrency,
	inventorytree.codeinv, 
	inventorytree.description,
	isnull(mandate.idreg,mandatedetail.idreg),
	--registry.title, 
	CASE
		WHEN (mandate.idreg is not null) THEN (select title from
						registry 
						where idreg= mandate.idreg)
		WHEN (mandatedetail.idreg is not null) THEN (select title from
						registry 
						where idreg= mandatedetail.idreg)
		ELSE null
	END,
	mandatedetail.detaildescription, 
	mandatedetail.number,	-- ordered
	(SELECT  SUM (iv.number)
	FROM (SELECT DISTINCT number,idmankind,yman,nman,manrownum,idgroup
		FROM invoicedetail) 
		AS iv
	WHERE mandatedetail.idmankind = iv.idmankind
		AND mandatedetail.yman = iv.yman
		AND mandatedetail.nman = iv.nman
		AND mandatedetail.rownum = iv.manrownum 
	),				-- invoiced
	ISNULL(mandatedetail.number, 0) 
	- (SELECT  SUM (iv.number)
   	   FROM (SELECT DISTINCT number,idmankind,yman,nman,manrownum,idgroup
		FROM invoicedetail) 
		AS iv
	  WHERE mandatedetail.idmankind = iv.idmankind
		AND mandatedetail.yman = iv.yman
		AND mandatedetail.nman = iv.nman
		AND mandatedetail.rownum = iv.manrownum 
	), 	-- residual
	mandatedetail.taxrate,
	mandatedetail.taxable,
	mandatedetail.tax,
	mandatedetail.discount,
	mandatedetail.assetkind,
	mandatedetail.start,
	mandatedetail.stop,
	mandatedetail.idupb,
	mandatedetail.idsor1,
	mandatedetail.idsor2,
	mandatedetail.idsor3,
	mandatedetail.idaccmotive,
	mandatedetail.idivakind,
	ivakind.description,
	mandatedetail.unabatable,
	mandatedetail.flagmixed,
	mandatedetail.competencystart,
	mandatedetail.competencystop,
	mandatedetail.toinvoice,
	mandatekind.linktoinvoice,
	mandatekind.linktoasset,
	mandatekind.multireg
FROM mandatedetail 
JOIN mandatekind
	ON mandatekind.idmankind = mandatedetail.idmankind
LEFT OUTER JOIN inventorytree ON inventorytree.idinv = mandatedetail.idinv
INNER JOIN mandate 
	ON mandate.idmankind = mandatedetail.idmankind
	AND mandate.yman = mandatedetail.yman
	AND mandate.nman = mandatedetail.nman
LEFT OUTER JOIN currency
	ON mandate.idcurrency = currency.idcurrency
JOIN ivakind
	ON ivakind.idivakind = mandatedetail.idivakind
WHERE mandatedetail.stop is null

GO

-- VERIFICA DI mandatedetailtoinvoice IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'mandatedetailtoinvoice'
IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'assetkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'assetkind',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'assetkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailtoinvoice','N','','1','assetkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','mandatedetailtoinvoice','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'codeinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '50',field = 'codeinv',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'codeinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandatedetailtoinvoice','N','','50','codeinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'competencystart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'competencystart',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'competencystart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailtoinvoice','N','','8','competencystart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'competencystop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'competencystop',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'competencystop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailtoinvoice','N','','8','competencystop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatedetailtoinvoice','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailtoinvoice','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'flagmixed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'flagmixed',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'flagmixed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailtoinvoice','N','','1','flagmixed','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','mandatedetailtoinvoice','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailtoinvoice','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idgroup',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailtoinvoice','N','','4','idgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailtoinvoice','N','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'S',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','mandatedetailtoinvoice','S','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailtoinvoice','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idsor1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '32',field = 'idsor1',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idsor1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','mandatedetailtoinvoice','N','','32','idsor1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idsor2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '32',field = 'idsor2',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idsor2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','mandatedetailtoinvoice','N','','32','idsor2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idsor3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '32',field = 'idsor3',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idsor3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','mandatedetailtoinvoice','N','','32','idsor3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','mandatedetailtoinvoice','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'inventorytree')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '150',field = 'inventorytree',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'inventorytree'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatedetailtoinvoice','N','','150','inventorytree','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'invoiced')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '17',field = 'invoiced',col_precision = '38' where tablename = 'mandatedetailtoinvoice' AND field = 'invoiced'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','mandatedetailtoinvoice','N','','17','invoiced','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','mandatedetailtoinvoice','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'linktoasset')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'linktoasset',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'linktoasset'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailtoinvoice','N','','1','linktoasset','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'linktoinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'linktoinvoice',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'linktoinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailtoinvoice','N','','1','linktoinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'mandatekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'S',format = '',col_len = '150',field = 'mandatekind',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'mandatekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandatedetailtoinvoice','S','','150','mandatekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'multireg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'multireg',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'multireg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailtoinvoice','N','','1','multireg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'S',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandatedetailtoinvoice','S','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'ordered')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '9',field = 'ordered',col_precision = '19' where tablename = 'mandatedetailtoinvoice' AND field = 'ordered'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandatedetailtoinvoice','N','','9','ordered','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','mandatedetailtoinvoice','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'residual')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '17',field = 'residual',col_precision = '38' where tablename = 'mandatedetailtoinvoice' AND field = 'residual'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','mandatedetailtoinvoice','N','','17','residual','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'rownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'S',format = '',col_len = '4',field = 'rownum',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'rownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandatedetailtoinvoice','S','','4','rownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailtoinvoice','N','','8','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'stop',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailtoinvoice','N','','8','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '9',field = 'tax',col_precision = '19' where tablename = 'mandatedetailtoinvoice' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandatedetailtoinvoice','N','','9','tax','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,5)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '9',field = 'taxable',col_precision = '19' where tablename = 'mandatedetailtoinvoice' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(19,5)','N','mandatedetailtoinvoice','N','','9','taxable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'taxrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '8',field = 'taxrate',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'taxrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailtoinvoice','N','','8','taxrate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'toinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '1',field = 'toinvoice',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'toinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailtoinvoice','N','','1','toinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'N',format = '',col_len = '9',field = 'unabatable',col_precision = '19' where tablename = 'mandatedetailtoinvoice' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandatedetailtoinvoice','N','','9','unabatable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailtoinvoice' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandatedetailtoinvoice',denynull = 'S',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'mandatedetailtoinvoice' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','mandatedetailtoinvoice','S','','2','yman','')
GO

-- VERIFICA DI mandatedetailtoinvoice IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'mandatedetailtoinvoice')
UPDATE customobject set isreal = 'N' where objectname = 'mandatedetailtoinvoice'
ELSE
INSERT INTO customobject (objectname, isreal) values('mandatedetailtoinvoice', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA mandatedetailview
IF EXISTS(select * from sysobjects where id = object_id(N'[mandatedetailview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [mandatedetailview]
GO


CREATE      VIEW [mandatedetailview]
(
	idmankind,
	yman,
	nman,
	rownum,
	idgroup,
	mankind,
	idinv,
	codeinv,
	inventorytree,
  	idreg,
  	registry,
	detaildescription,
	annotations,
	number,
	taxable,
	taxrate,
	tax,
  	discount,
	assetkind,
	start,
	stop,
	idexp_taxable,
	idexp_iva,	
	taxable_euro,
	iva_euro,
	rowtotal,
	idupb,
	codeupb,
	upb,
	cu,
	ct,
	lu,
	lt,
	idaccmotive,
	codemotive,
	competencystart,
	competencystop,
	idivakind,
	ivakind,
	unabatable,
	flagmixed,
	toinvoice,
	exchangerate,
	description
)
	AS SELECT
	mandatedetail.idmankind,
	mandatedetail.yman,
	mandatedetail.nman,
	mandatedetail.rownum,
	mandatedetail.idgroup,
	mandatekind.description,
	mandatedetail.idinv,
	inventorytree.codeinv,
	inventorytree.description,
 	mandatedetail.idreg,
  	registry.title,
	mandatedetail.detaildescription,
	mandatedetail.annotations,
	mandatedetail.number,
	mandatedetail.taxable,
	mandatedetail.taxrate,
	mandatedetail.tax,
  	mandatedetail.discount,
	mandatedetail.assetkind,
	mandatedetail.start,
	mandatedetail.stop,
	mandatedetail.idexp_taxable,
	mandatedetail.idexp_iva,
 	    ROUND(mandatedetail.taxable * mandatedetail.number * 
		  CONVERT(DECIMAL(19,6),mandate.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(mandatedetail.discount, 0.0))),2
		),
	ROUND(mandatedetail.tax * CONVERT(decimal(19,6), mandate.exchangerate),2),
	ROUND(mandatedetail.taxable * mandatedetail.number * 
		  CONVERT(DECIMAL(19,6),mandate.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(mandatedetail.discount, 0.0))),2
		)+
	ROUND(mandatedetail.tax * CONVERT(decimal(19,6), mandate.exchangerate),2),

	mandatedetail.idupb,
	upb.codeupb,
	upb.title,
	mandatedetail.cu,
	mandatedetail.ct,
	mandatedetail.lu,
	mandatedetail.lt,
	mandatedetail.idaccmotive,
	accmotive.codemotive,
	mandatedetail.competencystart,
	mandatedetail.competencystop,
	mandatedetail.idivakind,
	ivakind.description,
	mandatedetail.unabatable,
	mandatedetail.flagmixed,
	mandatedetail.toinvoice,
	mandate.exchangerate,
	mandate.description
FROM mandatedetail
JOIN mandatekind
	ON mandatekind.idmankind = mandatedetail.idmankind
JOIN ivakind
	ON ivakind.idivakind = mandatedetail.idivakind
LEFT JOIN inventorytree
	ON inventorytree.idinv = mandatedetail.idinv
JOIN mandate
	ON mandate.yman = mandatedetail.yman
	AND mandate.nman = mandatedetail.nman
	AND mandate.idmankind = mandatedetail.idmankind
LEFT OUTER JOIN registry
	ON registry.idreg = mandatedetail.idreg
LEFT OUTER JOIN upb
	ON upb.idupb = mandatedetail.idupb
LEFT OUTER JOIN accmotive
	ON accmotive.idaccmotive = mandatedetail.idaccmotive










GO

-- VERIFICA DI mandatedetailview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'mandatedetailview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'annotations')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(400)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '400',field = 'annotations',col_precision = '' where tablename = 'mandatedetailview' AND field = 'annotations'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(400)','N','mandatedetailview','N','','400','annotations','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'assetkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '1',field = 'assetkind',col_precision = '' where tablename = 'mandatedetailview' AND field = 'assetkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailview','N','','1','assetkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'codeinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '50',field = 'codeinv',col_precision = '' where tablename = 'mandatedetailview' AND field = 'codeinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandatedetailview','N','','50','codeinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'codemotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '50',field = 'codemotive',col_precision = '' where tablename = 'mandatedetailview' AND field = 'codemotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandatedetailview','N','','50','codemotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'codeupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '50',field = 'codeupb',col_precision = '' where tablename = 'mandatedetailview' AND field = 'codeupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandatedetailview','N','','50','codeupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'competencystart')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '8',field = 'competencystart',col_precision = '' where tablename = 'mandatedetailview' AND field = 'competencystart'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailview','N','','8','competencystart','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'competencystop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '8',field = 'competencystop',col_precision = '' where tablename = 'mandatedetailview' AND field = 'competencystop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailview','N','','8','competencystop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'mandatedetailview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandatedetailview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'mandatedetailview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandatedetailview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'mandatedetailview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandatedetailview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'mandatedetailview' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatedetailview','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'mandatedetailview' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailview','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'mandatedetailview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'flagmixed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '1',field = 'flagmixed',col_precision = '' where tablename = 'mandatedetailview' AND field = 'flagmixed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailview','N','','1','flagmixed','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','mandatedetailview','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idexp_iva')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idexp_iva',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idexp_iva'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailview','N','','4','idexp_iva','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idexp_taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idexp_taxable',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idexp_taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailview','N','','4','idexp_taxable','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idgroup',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailview','N','','4','idgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idinv',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailview','N','','4','idinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailview','N','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','mandatedetailview','S','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatedetailview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'mandatedetailview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','mandatedetailview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'inventorytree')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '150',field = 'inventorytree',col_precision = '' where tablename = 'mandatedetailview' AND field = 'inventorytree'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatedetailview','N','','150','inventorytree','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'iva_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '17',field = 'iva_euro',col_precision = '38' where tablename = 'mandatedetailview' AND field = 'iva_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','S','System.Decimal','decimal(38,7)','N','mandatedetailview','N','','17','iva_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'mandatedetailview' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','mandatedetailview','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'mandatedetailview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandatedetailview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'mandatedetailview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandatedetailview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'mankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '150',field = 'mankind',col_precision = '' where tablename = 'mandatedetailview' AND field = 'mankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandatedetailview','S','','150','mankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'mandatedetailview' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandatedetailview','S','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'number')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '9',field = 'number',col_precision = '19' where tablename = 'mandatedetailview' AND field = 'number'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandatedetailview','N','','9','number','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'mandatedetailview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','mandatedetailview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'rownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '4',field = 'rownum',col_precision = '' where tablename = 'mandatedetailview' AND field = 'rownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandatedetailview','S','','4','rownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'rowtotal')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '17',field = 'rowtotal',col_precision = '38' where tablename = 'mandatedetailview' AND field = 'rowtotal'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','mandatedetailview','N','','17','rowtotal','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'mandatedetailview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailview','N','','8','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '8',field = 'stop',col_precision = '' where tablename = 'mandatedetailview' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandatedetailview','N','','8','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '9',field = 'tax',col_precision = '19' where tablename = 'mandatedetailview' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandatedetailview','N','','9','tax','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,5)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '9',field = 'taxable',col_precision = '19' where tablename = 'mandatedetailview' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(19,5)','N','mandatedetailview','N','','9','taxable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'taxable_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '17',field = 'taxable_euro',col_precision = '38' where tablename = 'mandatedetailview' AND field = 'taxable_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','mandatedetailview','N','','17','taxable_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'taxrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '8',field = 'taxrate',col_precision = '' where tablename = 'mandatedetailview' AND field = 'taxrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatedetailview','N','','8','taxrate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'toinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '1',field = 'toinvoice',col_precision = '' where tablename = 'mandatedetailview' AND field = 'toinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatedetailview','N','','1','toinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '9',field = 'unabatable',col_precision = '19' where tablename = 'mandatedetailview' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandatedetailview','N','','9','unabatable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatedetailview',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'mandatedetailview' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatedetailview','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatedetailview' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandatedetailview',denynull = 'S',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'mandatedetailview' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','mandatedetailview','S','','2','yman','')
GO

-- VERIFICA DI mandatedetailview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'mandatedetailview')
UPDATE customobject set isreal = 'N' where objectname = 'mandatedetailview'
ELSE
INSERT INTO customobject (objectname, isreal) values('mandatedetailview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA mandategroupview
IF EXISTS(select * from sysobjects where id = object_id(N'[mandategroupview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [mandategroupview]
GO



CREATE     VIEW [mandategroupview]
(
	idmankind,
	yman,
	nman,
	rownum,
	idgroup,
	mankind,
	idinv,
	codeinv,
	inventorytree,
  	idreg,
  	registry,
	detaildescription,
	annotations,
	number,
	taxable,
	taxrate,
	tax,
  	discount,
	assetkind,
	start,
	stop,
	idexp_taxable,
	idexp_iva,	
	taxable_euro,
	iva_euro,
	idupb,
	cu,
	ct,
	lu,
	lt,
	idaccmotive,
	idivakind,
	ivakind,
	unabatable,
	flagmixed,
	toinvoice,
	exchangerate
)
	AS SELECT
	mandatedetail.idmankind,
	mandatedetail.yman,
	mandatedetail.nman,
	mandatedetail.rownum,
	mandatedetail.idgroup,
	mandatekind.description,
	mandatedetail.idinv,
	inventorytree.codeinv,
	inventorytree.description,
 	mandate.idreg,
  	registry.title,
	mandatedetail.detaildescription,
	mandatedetail.annotations,
	mandatedetail.number,
	mandatedetail.taxable,
	mandatedetail.taxrate,
	mandatedetail.tax,
  	mandatedetail.discount,
	mandatedetail.assetkind,
	mandatedetail.start,
	mandatedetail.stop,
	mandatedetail.idexp_taxable,
	mandatedetail.idexp_iva,
 	    ROUND(mandatedetail.taxable * mandatedetail.number * 
		  CONVERT(DECIMAL(19,6),mandate.exchangerate) *
		  (1 - CONVERT(DECIMAL(19,6),ISNULL(mandatedetail.discount, 0.0))),2
		),
	ROUND(mandatedetail.tax * CONVERT(decimal(19,6), mandate.exchangerate),2),
	mandatedetail.idupb,
	mandatedetail.cu,
	mandatedetail.ct,
	mandatedetail.lu,
	mandatedetail.lt,
	mandatedetail.idaccmotive,
	mandatedetail.idivakind,
	ivakind.description,
	mandatedetail.unabatable,
	mandatedetail.flagmixed,
	mandatedetail.toinvoice,
	mandate.exchangerate
FROM mandatedetail
JOIN mandatekind
	ON mandatekind.idmankind = mandatedetail.idmankind
LEFT JOIN inventorytree
	ON inventorytree.idinv = mandatedetail.idinv
JOIN ivakind
	ON ivakind.idivakind = mandatedetail.idivakind
JOIN mandate
	ON mandate.yman = mandatedetail.yman
	AND mandate.nman = mandatedetail.nman
	AND mandate.idmankind = mandatedetail.idmankind
JOIN registry
	ON registry.idreg = mandate.idreg


GO

-- VERIFICA DI mandategroupview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'mandategroupview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'annotations')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(400)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '400',field = 'annotations',col_precision = '' where tablename = 'mandategroupview' AND field = 'annotations'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(400)','N','mandategroupview','N','','400','annotations','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'assetkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '1',field = 'assetkind',col_precision = '' where tablename = 'mandategroupview' AND field = 'assetkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandategroupview','N','','1','assetkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'codeinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '50',field = 'codeinv',col_precision = '' where tablename = 'mandategroupview' AND field = 'codeinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandategroupview','N','','50','codeinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'mandategroupview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandategroupview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'mandategroupview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandategroupview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'detaildescription')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '150',field = 'detaildescription',col_precision = '' where tablename = 'mandategroupview' AND field = 'detaildescription'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandategroupview','N','','150','detaildescription','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'discount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '8',field = 'discount',col_precision = '' where tablename = 'mandategroupview' AND field = 'discount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandategroupview','N','','8','discount','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'mandategroupview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandategroupview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'flagmixed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '1',field = 'flagmixed',col_precision = '' where tablename = 'mandategroupview' AND field = 'flagmixed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandategroupview','N','','1','flagmixed','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'mandategroupview' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','mandategroupview','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idexp_iva')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '4',field = 'idexp_iva',col_precision = '' where tablename = 'mandategroupview' AND field = 'idexp_iva'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandategroupview','N','','4','idexp_iva','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idexp_taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '4',field = 'idexp_taxable',col_precision = '' where tablename = 'mandategroupview' AND field = 'idexp_taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandategroupview','N','','4','idexp_taxable','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idgroup')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '4',field = 'idgroup',col_precision = '' where tablename = 'mandategroupview' AND field = 'idgroup'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandategroupview','N','','4','idgroup','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '4',field = 'idinv',col_precision = '' where tablename = 'mandategroupview' AND field = 'idinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandategroupview','N','','4','idinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'mandategroupview' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandategroupview','N','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'mandategroupview' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','mandategroupview','S','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'mandategroupview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandategroupview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'mandategroupview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','mandategroupview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'inventorytree')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '150',field = 'inventorytree',col_precision = '' where tablename = 'mandategroupview' AND field = 'inventorytree'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandategroupview','N','','150','inventorytree','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'iva_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '7',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,7)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '17',field = 'iva_euro',col_precision = '38' where tablename = 'mandategroupview' AND field = 'iva_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','7','decimal','','S','System.Decimal','decimal(38,7)','N','mandategroupview','N','','17','iva_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'mandategroupview' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','mandategroupview','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'mandategroupview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandategroupview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'mandategroupview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandategroupview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'mankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '150',field = 'mankind',col_precision = '' where tablename = 'mandategroupview' AND field = 'mankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandategroupview','S','','150','mankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'mandategroupview' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandategroupview','S','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'number')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '9',field = 'number',col_precision = '19' where tablename = 'mandategroupview' AND field = 'number'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandategroupview','N','','9','number','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'mandategroupview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','mandategroupview','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'rownum')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '4',field = 'rownum',col_precision = '' where tablename = 'mandategroupview' AND field = 'rownum'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandategroupview','S','','4','rownum','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'mandategroupview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandategroupview','N','','8','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '8',field = 'stop',col_precision = '' where tablename = 'mandategroupview' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','mandategroupview','N','','8','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'tax')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '9',field = 'tax',col_precision = '19' where tablename = 'mandategroupview' AND field = 'tax'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandategroupview','N','','9','tax','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'taxable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '5',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,5)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '9',field = 'taxable',col_precision = '19' where tablename = 'mandategroupview' AND field = 'taxable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','5','decimal','','S','System.Decimal','decimal(19,5)','N','mandategroupview','N','','9','taxable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'taxable_euro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,6)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '17',field = 'taxable_euro',col_precision = '38' where tablename = 'mandategroupview' AND field = 'taxable_euro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(38,6)','N','mandategroupview','N','','17','taxable_euro','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'taxrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '8',field = 'taxrate',col_precision = '' where tablename = 'mandategroupview' AND field = 'taxrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandategroupview','N','','8','taxrate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'toinvoice')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '1',field = 'toinvoice',col_precision = '' where tablename = 'mandategroupview' AND field = 'toinvoice'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandategroupview','N','','1','toinvoice','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'unabatable')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'mandategroupview',denynull = 'N',format = '',col_len = '9',field = 'unabatable',col_precision = '19' where tablename = 'mandategroupview' AND field = 'unabatable'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','mandategroupview','N','','9','unabatable','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandategroupview' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandategroupview',denynull = 'S',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'mandategroupview' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','mandategroupview','S','','2','yman','')
GO

-- VERIFICA DI mandategroupview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'mandategroupview')
UPDATE customobject set isreal = 'N' where objectname = 'mandategroupview'
ELSE
INSERT INTO customobject (objectname, isreal) values('mandategroupview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA mandatelinked
IF EXISTS(select * from sysobjects where id = object_id(N'[mandatelinked]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [mandatelinked]
GO







-- Rusciano G. 01.12.2005
CREATE                                 VIEW [mandatelinked]
(
	ayear,
	idmankind, yman, nman, mankind,
	idreg, registry, registryreference, idman, 
	manager,	
	description, deliveryexpiration, deliveryaddress, paymentexpiring, 
	idexpirationkind, idcurrency, 	codecurrency, currency,
	exchangerate, doc, docdate, adate, officiallyprinted,
	txt, rtf,
	cu, ct, lu, lt
)
AS
SELECT
	accountingyear.ayear,
	mandate.idmankind, mandate.yman, mandate.nman, mandatekind.description,
	mandate.idreg, registry.title, mandate.registryreference, mandate.idman, 
	manager.title,
	mandate.description, deliveryexpiration,
	deliveryaddress, paymentexpiring, 
	idexpirationkind, mandate.idcurrency, currency.codecurrency,
	currency.description,
	mandate.exchangerate, mandate.doc, 
	mandate.docdate, adate, officiallyprinted,
	mandate.txt, mandate.rtf, 
	mandate.cu, mandate.ct, mandate.lu, mandate.lt
FROM mandate (NOLOCK)
JOIN mandatekind
	ON mandatekind.idmankind = mandate.idmankind
INNER JOIN expensemandate WITH (NOLOCK)
ON mandate.idmankind = expensemandate.idmankind
AND mandate.yman = expensemandate.yman
AND mandate.nman = expensemandate.nman
LEFT OUTER JOIN registry (NOLOCK)
ON registry.idreg = mandate.idreg
LEFT OUTER JOIN currency (NOLOCK)
ON currency.idcurrency = mandate.idcurrency
LEFT OUTER JOIN manager (NOLOCK)
ON manager.idman = mandate.idman
CROSS JOIN accountingyear
WHERE EXISTS (SELECT * 
	        FROM expensemandate AS MM 
		JOIN expenseyear II
		  ON II.idexp=MM.idexp
		 AND MM.idmankind = mandate.idmankind
		 AND MM.yman=mandate.yman
		 AND MM.nman=mandate.nman)			










GO

-- VERIFICA DI mandatelinked IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'mandatelinked'
IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'mandatelinked' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','mandatelinked','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'ayear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '2',field = 'ayear',col_precision = '' where tablename = 'mandatelinked' AND field = 'ayear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','mandatelinked','S','','2','ayear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'mandatelinked' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','mandatelinked','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'mandatelinked' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandatelinked','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'mandatelinked' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandatelinked','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'mandatelinked' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandatelinked','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'deliveryaddress')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '150',field = 'deliveryaddress',col_precision = '' where tablename = 'mandatelinked' AND field = 'deliveryaddress'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatelinked','N','','150','deliveryaddress','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'deliveryexpiration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '50',field = 'deliveryexpiration',col_precision = '' where tablename = 'mandatelinked' AND field = 'deliveryexpiration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandatelinked','N','','50','deliveryexpiration','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'mandatelinked' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandatelinked','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'mandatelinked' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','mandatelinked','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'mandatelinked' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','mandatelinked','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'mandatelinked' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandatelinked','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'mandatelinked' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatelinked','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'mandatelinked' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandatelinked','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'mandatelinked' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatelinked','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'mandatelinked' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','mandatelinked','S','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'mandatelinked' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandatelinked','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'mandatelinked' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandatelinked','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'mandatelinked' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandatelinked','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'mandatelinked' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatelinked','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'mankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '150',field = 'mankind',col_precision = '' where tablename = 'mandatelinked' AND field = 'mankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandatelinked','S','','150','mankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'mandatelinked' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandatelinked','S','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'mandatelinked' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','mandatelinked','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'mandatelinked' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','mandatelinked','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'mandatelinked' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','mandatelinked','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'mandatelinked' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandatelinked','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'rtf')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'image',defaultvalue = '',allownull = 'S',systemtype = 'System.Byte[]',sqldeclaration = 'image',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '16',field = 'rtf',col_precision = '' where tablename = 'mandatelinked' AND field = 'rtf'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','image','','S','System.Byte[]','image','N','mandatelinked','N','','16','rtf','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'mandatelinked',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'mandatelinked' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','mandatelinked','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandatelinked' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandatelinked',denynull = 'S',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'mandatelinked' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','mandatelinked','S','','2','yman','')
GO

-- VERIFICA DI mandatelinked IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'mandatelinked')
UPDATE customobject set isreal = 'N' where objectname = 'mandatelinked'
ELSE
INSERT INTO customobject (objectname, isreal) values('mandatelinked', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA mandateview
IF EXISTS(select * from sysobjects where id = object_id(N'[mandateview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [mandateview]
GO






--Pino Rana, elaborazione del 10/08/2005 15:18:03
CREATE                                VIEW [mandateview]
(
	idmankind,
	yman,
	nman,
	mankind,
	idreg,
	registry,
	registryreference,
	description,
	idman,
	manager,
	deliveryexpiration,
	deliveryaddress,
	paymentexpiring,
	idexpirationkind,
	idcurrency,
	codecurrency,
	currency,
	exchangerate,
	doc,
	docdate,
	adate,
	officiallyprinted,
	txt,
	cu, 
	ct, 
	lu, 
	lt,
	active
)
	AS SELECT
	mandate.idmankind,
	mandate.yman,
	mandate.nman,
	mandatekind.description,
	mandate.idreg,
	registry.title,
	mandate.registryreference,
	mandate.description,
	mandate.idman,
	manager.title,
	mandate.deliveryexpiration,
	mandate.deliveryaddress,
	mandate.paymentexpiring,
	mandate.idexpirationkind,
	mandate.idcurrency,
	currency.codecurrency,
	currency.description,
	mandate.exchangerate,
	mandate.doc,
	mandate.docdate,
	mandate.adate,
	mandate.officiallyprinted,
	mandate.txt,
	mandate.cu, 
	mandate.ct, 
	mandate.lu, 
	mandate.lt,
	mandate.active
	FROM mandate (NOLOCK)
	JOIN mandatekind (NOLOCK)
	ON mandatekind.idmankind = mandate.idmankind
	LEFT OUTER JOIN registry (NOLOCK)
	ON registry.idreg = mandate.idreg
	LEFT OUTER JOIN currency (NOLOCK)
	ON currency.idcurrency = mandate.idcurrency
	LEFT OUTER JOIN manager (NOLOCK)
	ON manager.idman = mandate.idman








GO

-- VERIFICA DI mandateview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'mandateview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'mandateview' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandateview','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'mandateview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','mandateview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'mandateview' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','mandateview','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'mandateview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandateview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'mandateview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandateview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'mandateview' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandateview','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'deliveryaddress')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '150',field = 'deliveryaddress',col_precision = '' where tablename = 'mandateview' AND field = 'deliveryaddress'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandateview','N','','150','deliveryaddress','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'deliveryexpiration')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '50',field = 'deliveryexpiration',col_precision = '' where tablename = 'mandateview' AND field = 'deliveryexpiration'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','mandateview','N','','50','deliveryexpiration','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'mandateview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandateview','S','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'mandateview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','mandateview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'mandateview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','mandateview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'exchangerate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'float',defaultvalue = '',allownull = 'S',systemtype = 'System.Double',sqldeclaration = 'float',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '8',field = 'exchangerate',col_precision = '' where tablename = 'mandateview' AND field = 'exchangerate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','float','','S','System.Double','float','N','mandateview','N','','8','exchangerate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'mandateview' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandateview','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'mandateview' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','mandateview','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'mandateview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandateview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'idmankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '20',field = 'idmankind',col_precision = '' where tablename = 'mandateview' AND field = 'idmankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','mandateview','S','','20','idmankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'mandateview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','mandateview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'mandateview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','mandateview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'mandateview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','mandateview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'mandateview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandateview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'mankind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '150',field = 'mankind',col_precision = '' where tablename = 'mandateview' AND field = 'mankind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(150)','N','mandateview','S','','150','mankind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'nman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '4',field = 'nman',col_precision = '' where tablename = 'mandateview' AND field = 'nman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','mandateview','S','','4','nman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'officiallyprinted')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '1',field = 'officiallyprinted',col_precision = '' where tablename = 'mandateview' AND field = 'officiallyprinted'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','mandateview','S','','1','officiallyprinted','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'mandateview' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','mandateview','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'mandateview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','mandateview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'registryreference')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '150',field = 'registryreference',col_precision = '' where tablename = 'mandateview' AND field = 'registryreference'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','mandateview','N','','150','registryreference','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'mandateview',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'mandateview' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','mandateview','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'mandateview' AND field = 'yman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'mandateview',denynull = 'S',format = '',col_len = '2',field = 'yman',col_precision = '' where tablename = 'mandateview' AND field = 'yman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','mandateview','S','','2','yman','')
GO

-- VERIFICA DI mandateview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'mandateview')
UPDATE customobject set isreal = 'N' where objectname = 'mandateview'
ELSE
INSERT INTO customobject (objectname, isreal) values('mandateview', 'N')
GO

-- GENERAZIONE DATI PER mandateview --
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA paymenttransmissionview
IF EXISTS(select * from sysobjects where id = object_id(N'[paymenttransmissionview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [paymenttransmissionview]
GO



CREATE             VIEW paymenttransmissionview 
	(
	ypaymenttransmission,
  	npaymenttransmission,
	idman,
	manager,
	idtreasurer,
	codetreasurer,
  	transmissiondate,
	total,
 	cu,
  	ct,
  	lu,
  	lt
	)
	AS SELECT
	paymenttransmission.ypaymenttransmission,
  	paymenttransmission.npaymenttransmission,
	paymenttransmission.idman,
	manager.title,
	paymenttransmission.idtreasurer,
	treasurer.codetreasurer,
 	paymenttransmission.transmissiondate,
	ISNULL((SELECT SUM(ISNULL(total,0)) FROM paymentview d 
	WHERE d.ypaymenttransmission = paymenttransmission.ypaymenttransmission AND d.npaymenttransmission = paymenttransmission.npaymenttransmission),0),
 	 paymenttransmission.cu,
  	paymenttransmission.ct,
  	paymenttransmission.lu,
  	paymenttransmission.lt
	FROM paymenttransmission (NOLOCK)
	LEFT OUTER JOIN manager (NOLOCK)
	ON manager.idman = paymenttransmission.idman
	LEFT OUTER JOIN treasurer (NOLOCK)
	ON treasurer.idtreasurer = paymenttransmission.idtreasurer

GO

-- VERIFICA DI paymenttransmissionview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'paymenttransmissionview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'codetreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'N',format = '',col_len = '20',field = 'codetreasurer',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'codetreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','paymenttransmissionview','N','','20','codetreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','paymenttransmissionview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','paymenttransmissionview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymenttransmissionview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'idtreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'N',format = '',col_len = '4',field = 'idtreasurer',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'idtreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymenttransmissionview','N','','4','idtreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','paymenttransmissionview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','paymenttransmissionview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','paymenttransmissionview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'npaymenttransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'S',format = '',col_len = '4',field = 'npaymenttransmission',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'npaymenttransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','paymenttransmissionview','S','','4','npaymenttransmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'total')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'S',format = '',col_len = '17',field = 'total',col_precision = '38' where tablename = 'paymenttransmissionview' AND field = 'total'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','paymenttransmissionview','S','','17','total','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'transmissiondate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'N',format = '',col_len = '4',field = 'transmissiondate',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'transmissiondate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','paymenttransmissionview','N','','4','transmissiondate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymenttransmissionview' AND field = 'ypaymenttransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'paymenttransmissionview',denynull = 'S',format = '',col_len = '2',field = 'ypaymenttransmission',col_precision = '' where tablename = 'paymenttransmissionview' AND field = 'ypaymenttransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','paymenttransmissionview','S','','2','ypaymenttransmission','')
GO

-- VERIFICA DI paymenttransmissionview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'paymenttransmissionview')
UPDATE customobject set isreal = 'N' where objectname = 'paymenttransmissionview'
ELSE
INSERT INTO customobject (objectname, isreal) values('paymenttransmissionview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA paymentview
IF EXISTS(select * from sysobjects where id = object_id(N'[paymentview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [paymentview]
GO





--Pino Rana, elaborazione del 10/08/2005 15:18:06
-- Inserire la ALTER  VIEW qui--
CREATE                              VIEW [paymentview]
	(
	ypay,
	npay,
	idstamphandling,
	stamphandling,
	idtreasurer,
	codetreasurer,
	kind,
	idreg,
	registry,
	idfin,
	codefin,
	finance,
	idman,
	manager,
  	ypaymenttransmission,
  	npaymenttransmission,
  	transmissiondate,
	adate,
	printdate,
	annulmentdate,
	cu,
	ct,
	lu,
	lt,
	total,
	performed,
	notperformed
	)
	AS SELECT
	payment.ypay,
	payment.npay,
	payment.idstamphandling,
	stamphandling.description,
	payment.idtreasurer,
	treasurer.codetreasurer,
	payment.kind,
	payment.idreg,
	registry.title,
	payment.idfin,
	fin.codefin,
	fin.title,
	payment.idman,
	manager.title,
  	payment.ypaymenttransmission,
  	payment.npaymenttransmission,
  	paymenttransmission.transmissiondate,
	payment.adate,
	payment.printdate,
	payment.annulmentdate,
	payment.cu,
	payment.ct,
	payment.lu,
	payment.lt,
	(SELECT SUM(curramount) from expensetotal I join expense S on I.idexp=S.idexp 
		JOIN expenselast EL ON EL.idexp = S.idexp
	 WHERE  S.ymov=payment.ypay AND 
	        EL.npay=payment.npay AND
	        I.ayear = payment.ypay),
	ISNULL((SELECT SUM(amount) from banktransaction P where
		P.ypay=payment.ypay and 
		P.npay=payment.npay),0),
	(SELECT SUM(curramount) from expensetotal I join expense S on I.idexp=S.idexp 
		JOIN expenselast EL ON EL.idexp = S.idexp
	  WHERE S.ymov=payment.ypay and EL.npay=payment.npay AND I.ayear = payment.ypay)
	  -ISNULL( (SELECT SUM(amount) from banktransaction P where
		P.ypay=payment.ypay and P.npay=payment.npay),0)
	FROM payment (NOLOCK)
	LEFT OUTER JOIN registry (NOLOCK)
	ON registry.idreg = payment.idreg
	LEFT OUTER JOIN fin (NOLOCK)
	ON fin.idfin = payment.idfin 
	LEFT OUTER JOIN manager (NOLOCK)
	ON manager.idman = payment.idman
	LEFT OUTER JOIN stamphandling (NOLOCK)
	ON stamphandling.idstamphandling = payment.idstamphandling
	LEFT OUTER JOIN paymenttransmission (NOLOCK)
	ON paymenttransmission.ypaymenttransmission = payment.ypaymenttransmission
 	AND paymenttransmission.npaymenttransmission = payment.npaymenttransmission
	LEFT OUTER JOIN treasurer (NOLOCK)
	ON treasurer.idtreasurer = payment.idtreasurer








GO

-- VERIFICA DI paymentview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'paymentview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'paymentview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','paymentview','N','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'annulmentdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '8',field = 'annulmentdate',col_precision = '' where tablename = 'paymentview' AND field = 'annulmentdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','paymentview','N','','8','annulmentdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'codefin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '50',field = 'codefin',col_precision = '' where tablename = 'paymentview' AND field = 'codefin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','paymentview','N','','50','codefin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'codetreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '20',field = 'codetreasurer',col_precision = '' where tablename = 'paymentview' AND field = 'codetreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','paymentview','N','','20','codetreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'paymentview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'paymentview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','paymentview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'paymentview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'paymentview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','paymentview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'finance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '150',field = 'finance',col_precision = '' where tablename = 'paymentview' AND field = 'finance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','paymentview','N','','150','finance','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'idfin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'idfin',col_precision = '' where tablename = 'paymentview' AND field = 'idfin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymentview','N','','4','idfin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'paymentview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymentview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'paymentview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymentview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'idstamphandling')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'idstamphandling',col_precision = '' where tablename = 'paymentview' AND field = 'idstamphandling'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymentview','N','','4','idstamphandling','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'idtreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'idtreasurer',col_precision = '' where tablename = 'paymentview' AND field = 'idtreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymentview','N','','4','idtreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'kind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'paymentview',denynull = 'S',format = '',col_len = '1',field = 'kind',col_precision = '' where tablename = 'paymentview' AND field = 'kind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','paymentview','S','','1','kind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'paymentview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','paymentview','N','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'paymentview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'paymentview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','paymentview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'paymentview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','paymentview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'notperformed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '17',field = 'notperformed',col_precision = '38' where tablename = 'paymentview' AND field = 'notperformed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','paymentview','N','','17','notperformed','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'npay')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymentview',denynull = 'S',format = '',col_len = '4',field = 'npay',col_precision = '' where tablename = 'paymentview' AND field = 'npay'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','paymentview','S','','4','npay','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'npaymenttransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'npaymenttransmission',col_precision = '' where tablename = 'paymentview' AND field = 'npaymenttransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','paymentview','N','','4','npaymenttransmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'performed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'paymentview',denynull = 'S',format = '',col_len = '17',field = 'performed',col_precision = '38' where tablename = 'paymentview' AND field = 'performed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','paymentview','S','','17','performed','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'printdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'printdate',col_precision = '' where tablename = 'paymentview' AND field = 'printdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','paymentview','N','','4','printdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'paymentview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','paymentview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'stamphandling')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '50',field = 'stamphandling',col_precision = '' where tablename = 'paymentview' AND field = 'stamphandling'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','paymentview','N','','50','stamphandling','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'total')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '17',field = 'total',col_precision = '38' where tablename = 'paymentview' AND field = 'total'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','paymentview','N','','17','total','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'transmissiondate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '4',field = 'transmissiondate',col_precision = '' where tablename = 'paymentview' AND field = 'transmissiondate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','paymentview','N','','4','transmissiondate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'ypay')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'paymentview',denynull = 'S',format = '',col_len = '2',field = 'ypay',col_precision = '' where tablename = 'paymentview' AND field = 'ypay'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','paymentview','S','','2','ypay','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'paymentview' AND field = 'ypaymenttransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'paymentview',denynull = 'N',format = '',col_len = '2',field = 'ypaymenttransmission',col_precision = '' where tablename = 'paymentview' AND field = 'ypaymenttransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','paymentview','N','','2','ypaymenttransmission','')
GO

-- VERIFICA DI paymentview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'paymentview')
UPDATE customobject set isreal = 'N' where objectname = 'paymentview'
ELSE
INSERT INTO customobject (objectname, isreal) values('paymentview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA pettycashopinvoiceview
IF EXISTS(select * from sysobjects where id = object_id(N'[pettycashopinvoiceview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [pettycashopinvoiceview]
GO


CREATE     VIEW [pettycashopinvoiceview]
(
	idinvkind,
	codeinvkind,
	yinv,
	ninv,
	idpettycash,
	pettycash,
	pettycode,
	yoperation,
	noperation,
	idaccmotive_cost,
	codemotive_cost,
	motive_cost,
	idaccmotive_debit,
	codemotive_debit,
	motive_debit,
	idfin,
	codefin,
	finance,
	idupb,
	codeupb,
	upb,
	idreg,
	registry,
	idman,
	manager,
	doc,
	docdate,
	description,
	amount,
	invoicekind,
	adate,
	idsor1,
	idsor2,
	idsor3,
	cu,
	ct,
	lu,
	lt
)
	AS SELECT
	PCOI.idinvkind,
	invoicekind.codeinvkind,
	PCOI.yinv,
	PCOI.ninv,
	PCO.idpettycash,
	pettycash.description,
	pettycash.pettycode,
	PCO.yoperation,
	PCO.noperation,
	PCO.idaccmotive_cost,
	AMC.codemotive,
	AMC.title,
	PCO.idaccmotive_debit,
	AMD.codemotive,
	AMD.title,
	PCO.idfin,
	fin.codefin,
	fin.title,
	PCO.idupb,
	upb.codeupb,
	upb.title,
	PCO.idreg,
	registry.title,
	PCO.idman,
	manager.title,
	PCO.doc,
	PCO.docdate,
	PCO.description,
	PCO.amount,
	invoicekind.description,
	invoice.adate,
	PCO.idsor1,
	PCO.idsor2,
	PCO.idsor3,
	PCOI.cu,
	PCOI.ct,
	PCOI.lu,
	PCOI.lt
FROM pettycashoperationinvoice PCOI
JOIN pettycash
	ON pettycash.idpettycash = PCOI.idpettycash
JOIN pettycashoperation PCO
	ON PCO.idpettycash = PCOI.idpettycash
	AND PCO.yoperation = PCOI.yoperation
	AND PCO.noperation = PCOI.noperation
JOIN invoice
	ON invoice.idinvkind = PCOI.idinvkind
	AND invoice.yinv = PCOI.yinv
	AND invoice.ninv = PCOI.ninv
JOIN invoicekind
	ON invoicekind.idinvkind = invoice.idinvkind
LEFT OUTER JOIN fin
	ON fin.idfin = PCO.idfin
LEFT OUTER JOIN upb
	on upb.idupb = PCO.idupb
LEFT OUTER JOIN registry
	ON registry.idreg = PCO.idreg
LEFT OUTER JOIN manager
	ON manager.idman = PCO.idman
LEFT OUTER JOIN accmotive AMC
	ON AMC.idaccmotive = PCO.idaccmotive_cost
LEFT OUTER JOIN accmotive AMD
	ON AMD.idaccmotive = PCO.idaccmotive_debit













GO

-- VERIFICA DI pettycashopinvoiceview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'pettycashopinvoiceview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','pettycashopinvoiceview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'pettycashopinvoiceview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','pettycashopinvoiceview','N','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'codefin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codefin',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'codefin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','pettycashopinvoiceview','N','','50','codefin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','pettycashopinvoiceview','S','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'codemotive_cost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codemotive_cost',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'codemotive_cost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','pettycashopinvoiceview','N','','50','codemotive_cost','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'codemotive_debit')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codemotive_debit',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'codemotive_debit'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','pettycashopinvoiceview','N','','50','codemotive_debit','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'codeupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '50',field = 'codeupb',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'codeupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','pettycashopinvoiceview','N','','50','codeupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','pettycashopinvoiceview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','pettycashopinvoiceview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(200)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '200',field = 'description',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(200)','N','pettycashopinvoiceview','S','','200','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','pettycashopinvoiceview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'docdate',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','pettycashopinvoiceview','N','','4','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'finance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'finance',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'finance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','pettycashopinvoiceview','N','','150','finance','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idaccmotive_cost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive_cost',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idaccmotive_cost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','pettycashopinvoiceview','N','','36','idaccmotive_cost','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idaccmotive_debit')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive_debit',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idaccmotive_debit'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','pettycashopinvoiceview','N','','36','idaccmotive_debit','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idfin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idfin',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idfin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','pettycashopinvoiceview','N','','4','idfin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','pettycashopinvoiceview','S','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','pettycashopinvoiceview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idpettycash')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'idpettycash',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idpettycash'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','pettycashopinvoiceview','S','','4','idpettycash','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','pettycashopinvoiceview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idsor1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '32',field = 'idsor1',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idsor1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','pettycashopinvoiceview','N','','32','idsor1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idsor2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '32',field = 'idsor2',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idsor2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','pettycashopinvoiceview','N','','32','idsor2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idsor3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '32',field = 'idsor3',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idsor3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','pettycashopinvoiceview','N','','32','idsor3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','pettycashopinvoiceview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'invoicekind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '50',field = 'invoicekind',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'invoicekind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','pettycashopinvoiceview','S','','50','invoicekind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','pettycashopinvoiceview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','pettycashopinvoiceview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','pettycashopinvoiceview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'motive_cost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'motive_cost',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'motive_cost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','pettycashopinvoiceview','N','','150','motive_cost','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'motive_debit')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'motive_debit',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'motive_debit'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','pettycashopinvoiceview','N','','150','motive_debit','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','pettycashopinvoiceview','S','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'noperation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '4',field = 'noperation',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'noperation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','pettycashopinvoiceview','S','','4','noperation','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'pettycash')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '50',field = 'pettycash',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'pettycash'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','pettycashopinvoiceview','S','','50','pettycash','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'pettycode')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '20',field = 'pettycode',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'pettycode'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','pettycashopinvoiceview','N','','20','pettycode','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','pettycashopinvoiceview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'upb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'N',format = '',col_len = '150',field = 'upb',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'upb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','pettycashopinvoiceview','N','','150','upb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','pettycashopinvoiceview','S','','2','yinv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'pettycashopinvoiceview' AND field = 'yoperation')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'pettycashopinvoiceview',denynull = 'S',format = '',col_len = '2',field = 'yoperation',col_precision = '' where tablename = 'pettycashopinvoiceview' AND field = 'yoperation'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','pettycashopinvoiceview','S','','2','yoperation','')
GO

-- VERIFICA DI pettycashopinvoiceview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'pettycashopinvoiceview')
UPDATE customobject set isreal = 'N' where objectname = 'pettycashopinvoiceview'
ELSE
INSERT INTO customobject (objectname, isreal) values('pettycashopinvoiceview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA proceedstransmissionview
IF EXISTS(select * from sysobjects where id = object_id(N'[proceedstransmissionview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [proceedstransmissionview]
GO



CREATE  VIEW proceedstransmissionview 
	(
	yproceedstransmission,
	nproceedstransmission,
	idman,
	manager,
	idtreasurer,
	codetreasurer,
	transmissiondate,
	total,
	cu,
	ct,
	lu,
	lt
	)
	AS SELECT
	proceedstransmission.yproceedstransmission,
 	 proceedstransmission.nproceedstransmission,
	proceedstransmission.idman,
	manager.title,
	proceedstransmission.idtreasurer,
	treasurer.codetreasurer,
 	 proceedstransmission.transmissiondate,
	ISNULL((SELECT SUM(ISNULL(total,0)) FROM proceedsview d 
	WHERE d.yproceedstransmission = proceedstransmission.yproceedstransmission AND d.nproceedstransmission = proceedstransmission.nproceedstransmission),0),
	  proceedstransmission.cu,
	  proceedstransmission.ct,
	  proceedstransmission.lu,
	  proceedstransmission.lt
	FROM proceedstransmission (NOLOCK)
	LEFT OUTER JOIN manager (NOLOCK)
	ON manager.idman = proceedstransmission.idman
	LEFT OUTER JOIN treasurer (NOLOCK)
	ON treasurer.idtreasurer = proceedstransmission.idtreasurer
	




GO

-- VERIFICA DI proceedstransmissionview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'proceedstransmissionview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'codetreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'N',format = '',col_len = '20',field = 'codetreasurer',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'codetreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','proceedstransmissionview','N','','20','codetreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','proceedstransmissionview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','proceedstransmissionview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','proceedstransmissionview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'idtreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'N',format = '',col_len = '4',field = 'idtreasurer',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'idtreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','proceedstransmissionview','N','','4','idtreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','proceedstransmissionview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','proceedstransmissionview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','proceedstransmissionview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'nproceedstransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'S',format = '',col_len = '4',field = 'nproceedstransmission',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'nproceedstransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','proceedstransmissionview','S','','4','nproceedstransmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'total')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'S',format = '',col_len = '17',field = 'total',col_precision = '38' where tablename = 'proceedstransmissionview' AND field = 'total'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','proceedstransmissionview','S','','17','total','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'transmissiondate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'N',format = '',col_len = '4',field = 'transmissiondate',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'transmissiondate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','proceedstransmissionview','N','','4','transmissiondate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedstransmissionview' AND field = 'yproceedstransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'proceedstransmissionview',denynull = 'S',format = '',col_len = '2',field = 'yproceedstransmission',col_precision = '' where tablename = 'proceedstransmissionview' AND field = 'yproceedstransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','proceedstransmissionview','S','','2','yproceedstransmission','')
GO

-- VERIFICA DI proceedstransmissionview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'proceedstransmissionview')
UPDATE customobject set isreal = 'N' where objectname = 'proceedstransmissionview'
ELSE
INSERT INTO customobject (objectname, isreal) values('proceedstransmissionview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA proceedsview
IF EXISTS(select * from sysobjects where id = object_id(N'[proceedsview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [proceedsview]
GO



CREATE                            VIEW [proceedsview]
	(
	ypro,
	npro,
	idtreasurer,
	codetreasurer,
	kind,
	accountkind,
	idreg,
	registry,
	idfin,
	codefin,
	finance,
	idman,
	manager,
	yproceedstransmission,
	nproceedstransmission,
	transmissiondate,
	adate,
	printdate,
	annulmentdate,
	cu,
	ct,
	lu,
	lt,	
	total,
	performed,
	notperformed
	)
	AS SELECT
	proceeds.ypro,
	proceeds.npro,
	proceeds.idtreasurer,
	treasurer.codetreasurer,
	proceeds.kind,
	proceeds.accountkind,
	proceeds.idreg,
	registry.title,
	proceeds.idfin,
	fin.codefin,
	fin.title,
	proceeds.idman,
	manager.title,
	proceeds.yproceedstransmission,
	proceeds.nproceedstransmission,
	proceedstransmission.transmissiondate,
	proceeds.adate,
	proceeds.printdate,
	proceeds.annulmentdate,
	proceeds.cu,
	proceeds.ct,
	proceeds.lu,
	proceeds.lt,
	(SELECT SUM(curramount) 
	from incometotal I 
	join income S 
		on I.idinc=S.idinc
	join incomelast ST
		on S.idinc = ST.idinc
	WHERE S.ymov=proceeds.ypro and 
		ST.npro=proceeds.npro
			AND I.ayear = proceeds.ypro
	),
	ISNULL( (SELECT SUM(amount) from banktransaction P where
					P.ypro=proceeds.ypro and 
						P.npro=proceeds.npro),0),
	(SELECT SUM(curramount) 
	from incometotal I 
	join income S 
		on I.idinc=S.idinc 
	join incomelast ST
		on S.idinc = ST.idinc
	WHERE S.ymov = proceeds.ypro and ST.npro=proceeds.npro AND I.ayear = proceeds.ypro)
	-
	 ISNULL( (SELECT SUM(amount) from banktransaction P where
					P.ypro=proceeds.ypro and P.npro=proceeds.npro),0)                             
	FROM proceeds (NOLOCK)
	LEFT OUTER JOIN registry (NOLOCK)
		ON registry.idreg = proceeds.idreg
	LEFT OUTER JOIN fin (NOLOCK)
		ON fin.idfin = proceeds.idfin
	LEFT OUTER JOIN manager (NOLOCK)
		ON manager.idman = proceeds.idman
	LEFT OUTER JOIN proceedstransmission (NOLOCK)
		ON proceedstransmission.yproceedstransmission = proceeds.yproceedstransmission
  		AND proceedstransmission.nproceedstransmission = proceeds.nproceedstransmission
	LEFT OUTER JOIN treasurer (NOLOCK)
		ON treasurer.idtreasurer = proceeds.idtreasurer
	










GO

-- VERIFICA DI proceedsview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'proceedsview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'accountkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '1',field = 'accountkind',col_precision = '' where tablename = 'proceedsview' AND field = 'accountkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','proceedsview','S','','1','accountkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '4',field = 'adate',col_precision = '' where tablename = 'proceedsview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','proceedsview','S','','4','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'annulmentdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '8',field = 'annulmentdate',col_precision = '' where tablename = 'proceedsview' AND field = 'annulmentdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','proceedsview','N','','8','annulmentdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'codefin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '50',field = 'codefin',col_precision = '' where tablename = 'proceedsview' AND field = 'codefin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','proceedsview','N','','50','codefin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'codetreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '20',field = 'codetreasurer',col_precision = '' where tablename = 'proceedsview' AND field = 'codetreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','proceedsview','N','','20','codetreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'proceedsview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','proceedsview','N','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'proceedsview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','proceedsview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'finance')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '150',field = 'finance',col_precision = '' where tablename = 'proceedsview' AND field = 'finance'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','proceedsview','N','','150','finance','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'idfin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '4',field = 'idfin',col_precision = '' where tablename = 'proceedsview' AND field = 'idfin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','proceedsview','N','','4','idfin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'idman')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '4',field = 'idman',col_precision = '' where tablename = 'proceedsview' AND field = 'idman'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','proceedsview','N','','4','idman','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'proceedsview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','proceedsview','N','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'idtreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '4',field = 'idtreasurer',col_precision = '' where tablename = 'proceedsview' AND field = 'idtreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','proceedsview','N','','4','idtreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'kind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '1',field = 'kind',col_precision = '' where tablename = 'proceedsview' AND field = 'kind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','proceedsview','S','','1','kind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'proceedsview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','proceedsview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'proceedsview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','proceedsview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'manager')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '150',field = 'manager',col_precision = '' where tablename = 'proceedsview' AND field = 'manager'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','proceedsview','N','','150','manager','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'notperformed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '17',field = 'notperformed',col_precision = '38' where tablename = 'proceedsview' AND field = 'notperformed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','proceedsview','N','','17','notperformed','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'npro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '4',field = 'npro',col_precision = '' where tablename = 'proceedsview' AND field = 'npro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','proceedsview','S','','4','npro','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'nproceedstransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '4',field = 'nproceedstransmission',col_precision = '' where tablename = 'proceedsview' AND field = 'nproceedstransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','proceedsview','N','','4','nproceedstransmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'performed')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '17',field = 'performed',col_precision = '38' where tablename = 'proceedsview' AND field = 'performed'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(38,2)','N','proceedsview','S','','17','performed','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'printdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '4',field = 'printdate',col_precision = '' where tablename = 'proceedsview' AND field = 'printdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','proceedsview','N','','4','printdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'proceedsview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','proceedsview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'total')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(38,2)',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '17',field = 'total',col_precision = '38' where tablename = 'proceedsview' AND field = 'total'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(38,2)','N','proceedsview','N','','17','total','38')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'transmissiondate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '4',field = 'transmissiondate',col_precision = '' where tablename = 'proceedsview' AND field = 'transmissiondate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','proceedsview','N','','4','transmissiondate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'ypro')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'proceedsview',denynull = 'S',format = '',col_len = '2',field = 'ypro',col_precision = '' where tablename = 'proceedsview' AND field = 'ypro'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','proceedsview','S','','2','ypro','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'proceedsview' AND field = 'yproceedstransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'proceedsview',denynull = 'N',format = '',col_len = '2',field = 'yproceedstransmission',col_precision = '' where tablename = 'proceedsview' AND field = 'yproceedstransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','proceedsview','N','','2','yproceedstransmission','')
GO

-- VERIFICA DI proceedsview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'proceedsview')
UPDATE customobject set isreal = 'N' where objectname = 'proceedsview'
ELSE
INSERT INTO customobject (objectname, isreal) values('proceedsview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA profserviceview
IF EXISTS(select * from sysobjects where id = object_id(N'[profserviceview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [profserviceview]
GO


CREATE VIEW [profserviceview]
(
	ycon,
	ncon,
	start,
	stop,
	adate,
	idreg,
	registry,
	feegross,
	idser,
	service,
	codeser,
	description,
	idivakind,
	ivakind,
	ivarate,
	ndays,
	ivaamount,
	totalcost,
	cu,
	ct,
	lu,
	lt,
	ivafieldnumber,
	pensioncontributionrate,
	socialsecurityrate,
	txt,
	doc,
	docdate,
	idinvkind,
	codeinvkind,
	invkind,
	flaginvoiced,
	yinv,
	ninv,
	idaccmotive,
	idsor1,
	idsor2,
	idsor3,
	idupb
)
AS SELECT 
	COP.ycon,
	COP.ncon,
	COP.start,
	COP.stop,
	COP.adate,
	COP.idreg,
	registry.title,
	COP.feegross,
	COP.idser,
	service.description,
	service.codeser,
	COP.description,
	COP.idivakind,
	ivakind.description,
	COP.ivarate,
	COP.ndays,
	COP.ivaamount,
	COP.totalcost,
	COP.cu,
	COP.ct,
	COP.lu,
	COP.lt,
	COP.ivafieldnumber,
	COP.pensioncontributionrate,
	COP.socialsecurityrate,
	COP.txt,
	COP.doc,
	COP.docdate,
	COP.idinvkind,
	IK.codeinvkind,
	IK.description,
	COP.flaginvoiced,
	COP.yinv,
	COP.ninv,
	COP.idaccmotive,
	COP.idsor1,
	COP.idsor2,
	COP.idsor3,
	COP.idupb
FROM profservice COP
JOIN ivakind
	ON ivakind.idivakind = COP.idivakind
LEFT OUTER JOIN registry
	ON registry.idreg = COP.idreg
LEFT OUTER JOIN service
	ON service.idser = COP.idser
LEFT OUTER JOIN invoice I
	ON COP.idinvkind = I.idinvkind
	AND COP.yinv = I.yinv
	AND COP.ninv = I.ninv
LEFT OUTER JOIN invoicekind IK
	ON I.idinvkind = IK.idinvkind

GO

-- VERIFICA DI profserviceview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'profserviceview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'adate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '8',field = 'adate',col_precision = '' where tablename = 'profserviceview' AND field = 'adate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','profserviceview','S','','8','adate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'codeinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '20',field = 'codeinvkind',col_precision = '' where tablename = 'profserviceview' AND field = 'codeinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','profserviceview','N','','20','codeinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'codeser')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '20',field = 'codeser',col_precision = '' where tablename = 'profserviceview' AND field = 'codeser'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','profserviceview','N','','20','codeser','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'profserviceview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','profserviceview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'profserviceview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','profserviceview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'profserviceview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','profserviceview','N','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'doc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(35)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '35',field = 'doc',col_precision = '' where tablename = 'profserviceview' AND field = 'doc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(35)','N','profserviceview','N','','35','doc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'docdate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '8',field = 'docdate',col_precision = '' where tablename = 'profserviceview' AND field = 'docdate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','profserviceview','N','','8','docdate','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'feegross')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'N',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '9',field = 'feegross',col_precision = '19' where tablename = 'profserviceview' AND field = 'feegross'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','N','System.Decimal','decimal(19,2)','N','profserviceview','S','','9','feegross','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'flaginvoiced')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '1',field = 'flaginvoiced',col_precision = '' where tablename = 'profserviceview' AND field = 'flaginvoiced'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','profserviceview','N','','1','flaginvoiced','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idaccmotive')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive',col_precision = '' where tablename = 'profserviceview' AND field = 'idaccmotive'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','profserviceview','N','','36','idaccmotive','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idinvkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '4',field = 'idinvkind',col_precision = '' where tablename = 'profserviceview' AND field = 'idinvkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','profserviceview','N','','4','idinvkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '4',field = 'idivakind',col_precision = '' where tablename = 'profserviceview' AND field = 'idivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','profserviceview','N','','4','idivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'profserviceview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','profserviceview','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idser')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '4',field = 'idser',col_precision = '' where tablename = 'profserviceview' AND field = 'idser'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','profserviceview','S','','4','idser','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idsor1')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '32',field = 'idsor1',col_precision = '' where tablename = 'profserviceview' AND field = 'idsor1'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','profserviceview','N','','32','idsor1','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idsor2')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '32',field = 'idsor2',col_precision = '' where tablename = 'profserviceview' AND field = 'idsor2'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','profserviceview','N','','32','idsor2','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idsor3')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(32)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '32',field = 'idsor3',col_precision = '' where tablename = 'profserviceview' AND field = 'idsor3'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(32)','N','profserviceview','N','','32','idsor3','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'idupb')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '36',field = 'idupb',col_precision = '' where tablename = 'profserviceview' AND field = 'idupb'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','profserviceview','N','','36','idupb','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'invkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '50',field = 'invkind',col_precision = '' where tablename = 'profserviceview' AND field = 'invkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','profserviceview','N','','50','invkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ivaamount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '9',field = 'ivaamount',col_precision = '19' where tablename = 'profserviceview' AND field = 'ivaamount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','profserviceview','N','','9','ivaamount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ivafieldnumber')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '4',field = 'ivafieldnumber',col_precision = '' where tablename = 'profserviceview' AND field = 'ivafieldnumber'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','profserviceview','N','','4','ivafieldnumber','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ivakind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '50',field = 'ivakind',col_precision = '' where tablename = 'profserviceview' AND field = 'ivakind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','profserviceview','S','','50','ivakind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ivarate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '9',field = 'ivarate',col_precision = '19' where tablename = 'profserviceview' AND field = 'ivarate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(19,6)','N','profserviceview','N','','9','ivarate','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'profserviceview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','profserviceview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'profserviceview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','profserviceview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ncon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '4',field = 'ncon',col_precision = '' where tablename = 'profserviceview' AND field = 'ncon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','profserviceview','S','','4','ncon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ndays')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '4',field = 'ndays',col_precision = '' where tablename = 'profserviceview' AND field = 'ndays'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','profserviceview','S','','4','ndays','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ninv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '4',field = 'ninv',col_precision = '' where tablename = 'profserviceview' AND field = 'ninv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','profserviceview','N','','4','ninv','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'pensioncontributionrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '9',field = 'pensioncontributionrate',col_precision = '19' where tablename = 'profserviceview' AND field = 'pensioncontributionrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(19,6)','N','profserviceview','N','','9','pensioncontributionrate','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'profserviceview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','profserviceview','N','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'service')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '50',field = 'service',col_precision = '' where tablename = 'profserviceview' AND field = 'service'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','profserviceview','N','','50','service','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'socialsecurityrate')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '6',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,6)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '9',field = 'socialsecurityrate',col_precision = '19' where tablename = 'profserviceview' AND field = 'socialsecurityrate'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','6','decimal','','S','System.Decimal','decimal(19,6)','N','profserviceview','N','','9','socialsecurityrate','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '8',field = 'start',col_precision = '' where tablename = 'profserviceview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','profserviceview','S','','8','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'stop')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '8',field = 'stop',col_precision = '' where tablename = 'profserviceview' AND field = 'stop'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','profserviceview','S','','8','stop','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'totalcost')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '9',field = 'totalcost',col_precision = '19' where tablename = 'profserviceview' AND field = 'totalcost'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','profserviceview','N','','9','totalcost','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'txt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'text',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'text',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '16',field = 'txt',col_precision = '' where tablename = 'profserviceview' AND field = 'txt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','text','','S','System.String','text','N','profserviceview','N','','16','txt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'ycon')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'profserviceview',denynull = 'S',format = '',col_len = '4',field = 'ycon',col_precision = '' where tablename = 'profserviceview' AND field = 'ycon'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','profserviceview','S','','4','ycon','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'profserviceview' AND field = 'yinv')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'profserviceview',denynull = 'N',format = '',col_len = '2',field = 'yinv',col_precision = '' where tablename = 'profserviceview' AND field = 'yinv'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','profserviceview','N','','2','yinv','')
GO

-- VERIFICA DI profserviceview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'profserviceview')
UPDATE customobject set isreal = 'N' where objectname = 'profserviceview'
ELSE
INSERT INTO customobject (objectname, isreal) values('profserviceview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA registrylegalstatusregview
IF EXISTS(select * from sysobjects where id = object_id(N'[dbo].[registrylegalstatusregview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [dbo].[registrylegalstatusregview]
GO








CREATE   VIEW [DBO].[registrylegalstatusregview]
(
	idreg,
	registry,
	start,
	idposition,
	codeposition,
	position,
	incomeclass,
	incomeclassvalidity,
	cu, 
	ct, 
	lu,
	lt,
	active
)
AS SELECT
	registrylegalstatus.idreg, 
	registry.title, 
	registrylegalstatus.start,
	registrylegalstatus.idposition, 
	position.codeposition,
	position.description,
	registrylegalstatus.incomeclass,
	registrylegalstatus.incomeclassvalidity,
	registrylegalstatus.cu, 
	registrylegalstatus.ct, 
	registrylegalstatus.lu,
	registrylegalstatus.lt,
	registrylegalstatus.active
FROM registrylegalstatus 
JOIN registry 
	ON registrylegalstatus.idreg = registry.idreg
LEFT OUTER JOIN position 
	ON registrylegalstatus.idposition = position.idposition 








GO

-- VERIFICA DI registrylegalstatusregview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'registrylegalstatusregview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','registrylegalstatusregview','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'codeposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '20',field = 'codeposition',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'codeposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','registrylegalstatusregview','N','','20','codeposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','registrylegalstatusregview','N','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(64)','N','registrylegalstatusregview','N','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'idposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '4',field = 'idposition',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'idposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','registrylegalstatusregview','N','','4','idposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','registrylegalstatusregview','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'incomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '2',field = 'incomeclass',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'incomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','registrylegalstatusregview','N','','2','incomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'incomeclassvalidity')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '4',field = 'incomeclassvalidity',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'incomeclassvalidity'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','registrylegalstatusregview','N','','4','incomeclassvalidity','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','registrylegalstatusregview','N','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(64)','N','registrylegalstatusregview','N','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'position')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'N',format = '',col_len = '50',field = 'position',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'position'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','registrylegalstatusregview','N','','50','position','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','registrylegalstatusregview','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusregview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'registrylegalstatusregview',denynull = 'S',format = '',col_len = '4',field = 'start',col_precision = '' where tablename = 'registrylegalstatusregview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','registrylegalstatusregview','S','','4','start','')
GO

-- VERIFICA DI registrylegalstatusregview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'registrylegalstatusregview')
UPDATE customobject set isreal = 'N' where objectname = 'registrylegalstatusregview'
ELSE
INSERT INTO customobject (objectname, isreal) values('registrylegalstatusregview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA registrylegalstatusview
IF EXISTS(select * from sysobjects where id = object_id(N'[dbo].[registrylegalstatusview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [dbo].[registrylegalstatusview]
GO








CREATE   VIEW [DBO].registrylegalstatusview 
(
	idreg,
	title, 
	start,
	idposition,
	codeposition,
	position,
	incomeclass,
	incomeclassvalidity,
	cu, 
	ct, 
	lu,
	lt
)
	AS SELECT
	registrylegalstatus.idreg, 
	registry.title, 
	registrylegalstatus.start,
	registrylegalstatus.idposition, 
	position.codeposition,
	position.description,
	registrylegalstatus.incomeclass,
	registrylegalstatus.incomeclassvalidity,
	registrylegalstatus.cu, 
	registrylegalstatus.ct, 
	registrylegalstatus.lu,
	registrylegalstatus.lt 
FROM registrylegalstatus 
JOIN registry 
	ON registrylegalstatus.idreg = registry.idreg
JOIN position 
	ON registrylegalstatus.idposition = position.idposition 
	










GO

-- VERIFICA DI registrylegalstatusview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'registrylegalstatusview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'codeposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'S',format = '',col_len = '20',field = 'codeposition',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'codeposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','registrylegalstatusview','S','','20','codeposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'N',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','registrylegalstatusview','N','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'N',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(64)','N','registrylegalstatusview','N','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'idposition')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'N',format = '',col_len = '4',field = 'idposition',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'idposition'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','registrylegalstatusview','N','','4','idposition','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','registrylegalstatusview','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'incomeclass')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'N',format = '',col_len = '2',field = 'incomeclass',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'incomeclass'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','registrylegalstatusview','N','','2','incomeclass','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'incomeclassvalidity')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'N',format = '',col_len = '4',field = 'incomeclassvalidity',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'incomeclassvalidity'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','S','System.DateTime','smalldatetime','N','registrylegalstatusview','N','','4','incomeclassvalidity','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'S',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'N',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','S','System.DateTime','datetime','N','registrylegalstatusview','N','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'N',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(64)','N','registrylegalstatusview','N','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'position')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'S',format = '',col_len = '50',field = 'position',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'position'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','registrylegalstatusview','S','','50','position','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'start')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smalldatetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'smalldatetime',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'S',format = '',col_len = '4',field = 'start',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'start'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smalldatetime','','N','System.DateTime','smalldatetime','N','registrylegalstatusview','S','','4','start','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrylegalstatusview' AND field = 'title')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'registrylegalstatusview',denynull = 'S',format = '',col_len = '100',field = 'title',col_precision = '' where tablename = 'registrylegalstatusview' AND field = 'title'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','registrylegalstatusview','S','','100','title','')
GO

-- VERIFICA DI registrylegalstatusview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'registrylegalstatusview')
UPDATE customobject set isreal = 'N' where objectname = 'registrylegalstatusview'
ELSE
INSERT INTO customobject (objectname, isreal) values('registrylegalstatusview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA registrypaymethodview
IF EXISTS(select * from sysobjects where id = object_id(N'[dbo].[registrypaymethodview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [dbo].[registrypaymethodview]
GO





CREATE  VIEW [DBO].[registrypaymethodview]
(
	idreg, 
	idregistrypaymethod,
	regmodcode, 
	registry, 
	idpaymethod, 
	paymethod, 
	allowdeputy,
	cin, 
	idbank, 
	banktitle, 
	idcab, 
	cabtitle, 
	cc, 
	paymentdescr, 
	paymentexpiring, 
	idexpirationkind, 
	flagstandard, 
	active, 
	iddeputy,
	deputy,
	idcurrency,
	codecurrency,
	currency,
	cu, ct, lu, lt
)
AS SELECT 
	registrypaymethod.idreg, 
	registrypaymethod.idregistrypaymethod,
	registrypaymethod.regmodcode, 
	registry.title, 
	registrypaymethod.idpaymethod, 
	paymethod.description, 
	paymethod.allowdeputy,
	registrypaymethod.cin, 
	registrypaymethod.idbank, 
	bank.description, 
	registrypaymethod.idcab, 
	cab.description, 
	registrypaymethod.cc, 
	registrypaymethod.paymentdescr, 
	registrypaymethod.paymentexpiring, 
	registrypaymethod.idexpirationkind, 
	registrypaymethod.flagstandard, 
	registrypaymethod.active, 
	registrypaymethod.iddeputy,
	deputy.title,
	registrypaymethod.idcurrency,
	currency.codecurrency,
	currency.description,
	registrypaymethod.cu, registrypaymethod.ct, registrypaymethod.lu, registrypaymethod.lt
FROM registrypaymethod
JOIN registry
	ON registrypaymethod.idreg = registry.idreg 
LEFT OUTER JOIN registry deputy
	ON deputy.idreg = registrypaymethod.iddeputy
LEFT OUTER JOIN paymethod
	ON paymethod.idpaymethod = registrypaymethod.idpaymethod 
LEFT OUTER JOIN bank
	ON bank.idbank = registrypaymethod.idbank 
LEFT OUTER JOIN cab
	ON cab.idbank = registrypaymethod.idbank 
	AND cab.idcab = registrypaymethod.idcab 
LEFT OUTER JOIN currency
	ON currency.idcurrency = registrypaymethod.idcurrency







GO

-- VERIFICA DI registrypaymethodview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'registrypaymethodview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'active')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '1',field = 'active',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'active'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','registrypaymethodview','N','','1','active','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'allowdeputy')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '1',field = 'allowdeputy',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'allowdeputy'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','registrypaymethodview','N','','1','allowdeputy','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'banktitle')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '150',field = 'banktitle',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'banktitle'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','registrypaymethodview','N','','150','banktitle','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'cabtitle')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '50',field = 'cabtitle',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'cabtitle'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','registrypaymethodview','N','','50','cabtitle','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'cc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(30)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '30',field = 'cc',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'cc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(30)','N','registrypaymethodview','N','','30','cc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'cin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '20',field = 'cin',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'cin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','registrypaymethodview','N','','20','cin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'codecurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '20',field = 'codecurrency',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'codecurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','registrypaymethodview','N','','20','codecurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','registrypaymethodview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','registrypaymethodview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'currency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '50',field = 'currency',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'currency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','registrypaymethodview','N','','50','currency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'deputy')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '100',field = 'deputy',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'deputy'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','registrypaymethodview','N','','100','deputy','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'flagstandard')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '1',field = 'flagstandard',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'flagstandard'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','registrypaymethodview','N','','1','flagstandard','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'idbank')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '20',field = 'idbank',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'idbank'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','registrypaymethodview','N','','20','idbank','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'idcab')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '20',field = 'idcab',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'idcab'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','registrypaymethodview','N','','20','idcab','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'idcurrency')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '4',field = 'idcurrency',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'idcurrency'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','registrypaymethodview','N','','4','idcurrency','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'iddeputy')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'S',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '4',field = 'iddeputy',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'iddeputy'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','S','System.Int32','int','N','registrypaymethodview','N','','4','iddeputy','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'idexpirationkind')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '1',field = 'idexpirationkind',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'idexpirationkind'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','S','System.String','char(1)','N','registrypaymethodview','N','','1','idexpirationkind','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'idpaymethod')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '20',field = 'idpaymethod',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'idpaymethod'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','registrypaymethodview','N','','20','idpaymethod','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'idreg')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '4',field = 'idreg',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'idreg'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','registrypaymethodview','S','','4','idreg','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'idregistrypaymethod')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '4',field = 'idregistrypaymethod',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'idregistrypaymethod'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','registrypaymethodview','S','','4','idregistrypaymethod','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','registrypaymethodview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','registrypaymethodview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'paymentdescr')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '150',field = 'paymentdescr',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'paymentdescr'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','registrypaymethodview','N','','150','paymentdescr','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'paymentexpiring')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'S',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '2',field = 'paymentexpiring',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'paymentexpiring'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','S','System.Int16','smallint','N','registrypaymethodview','N','','2','paymentexpiring','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'paymethod')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'N',format = '',col_len = '50',field = 'paymethod',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'paymethod'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','registrypaymethodview','N','','50','paymethod','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'registry')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '100',field = 'registry',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'registry'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(100)','N','registrypaymethodview','S','','100','registry','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'registrypaymethodview' AND field = 'regmodcode')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'registrypaymethodview',denynull = 'S',format = '',col_len = '50',field = 'regmodcode',col_precision = '' where tablename = 'registrypaymethodview' AND field = 'regmodcode'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(50)','N','registrypaymethodview','S','','50','regmodcode','')
GO

-- VERIFICA DI registrypaymethodview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'registrypaymethodview')
UPDATE customobject set isreal = 'N' where objectname = 'registrypaymethodview'
ELSE
INSERT INTO customobject (objectname, isreal) values('registrypaymethodview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA treasurerstartview
IF EXISTS(select * from sysobjects where id = object_id(N'[treasurerstartview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [treasurerstartview]
GO



--Pino Rana, elaborazione del 10/08/2005 15:18:08
CREATE                                VIEW treasurerstartview
	(
	idtreasurer,
	codetreasurer,
	treasurer,
	ayear,
  amount,
	cu,
	ct,
	lu,
	lt
	)
	AS SELECT
	treasurerstart.idtreasurer,
	treasurer.codetreasurer,
	treasurer.description,
	treasurerstart.ayear,
  treasurerstart.amount,
	treasurerstart.cu,
	treasurerstart.ct,
	treasurerstart.lu,
	treasurerstart.lt
	FROM treasurerstart (NOLOCK)
	JOIN treasurer (NOLOCK)
	ON treasurerstart.idtreasurer = treasurer.idtreasurer





GO

-- VERIFICA DI treasurerstartview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'treasurerstartview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'amount')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '2',sqltype = 'decimal',defaultvalue = '',allownull = 'S',systemtype = 'System.Decimal',sqldeclaration = 'decimal(19,2)',iskey = 'N',tablename = 'treasurerstartview',denynull = 'N',format = '',col_len = '9',field = 'amount',col_precision = '19' where tablename = 'treasurerstartview' AND field = 'amount'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','2','decimal','','S','System.Decimal','decimal(19,2)','N','treasurerstartview','N','','9','amount','19')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'ayear')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'smallint',defaultvalue = '',allownull = 'N',systemtype = 'System.Int16',sqldeclaration = 'smallint',iskey = 'N',tablename = 'treasurerstartview',denynull = 'S',format = '',col_len = '2',field = 'ayear',col_precision = '' where tablename = 'treasurerstartview' AND field = 'ayear'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','smallint','','N','System.Int16','smallint','N','treasurerstartview','S','','2','ayear','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'codetreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerstartview',denynull = 'S',format = '',col_len = '20',field = 'codetreasurer',col_precision = '' where tablename = 'treasurerstartview' AND field = 'codetreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','treasurerstartview','S','','20','codetreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'treasurerstartview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'treasurerstartview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','treasurerstartview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'treasurerstartview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'treasurerstartview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','treasurerstartview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'idtreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'treasurerstartview',denynull = 'S',format = '',col_len = '4',field = 'idtreasurer',col_precision = '' where tablename = 'treasurerstartview' AND field = 'idtreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','treasurerstartview','S','','4','idtreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'treasurerstartview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'treasurerstartview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','treasurerstartview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'treasurerstartview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'treasurerstartview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','treasurerstartview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerstartview' AND field = 'treasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'treasurerstartview',denynull = 'N',format = '',col_len = '150',field = 'treasurer',col_precision = '' where tablename = 'treasurerstartview' AND field = 'treasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','treasurerstartview','N','','150','treasurer','')
GO

-- VERIFICA DI treasurerstartview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'treasurerstartview')
UPDATE customobject set isreal = 'N' where objectname = 'treasurerstartview'
ELSE
INSERT INTO customobject (objectname, isreal) values('treasurerstartview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

-- CREAZIONE VISTA treasurerview
IF EXISTS(select * from sysobjects where id = object_id(N'[treasurerview]') and OBJECTPROPERTY(id, N'IsView') = 1)
DROP VIEW [treasurerview]
GO



--Pino Rana, elaborazione del 10/08/2005 15:18:06
-- Rusciano G. 03.01.2006
CREATE                                   VIEW treasurerview 
(
	idtreasurer,
	codetreasurer,
 	description,
	cin,
	idbank,
	banktitle,
	idcab,
	cabtitle,
	cc,
	address,
	cap,
	city,
	country,
	phoneprefix,
	phonenumber,
	faxprefix,
	faxnumber,
	flagdefault,
	agencycodefortransmission,
	depcodefortransmission,
	cabcodefortransmission,
	idaccmotive_proceeds,
	codemotive_proceeds,
	motive_proceeds,
	idaccmotive_payment,
	codemotive_payment,
	motive_payment,
	cu,
	ct,
	lu,
	lt
)
	AS SELECT
	treasurer.idtreasurer,
	treasurer.codetreasurer,
	treasurer.description,
	treasurer.cin,
	treasurer.idbank,
	bank.description,
	treasurer.idcab,
	cab.description,
	treasurer.cc,
	treasurer.address,
	treasurer.cap,
	treasurer.city,
	treasurer.country,
	treasurer.phoneprefix,
	treasurer.phonenumber,
	treasurer.faxprefix,
	treasurer.faxnumber,
	treasurer.flagdefault,
	treasurer.agencycodefortransmission,
	treasurer.depcodefortransmission,
	treasurer.cabcodefortransmission,
	treasurer.idaccmotive_proceeds,
	acc_pro.codemotive,
	acc_pro.title,
	treasurer.idaccmotive_payment,
	acc_pay.codemotive,
	acc_pay.title,
	treasurer.cu,
	treasurer.ct,
	treasurer.lu,
	treasurer.lt
	FROM treasurer (NOLOCK)
	LEFT OUTER JOIN bank (NOLOCK)
	ON bank.idbank = treasurer.idbank
	LEFT OUTER JOIN cab (NOLOCK)
	ON cab.idbank = treasurer.idbank
	AND cab.idcab = treasurer.idcab
	LEFT OUTER JOIN accmotive acc_pro
	ON acc_pro.idaccmotive = treasurer.idaccmotive_proceeds
	LEFT OUTER JOIN accmotive acc_pay
	ON acc_pay.idaccmotive = treasurer.idaccmotive_payment




GO

-- VERIFICA DI treasurerview IN COLUMNTYPES --
DELETE FROM columntypes WHERE tablename = 'treasurerview'
IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'address')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(100)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '100',field = 'address',col_precision = '' where tablename = 'treasurerview' AND field = 'address'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(100)','N','treasurerview','N','','100','address','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'agencycodefortransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'agencycodefortransmission',col_precision = '' where tablename = 'treasurerview' AND field = 'agencycodefortransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','agencycodefortransmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'banktitle')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '150',field = 'banktitle',col_precision = '' where tablename = 'treasurerview' AND field = 'banktitle'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','treasurerview','N','','150','banktitle','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'cabcodefortransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'cabcodefortransmission',col_precision = '' where tablename = 'treasurerview' AND field = 'cabcodefortransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','cabcodefortransmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'cabtitle')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '50',field = 'cabtitle',col_precision = '' where tablename = 'treasurerview' AND field = 'cabtitle'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','treasurerview','N','','50','cabtitle','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'cap')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'cap',col_precision = '' where tablename = 'treasurerview' AND field = 'cap'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','cap','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'cc')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(30)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '30',field = 'cc',col_precision = '' where tablename = 'treasurerview' AND field = 'cc'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(30)','N','treasurerview','N','','30','cc','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'cin')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'cin',col_precision = '' where tablename = 'treasurerview' AND field = 'cin'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','cin','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'city')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '50',field = 'city',col_precision = '' where tablename = 'treasurerview' AND field = 'city'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','treasurerview','N','','50','city','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'codemotive_payment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '50',field = 'codemotive_payment',col_precision = '' where tablename = 'treasurerview' AND field = 'codemotive_payment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','treasurerview','N','','50','codemotive_payment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'codemotive_proceeds')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '50',field = 'codemotive_proceeds',col_precision = '' where tablename = 'treasurerview' AND field = 'codemotive_proceeds'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','treasurerview','N','','50','codemotive_proceeds','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'codetreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'S',format = '',col_len = '20',field = 'codetreasurer',col_precision = '' where tablename = 'treasurerview' AND field = 'codetreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(20)','N','treasurerview','S','','20','codetreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'country')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(2)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '2',field = 'country',col_precision = '' where tablename = 'treasurerview' AND field = 'country'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(2)','N','treasurerview','N','','2','country','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'ct')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'treasurerview',denynull = 'S',format = '',col_len = '8',field = 'ct',col_precision = '' where tablename = 'treasurerview' AND field = 'ct'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','treasurerview','S','','8','ct','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'cu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'treasurerview',denynull = 'S',format = '',col_len = '64',field = 'cu',col_precision = '' where tablename = 'treasurerview' AND field = 'cu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','treasurerview','S','','64','cu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'depcodefortransmission')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'depcodefortransmission',col_precision = '' where tablename = 'treasurerview' AND field = 'depcodefortransmission'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','depcodefortransmission','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'description')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '150',field = 'description',col_precision = '' where tablename = 'treasurerview' AND field = 'description'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','treasurerview','N','','150','description','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'faxnumber')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(50)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '50',field = 'faxnumber',col_precision = '' where tablename = 'treasurerview' AND field = 'faxnumber'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(50)','N','treasurerview','N','','50','faxnumber','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'faxprefix')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'faxprefix',col_precision = '' where tablename = 'treasurerview' AND field = 'faxprefix'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','faxprefix','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'flagdefault')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'char',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'char(1)',iskey = 'N',tablename = 'treasurerview',denynull = 'S',format = '',col_len = '1',field = 'flagdefault',col_precision = '' where tablename = 'treasurerview' AND field = 'flagdefault'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','char','','N','System.String','char(1)','N','treasurerview','S','','1','flagdefault','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'idaccmotive_payment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive_payment',col_precision = '' where tablename = 'treasurerview' AND field = 'idaccmotive_payment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','treasurerview','N','','36','idaccmotive_payment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'idaccmotive_proceeds')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(36)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '36',field = 'idaccmotive_proceeds',col_precision = '' where tablename = 'treasurerview' AND field = 'idaccmotive_proceeds'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(36)','N','treasurerview','N','','36','idaccmotive_proceeds','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'idbank')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'idbank',col_precision = '' where tablename = 'treasurerview' AND field = 'idbank'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','idbank','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'idcab')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'idcab',col_precision = '' where tablename = 'treasurerview' AND field = 'idcab'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','idcab','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'idtreasurer')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'int',defaultvalue = '',allownull = 'N',systemtype = 'System.Int32',sqldeclaration = 'int',iskey = 'N',tablename = 'treasurerview',denynull = 'S',format = '',col_len = '4',field = 'idtreasurer',col_precision = '' where tablename = 'treasurerview' AND field = 'idtreasurer'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','int','','N','System.Int32','int','N','treasurerview','S','','4','idtreasurer','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'lt')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'datetime',defaultvalue = '',allownull = 'N',systemtype = 'System.DateTime',sqldeclaration = 'datetime',iskey = 'N',tablename = 'treasurerview',denynull = 'S',format = '',col_len = '8',field = 'lt',col_precision = '' where tablename = 'treasurerview' AND field = 'lt'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','datetime','','N','System.DateTime','datetime','N','treasurerview','S','','8','lt','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'lu')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'N',systemtype = 'System.String',sqldeclaration = 'varchar(64)',iskey = 'N',tablename = 'treasurerview',denynull = 'S',format = '',col_len = '64',field = 'lu',col_precision = '' where tablename = 'treasurerview' AND field = 'lu'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','N','System.String','varchar(64)','N','treasurerview','S','','64','lu','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'motive_payment')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '150',field = 'motive_payment',col_precision = '' where tablename = 'treasurerview' AND field = 'motive_payment'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','treasurerview','N','','150','motive_payment','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'motive_proceeds')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(150)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '150',field = 'motive_proceeds',col_precision = '' where tablename = 'treasurerview' AND field = 'motive_proceeds'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(150)','N','treasurerview','N','','150','motive_proceeds','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'phonenumber')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(30)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '30',field = 'phonenumber',col_precision = '' where tablename = 'treasurerview' AND field = 'phonenumber'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(30)','N','treasurerview','N','','30','phonenumber','')
GO

IF exists(SELECT * FROM columntypes WHERE tablename = 'treasurerview' AND field = 'phoneprefix')
UPDATE columntypes set createuser = 'SARA',lastmoduser = '''SARA''',col_scale = '',sqltype = 'varchar',defaultvalue = '',allownull = 'S',systemtype = 'System.String',sqldeclaration = 'varchar(20)',iskey = 'N',tablename = 'treasurerview',denynull = 'N',format = '',col_len = '20',field = 'phoneprefix',col_precision = '' where tablename = 'treasurerview' AND field = 'phoneprefix'
ELSE
INSERT INTO columntypes (createuser,lastmoduser,col_scale,sqltype,defaultvalue,allownull,systemtype,sqldeclaration,iskey,tablename,denynull,format,col_len,field,col_precision) VALUES('SARA','''SARA''','','varchar','','S','System.String','varchar(20)','N','treasurerview','N','','20','phoneprefix','')
GO

-- VERIFICA DI treasurerview IN CUSTOMOBJECT --
IF EXISTS(select * from customobject where objectname = 'treasurerview')
UPDATE customobject set isreal = 'N' where objectname = 'treasurerview'
ELSE
INSERT INTO customobject (objectname, isreal) values('treasurerview', 'N')
GO
-- FINE GENERAZIONE SCRIPT --

